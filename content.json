{"meta":{"title":"ä¸–ç•Œçš„ä¾§é¢","subtitle":"ä»¥æ€æ ·çš„è§’åº¦ï¼Œæ‰èƒ½çœ‹åˆ°è¿™ä¸ªä¸–ç•Œçš„ä¾§é¢ï¼Ÿ","description":"","author":"åˆå¿ƒYearth","url":"http://yoursite.com","root":"/"},"pages":[],"posts":[{"title":"Vue 2.6 æºç åˆ†æä¹‹æ—…ã€2ã€‘ â€”â€” æ•°æ®å“åº”å¼","slug":"2020-08-17","date":"2020-08-17T08:08:21.658Z","updated":"2020-08-17T08:08:21.658Z","comments":false,"path":"2020/08/17/2020-08-17/","link":"","permalink":"http://yoursite.com/2020/08/17/2020-08-17/","excerpt":"","text":"ä¸Šä¸€ç« ç²—æµ…çš„åˆ†æäº† vue 2.6.x çš„åˆå§‹åŒ–æµç¨‹ï¼Œææ¸…æ¥šäº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š vue çš„å…¥å£åœ¨å“ªé‡Œ vue çš„åˆå§‹åŒ–åšäº†ä»€ä¹ˆæ“ä½œ åœ¨ vue åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå“ªäº›æ“ä½œå…ˆæ‰§è¡Œï¼Œå“ªäº›æ“ä½œåæ‰§è¡Œ è€Œä»Šå¤©ï¼Œæˆ‘ä»¬å°†åˆ†æ vue 2.6.x ä¸­æ˜¯å¦‚ä½•å®Œæˆæ•°æ®å“åº”å¼æ“ä½œçš„ã€‚ é‚£ä¹ˆå¼€å§‹å§ï¼ å¤„ç†å¯¹è±¡ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œvue 2.6.x ä¸­å®ç°æ•°æ®å“åº”å¼çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ Object.definePropertyï¼Œè€Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œæ‰€ä»¥ vue å¯¹äºæ•°ç»„å’Œå¯¹è±¡çš„å¤„ç†æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…ˆæ¥åˆ†æå®ƒæ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ã€‚ é€šè¿‡ä¸Šä¸€ç« çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆå§‹åŒ–æµç¨‹ä¸­ï¼Œå¤„ç†æ•°æ®çš„æ–¹æ³•æ˜¯ initStateï¼š 123456789101112131415export function initState(vm: Component) &#123; vm._watchers = [] const opts = vm.$options if (opts.props) initProps(vm, opts.props) if (opts.methods) initMethods(vm, opts.methods) if (opts.data) &#123; initData(vm) &#125; else &#123; observe((vm._data = &#123;&#125;), true /* asRootData */) &#125; if (opts.computed) initComputed(vm, opts.computed) if (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123; initWatch(vm, opts.watch) &#125;&#125; ä¸Šé¢çš„ä»£ç å‘Šè¯‰æˆ‘ä»¬ä¸¤æ¡ä¿¡æ¯ï¼š ä¼˜å…ˆçº§ï¼šprops &gt; methods &gt; data &gt; computed &gt; watch å®ç°æ•°æ®å“åº”å¼çš„æ–¹æ³•æ˜¯ initData(vm) 12345678910111213141516171819202122232425262728293031323334function initData(vm: Component) &#123; let data = vm.$options.data data = vm._data = typeof data === &#x27;function&#x27; ? getData(data, vm) : data || &#123;&#125; if (!isPlainObject(data)) &#123; data = &#123;&#125; process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; warn( &#x27;data functions should return an object:\\n&#x27; + &#x27;https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;, vm ) &#125; // proxy data on instance const keys = Object.keys(data) const props = vm.$options.props const methods = vm.$options.methods let i = keys.length while (i--) &#123; const key = keys[i] if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; if (methods &amp;&amp; hasOwn(methods, key)) &#123; warn(`Method &quot;$&#123;key&#125;&quot; has already been defined as a data property.`, vm) &#125; &#125; if (props &amp;&amp; hasOwn(props, key)) &#123; process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; warn(`The data property &quot;$&#123;key&#125;&quot; is already declared as a prop. ` + `Use prop default value instead.`, vm) &#125; else if (!isReserved(key)) &#123; proxy(vm, `_data`, key) &#125; &#125; // observe data observe(data, true /* asRootData */)&#125; ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯ observeã€‚ é‚£ä¹ˆè·³è¿‡å»çœ‹çœ‹ï¼š æ–‡ä»¶ä½ç½®ï¼šsrc/core/observer/index.jsï¼š 123456789101112131415161718192021export function observe(value: any, asRootData: ?boolean): Observer | void &#123; if (!isObject(value) || value instanceof VNode) &#123; return &#125; let ob: Observer | void if (hasOwn(value, &#x27;__ob__&#x27;) &amp;&amp; value.__ob__ instanceof Observer) &#123; ob = value.__ob__ &#125; else if ( shouldObserve &amp;&amp; !isServerRendering() &amp;&amp; (Array.isArray(value) || isPlainObject(value)) &amp;&amp; Object.isExtensible(value) &amp;&amp; !value._isVue ) &#123; ob = new Observer(value) &#125; if (asRootData &amp;&amp; ob) &#123; ob.vmCount++ &#125; return ob&#125; è€Œä»è¿™é‡Œçš„ä»£ç ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ new Observer() æ“ä½œ å¦‚æœä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ __ob__ å±æ€§ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå“åº”å¼çš„æ•°æ® å®ç°å“åº”å¼çš„æ ¸å¿ƒæ“ä½œåœ¨ new Observer() ä¸­ æ‰€ä»¥ç°åœ¨è·³è½¬éƒ½ Observer ä¸­çœ‹çœ‹ï¼š æ–‡ä»¶ä½ç½®ï¼šsrc/core/observer/index.jsï¼š 1234567891011121314151617constructor(value: any) &#123; this.value = value this.dep = new Dep() this.vmCount = 0 def(value, &#x27;__ob__&#x27;, this) if (Array.isArray(value)) &#123; if (hasProto) &#123; protoAugment(value, arrayMethods) &#125; else &#123; copyAugment(value, arrayMethods, arrayKeys) &#125; this.observeArray(value) &#125; else &#123; this.walk(value) &#125; &#125; è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ª ob å®ä¾‹ä¸€å®šä¼šæœ‰ä¸€ä¸ª dep å®ä¾‹ï¼Œè€Œæ¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª obï¼Œæ‰€ä»¥æ¯ä¸ªå¯¹è±¡å°†æœ‰ä¸€ä¸ª dep å®ä¾‹ï¼Œæš‚ä¸”æˆ‘ä»¬å«å®ƒå¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼Œè‡³äºå®ƒçš„ç”¨å¤„ï¼Œæš‚ä¸æ·±å…¥è®¨è®ºï¼Œåé¢å†å›è¿‡å¤´æ¥çœ‹ã€‚ å‰é¢å·²ç»æåˆ°è¿‡ï¼Œæ•°ç»„å’Œå¯¹è±¡çš„å“åº”å¼æœ‰åŒºåˆ«ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆçœ‹å“åº”å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼š 123456walk(obj: Object) &#123; const keys = Object.keys(obj) for (let i = 0; i &lt; keys.length; i++) &#123; defineReactive(obj, keys[i]) &#125;&#125; æ˜¾ç„¶ï¼ŒdefineReactive å°±æ˜¯å®ç°æ•°æ®å“åº”å¼çš„æ ¸å¿ƒæ–¹æ³•äº†ã€‚ å¹¶ä¸”è¿™ä¸ªæ–¹æ³•æŒ‚åˆ°äº† Vue.util.defineReactive ä¸Š é‚£ä¹ˆæˆ‘ä»¬æ·±å…¥åˆ°æ–¹æ³•å†…éƒ¨çœ‹çœ‹ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354export function defineReactive(obj: Object, key: string, val: any, customSetter?: ?Function, shallow?: boolean) &#123; const dep = new Dep() const property = Object.getOwnPropertyDescriptor(obj, key) if (property &amp;&amp; property.configurable === false) &#123; return &#125; // cater for pre-defined getter/setters const getter = property &amp;&amp; property.get const setter = property &amp;&amp; property.set if ((!getter || setter) &amp;&amp; arguments.length === 2) &#123; val = obj[key] &#125; let childOb = !shallow &amp;&amp; observe(val) Object.defineProperty(obj, key, &#123; enumerable: true, configurable: true, get: function reactiveGetter() &#123; const value = getter ? getter.call(obj) : val if (Dep.target) &#123; dep.depend() if (childOb) &#123; childOb.dep.depend() if (Array.isArray(value)) &#123; dependArray(value) &#125; &#125; &#125; return value &#125;, set: function reactiveSetter(newVal) &#123; const value = getter ? getter.call(obj) : val /* eslint-disable no-self-compare */ if (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123; return &#125; /* eslint-enable no-self-compare */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; customSetter) &#123; customSetter() &#125; // #7981: for accessor properties without setter if (getter &amp;&amp; !setter) return if (setter) &#123; setter.call(obj, newVal) &#125; else &#123; val = newVal &#125; childOb = !shallow &amp;&amp; observe(newVal) dep.notify() &#125;, &#125;)&#125; ä¹ä¸€çœ‹æŒºå¤æ‚ï¼Œå®é™…ä¸Šä¸Šé¢çš„ä»£ç æ€»å…±åšäº†ä¸‰ä»¶äº‹ï¼š ç»™æ¯ä¸ª key åˆ›å»ºä¸€ä¸ª depï¼ˆè¿™ä¸ª dep æˆ‘ä»¬å«å®ƒæ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼‰ å¦‚æœä¼ å…¥çš„ val æ˜¯ objectï¼Œåˆ™è¿›è¡Œé€’å½’æ“ä½œ é€šè¿‡ Object.defineProperty å®ç°æ•°æ®å“åº”å¼ é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ get çš„æ—¶å€™ï¼Œè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œï¼š 123456789if (Dep.target) &#123; dep.depend() if (childOb) &#123; childOb.dep.depend() if (Array.isArray(value)) &#123; dependArray(value) &#125; &#125;&#125; ç”¨æ¯”è¾ƒä¸“ä¸šè¯´çš„è¯´æ³•ï¼Œè¿™ä¸€æ­¥å«åšä¾èµ–æ”¶é›†ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªé—®é¢˜ï¼š ä»€ä¹ˆæ˜¯ä¾èµ–æ”¶é›†ï¼Ÿ Dep.target æ˜¯ä»€ä¹ˆï¼Ÿ depend åšäº†ä»€ä¹ˆï¼Ÿ dependArray åšäº†ä»€ä¹ˆï¼Ÿ è¿™é‡Œä¸€ä¸€å›ç­”ï¼š æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œvue æ˜¯ä¸€æ¬¾ mvvm çš„æ¡†æ¶ï¼Œå®ç°äº†æ•°æ®çš„å“åº”å¼ï¼Œè®©å¼€å‘è€…ä¸ç”¨å†è¿‡åˆ†å…³æ³¨æ•°æ®ï¼Œè§†å›¾çš„è”ç³»ï¼Œåªéœ€è¦æ›´æ–°æ•°æ®ï¼Œè§†å›¾ä¼šè‡ªåŠ¨çš„æ›´æ–°ã€‚ å‡è®¾ç°åœ¨æœ‰ a, b, c, d å››ä¸ªå˜é‡ï¼Œè€Œè§†å›¾ä¸­åªç”¨åˆ°äº† a, c, dï¼Œé‚£ä¹ˆ b æ›´æ”¹çš„æ—¶å€™ï¼Œè§†å›¾è‡ªç„¶ä¸åº”è¯¥åˆ·æ–°ï¼Œè¦æ€ä¹ˆåˆ¤æ–­ b å’Œè§†å›¾æœ‰æ²¡æœ‰å…³ç³»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¾èµ–æ”¶é›†éœ€è¦åšåˆ°çš„ã€‚ è‡³äºä¸‹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾—å…ˆåˆ° dep ä¸­çœ‹çœ‹ï¼š æ–‡ä»¶ä½ç½®ï¼šsrc/core/observer/dep.jsï¼š 1234567891011121314151617181920212223242526272829303132333435363738export default class Dep &#123; static target: ?Watcher id: number subs: Array&lt;Watcher&gt; constructor() &#123; this.id = uid++ this.subs = [] &#125; addSub(sub: Watcher) &#123; this.subs.push(sub) &#125; removeSub(sub: Watcher) &#123; remove(this.subs, sub) &#125; depend() &#123; if (Dep.target) &#123; Dep.target.addDep(this) &#125; &#125; notify() &#123; // stabilize the subscriber list first const subs = this.subs.slice() if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; !config.async) &#123; // subs aren&#x27;t sorted in scheduler if not running async // we need to sort them now to make sure they fire in correct // order subs.sort((a, b) =&gt; a.id - b.id) &#125; for (let i = 0, l = subs.length; i &lt; l; i++) &#123; subs[i].update() &#125; &#125;&#125; é€šè¿‡ç±»å‹å¯ä»¥çœ‹åˆ°ï¼Œtarget åº”è¯¥æ˜¯ä¸€ä¸ª Wathcerï¼Œè€Œ Wathcerï¼Œæˆ‘ä»¬å‰é¢æ‰‹å†™ vue å“åº”å¼çš„æ—¶å€™ï¼Œå·²ç»ä»‹ç»çš„å¾ˆæ¸…æ¥šäº†ï¼Œå¦‚æœæœ‰ä¸æ¸…æ¥šçš„ç«¥é‹å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼šæ‰‹å†™ç®€æ˜“ MVVMã€‚ é‚£ä¹ˆ depend åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ æˆ‘ä»¬æ¥åˆ° Watcherï¼š æ–‡ä»¶ä½ç½®ï¼šsrc/core/observer/watcher.jsï¼š 12345678910addDep(dep: Dep) &#123; const id = dep.id if (!this.newDepIds.has(id)) &#123; this.newDepIds.add(id) this.newDeps.push(dep) if (!this.depIds.has(id)) &#123; dep.addSub(this) &#125; &#125;&#125; è¿™é‡Œä¸»è¦åšäº†ä¸¤ä¸ªæ“ä½œï¼š å»ºç«‹ watcher å’Œ dep çš„å…³ç³» åå‘å»ºç«‹ dep å’Œ watcher çš„å…³ç³» é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å»ºç«‹åŒå‘çš„å…³ç³»å‘¢ï¼Ÿä¹‹å‰å®ç° mvvm çš„æ—¶å€™ï¼Œä¸æ˜¯å»ºç«‹å•å‘å…³ç³»å°±å¯ä»¥äº†å—ï¼Ÿ è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ç¨åå†è¯´ï¼Œç°åœ¨å…ˆæ¥çœ‹çœ‹ä¸Šé¢çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼ŒdependArray åˆåšäº†ä»€ä¹ˆï¼Ÿ 123456789function dependArray(value: Array&lt;any&gt;) &#123; for (let e, i = 0, l = value.length; i &lt; l; i++) &#123; e = value[i] e &amp;&amp; e.__ob__ &amp;&amp; e.__ob__.dep.depend() if (Array.isArray(e)) &#123; dependArray(e) &#125; &#125;&#125; æ˜¾ç„¶ï¼Œè¿™é‡Œæ˜¯éå†æ•°ç»„ï¼Œå¯¹å…¶æ¯ä¸€ä¸ªå…ƒç´ å»ºç«‹å’Œ dep çš„å…³ç³»ã€‚ è¿™é‡Œä¸ºäº†ç†æ¸…æ€è·¯ï¼Œè¡¥ä¸Šè„‘å›¾ï¼š ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼š Wathcer æ˜¯ä»€ä¹ˆï¼Ÿ Dep æ˜¯ä»€ä¹ˆï¼Ÿ ä¸ºä»€ä¹ˆè¦å»ºç«‹å®ƒä»¬çš„å…³ç³»ï¼Ÿ å»ºç«‹äº†å®ƒä»¬çš„å…³ç³»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ å‰é¢å·²ç»å¤šæ¬¡æåˆ° Dep äº†ï¼Œæœ‰ obj ä¸­çš„ Depï¼Œä¹Ÿæœ‰ key ä¸­çš„ Depï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹ Depï¼š 1234567891011121314151617181920212223242526272829303132333435363738export default class Dep &#123; static target: ?Watcher id: number subs: Array&lt;Watcher&gt; constructor() &#123; this.id = uid++ this.subs = [] &#125; addSub(sub: Watcher) &#123; this.subs.push(sub) &#125; removeSub(sub: Watcher) &#123; remove(this.subs, sub) &#125; depend() &#123; if (Dep.target) &#123; Dep.target.addDep(this) &#125; &#125; notify() &#123; // stabilize the subscriber list first const subs = this.subs.slice() if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; !config.async) &#123; // subs aren&#x27;t sorted in scheduler if not running async // we need to sort them now to make sure they fire in correct // order subs.sort((a, b) =&gt; a.id - b.id) &#125; for (let i = 0, l = subs.length; i &lt; l; i++) &#123; subs[i].update() &#125; &#125;&#125; ä¸Šé¢çš„ä»£ç å‘Šè¯‰æˆ‘ä»¬å‡ æ¡ä¿¡æ¯ï¼š dep ç®¡ç†ç€ä¸€ä¸ªæœ‰ Wathcer ç»„æˆçš„æ•°ç»„ åœ¨ notify ä¸­ä¼šéå†è¿™ä¸ªæ•°ç»„ï¼Œæ‰§è¡Œå…¶ä¸­çš„ update æ–¹æ³• è€Œ update çš„å…·ä½“å®ç°æ¶‰åŠåˆ° vue çš„å¼‚æ­¥æ›´æ–°ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»…æŠŠå®ƒå½“æˆæ˜¯è§†å›¾æ›´æ–°å‡½æ•°å³å¯ï¼Œæš‚ä¸è®¨è®ºå…¶å…·ä½“å®ç°ã€‚ é‚£ä¹ˆ Dep å’Œ Watcher çš„å…³ç³»æ˜¯ï¼šDep ç®¡ç† Watcherï¼ŒWatcher ç®¡ç†è§†å›¾æ›´æ–°ã€‚ åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´æ¸…æ¥š vue çš„æ•°æ®å“åº”å¼æµç¨‹äº†ï¼Œä¸è¿‡è¿˜å­˜æœ‰ä¸€äº›ç–‘é—®ï¼š ä¸ºä»€ä¹ˆè¦å»ºç«‹ Dep å’Œ Watcher çš„åŒå‘å…³ç³»ï¼Ÿ å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥å›ç­”è¿™äº›é—®é¢˜äº†ï¼š ä¸ºä»€ä¹ˆè¦å»ºç«‹ Dep å’Œ Watcher çš„åŒå‘å…³ç³»ï¼Ÿæ€»æ‰€å‘¨çŸ¥ï¼Œvue æ˜¯ç»„ä»¶åŒ–çš„å‰ç«¯æ¡†æ¶ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¼šå­˜åœ¨ä¸‹é¢è¿™æ ·çš„æƒ…å†µï¼š 12345678910111213141516171819202122232425&lt;body&gt; &lt;div id=&quot;demo&quot;&gt; &lt;h1&gt;Vueç»„ä»¶åŒ–æœºåˆ¶&lt;/h1&gt; &lt;comp :msg=&quot;msg&quot;&gt;&lt;/comp&gt; &lt;/div&gt; &lt;script&gt; Vue.component(&#x27;comp&#x27;, &#123; template: &#x27;&lt;div&gt;I am comp&lt;/div&gt;&#x27;, props: [&#x27;msg&#x27;], data: function() &#123; return &#123; compMsg: this.msg + &#x27;comp&#x27; &#125; &#125;, &#125;) const app = new Vue(&#123; el: &#x27;#demo&#x27;, data() &#123; return &#123; msg: &#x27;hello vue&#x27;, &#125; &#125;, &#125;) &lt;/script&gt; &lt;/body&gt; åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä»…æœ‰ Dep åˆ° Wathcer çš„å…³ç³»æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„äº†ï¼Œæ‰€ä»¥è¿˜éœ€è¦å»ºç«‹ Wathcer åˆ° Dep çš„å…³ç³»ã€‚ å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿè¿™ä¸ªå¾ˆå¥½è§£é‡Šï¼Œå½“ data ä¸­å­˜åœ¨å¯¹è±¡ï¼Œç”šè‡³å¯¹è±¡åµŒå¥—çš„æ—¶å€™ï¼Œä¿®æ”¹å…¶ä¸­çš„å€¼ï¼ŒåŒæ ·éœ€è¦å‡ºå‘è§†å›¾çš„æ›´æ–°ï¼Œè¿™å°±æ˜¯å¯¹è±¡ä¾èµ–ç®¡ç†å™¨çš„ä½œç”¨ã€‚ æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿæœ€ç›´æ¥é€šçŸ¥ Wathcer æ›´æ–°è§†å›¾çš„åœ°æ–¹ã€‚ è¡¥ä¸Šè„‘å›¾ï¼š åˆ°è¿™é‡Œï¼Œå¯¹è±¡çš„å“åº”å¼å¤„ç†å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¯¹äºæ•°ç»„ï¼Œæ˜¯æ€ä¹ˆæ“ä½œçš„ã€‚ å¤„ç†æ•°ç»„æœ‰å‰é¢çš„ç§¯ç´¯ï¼Œå¯ä»¥å¾ˆå¿«å®šä½åˆ°å¤„ç†æ•°ç»„çš„æ–¹æ³•ï¼š 12345678if (Array.isArray(value)) &#123; if (hasProto) &#123; protoAugment(value, arrayMethods) &#125; else &#123; copyAugment(value, arrayMethods, arrayKeys) &#125; this.observeArray(value)&#125; æˆ‘ä»¬å…ˆçœ‹çœ‹ observeArrayï¼Œæ¯•ç«Ÿåå­—éƒ½è¿™ä¹ˆç›´ç™½äº†ï¼š 12345observeArray(items: Array&lt;any&gt;) &#123; for (let i = 0, l = items.length; i &lt; l; i++) &#123; observe(items[i]) &#125;&#125; æ˜¾ç„¶ï¼Œè¿™é‡Œå°±æ˜¯éå†æ•°ç»„ï¼Œå¯¹å…¶æ¯ä¸ªå…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†ã€‚ é‚£ä¹ˆæ¥åˆ° protoAugmentï¼š 12345function protoAugment(target, src: Object) &#123; /* eslint-disable no-proto */ target.__proto__ = src /* eslint-enable no-proto */&#125; ä»è°ƒç”¨å¯ä»¥çœ‹åˆ°ï¼Œtarget æ˜¯ä¸€ä¸ªæ•°ç»„å®ä¾‹ï¼Œé‚£ä¹ˆè¿™é‡Œçš„æ“ä½œå°±æ˜¯è¦†ç›–å…¶åŸå‹ã€‚ é‚£ä¹ˆ src æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ 1export const arrayMethods = Object.create(arrayProto) å…‰çœ‹è¿™ä¸ªå¥½åƒå¹¶ä¸èƒ½çœ‹å‡ºç‚¹ä»€ä¹ˆï¼Œç»“åˆä¸‹é¢çš„ä»£ç å†çœ‹çœ‹ï¼š 123456789101112131415161718192021222324252627const methodsToPatch = [&#x27;push&#x27;, &#x27;pop&#x27;, &#x27;shift&#x27;, &#x27;unshift&#x27;, &#x27;splice&#x27;, &#x27;sort&#x27;, &#x27;reverse&#x27;]/** * Intercept mutating methods and emit events */methodsToPatch.forEach(function (method) &#123; // cache original method const original = arrayProto[method] def(arrayMethods, method, function mutator(...args) &#123; const result = original.apply(this, args) const ob = this.__ob__ let inserted switch (method) &#123; case &#x27;push&#x27;: case &#x27;unshift&#x27;: inserted = args break case &#x27;splice&#x27;: inserted = args.slice(2) break &#125; if (inserted) ob.observeArray(inserted) // notify change ob.dep.notify() return result &#125;)&#125;) æ˜¾ç„¶ï¼Œè¿™é‡Œé€šè¿‡è£…é¥°å™¨æ–¹æ³•å¯¹ methodsToPatch ä¸­çš„ä¸ƒä¸ªæ•°ç»„æ–¹æ³•è¿›è¡Œäº†æ‰©å±•ã€‚ å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š å…ˆæ‰§è¡ŒåŸæ¥çš„æ•°ç»„æ–¹æ³•ï¼ˆåŸæœ‰åŠŸèƒ½ä¸å˜ï¼‰ å¯¹äºæ–°æ’å…¥çš„æ•°æ®ï¼Œ åšå“åº”å¼å¤„ç†ï¼šif (inserted) ob.observeArray(inserted) é€šçŸ¥ watcher æ›´æ–°è§†å›¾ï¼šob.dep.notify() æœ€ç»ˆè„‘å›¾å¦‚ä¸‹ï¼š ç»“è¯­æ›´ä½³é˜…è¯»ä½“éªŒï¼šVue 2.6 æºç åˆ†æä¹‹æ—… - äºŒï¼šæ•°æ®å“åº”å¼ é‚£ä¹ˆæœ¬ç¯‡çš„ç²—æµ…åˆ†æåˆ°æ­¤ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„æ¥æ—¥å†è®®è®ºå§ï¼å’•å’•å’•~ ğŸ¥ ğŸ¥ ğŸ¥","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"Vue 2.6 æºç åˆ†æä¹‹æ—…ã€1ã€‘ â€”â€” åˆå§‹åŒ–æµç¨‹","slug":"2020-08-12_1","date":"2020-08-13T08:04:10.635Z","updated":"2020-08-13T08:04:10.635Z","comments":false,"path":"2020/08/13/2020-08-12_1/","link":"","permalink":"http://yoursite.com/2020/08/13/2020-08-12_1/","excerpt":"Vue æºç è¿˜æ˜¯æ¯”è¾ƒåºå¤§çš„ï¼Œå¦‚æœåˆ†ææºç æ²¡æœ‰æ¡ç†ï¼Œç›´æ¥ä¸€å¤´æ‰è¿›å»ï¼Œå¾ˆå®¹æ˜“é™·è¿›ä»£ç æµ·ä¸­ï¼Œä¸€é€šåˆ†æä¸‹æ¥ä¸€å¤´é›¾æ°´ï¼Œè¿˜æ‰“å‡»ä¿¡å¿ƒã€‚ é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåˆ†ææºç å‘¢ï¼Ÿ ä»¥ä¸‹æ˜¯ä¸ªäººæ€»ç»“çš„å‡ ç‚¹ç»éªŒï¼Œå¦‚æœ‰è°¬è¯¯ä¹‹å¤„ï¼Œæœ›æŒ‡å‡ºï¼š é¦–è¦ä»»åŠ¡æ˜¯æ‰¾åˆ°å…¥å£ï¼Œå¦‚ Vue åˆ™æ‰¾åˆ°å…¶æ„é€ å‡½æ•° å…ˆç†æ¸…ä¸»çº¿ï¼Œååˆ†æå®ç°ï¼Œåˆ«è¢«ç»†ææœ«èŠ‚çš„ä»£ç å½±å“æ€è·¯ é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å°è¯•æ‰¾æ‰¾ Vue çš„æ„é€ å‡½æ•°å§ï¼","text":"Vue æºç è¿˜æ˜¯æ¯”è¾ƒåºå¤§çš„ï¼Œå¦‚æœåˆ†ææºç æ²¡æœ‰æ¡ç†ï¼Œç›´æ¥ä¸€å¤´æ‰è¿›å»ï¼Œå¾ˆå®¹æ˜“é™·è¿›ä»£ç æµ·ä¸­ï¼Œä¸€é€šåˆ†æä¸‹æ¥ä¸€å¤´é›¾æ°´ï¼Œè¿˜æ‰“å‡»ä¿¡å¿ƒã€‚ é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåˆ†ææºç å‘¢ï¼Ÿ ä»¥ä¸‹æ˜¯ä¸ªäººæ€»ç»“çš„å‡ ç‚¹ç»éªŒï¼Œå¦‚æœ‰è°¬è¯¯ä¹‹å¤„ï¼Œæœ›æŒ‡å‡ºï¼š é¦–è¦ä»»åŠ¡æ˜¯æ‰¾åˆ°å…¥å£ï¼Œå¦‚ Vue åˆ™æ‰¾åˆ°å…¶æ„é€ å‡½æ•° å…ˆç†æ¸…ä¸»çº¿ï¼Œååˆ†æå®ç°ï¼Œåˆ«è¢«ç»†ææœ«èŠ‚çš„ä»£ç å½±å“æ€è·¯ é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å°è¯•æ‰¾æ‰¾ Vue çš„æ„é€ å‡½æ•°å§ï¼ å¯»æ‰¾æ„é€ å‡½æ•°å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è°ƒè¯•å™¨ï¼Œç”¨æœ€ç›´æ¥çš„åŠæ³•å®šä½åˆ°å…¥å£æ–‡ä»¶ã€‚ é¦–å…ˆç¼–å†™æµ‹è¯• demoï¼Œå°†æ–­ç‚¹å®šåœ¨ new Vue(&#123;&#125;) å¤„ï¼Œé€šè¿‡ f11 è¿›å…¥æ„é€ å‡½æ•°ï¼Œç„¶åé€šè¿‡é¼ æ ‡å³é”®å®šä½åˆ°ç›®æ ‡æ–‡ä»¶ï¼š 123456function Vue(options) &#123; if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; !(this instanceof Vue)) &#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125; this._init(options)&#125; æ˜¾ç„¶ï¼Œè¿™å°±æ˜¯ Vue çš„æ„é€ å‡½æ•°äº†ï¼Œå…¶æ–‡ä»¶è·¯å¾„ä¸ºï¼šsrc/core/instance/index.js ã€‚ å½“ç„¶ï¼Œä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿå¿«é€Ÿæœ‰æ•ˆçš„å®šä½åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œè¿™èƒ½æé«˜æˆ‘ä»¬çš„åˆ†ææ•ˆç‡ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹å¦ä¸€ç§ç±»ä¼¼è§£å¯†çš„åˆ†ææ€è·¯ï¼Œä»è››ä¸é©¬è¿¹ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼š é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ pakage.jsonï¼š 1&quot;dev&quot;: &quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev&quot; ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š é…ç½®æ–‡ä»¶æ˜¯ scripts/config.js ç¯å¢ƒå˜é‡æ˜¯ TARGET:web-full-dev é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ° scripts/config.jsï¼Œå®šä½åˆ° web-full-devï¼š 12345678&#x27;web-full-dev&#x27;: &#123; entry: resolve(&#x27;web/entry-runtime-with-compiler.js&#x27;), dest: resolve(&#x27;dist/vue.js&#x27;), format: &#x27;umd&#x27;, env: &#x27;development&#x27;, alias: &#123; he: &#x27;./entity-decoder&#x27; &#125;, banner &#125;, ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¥å£æ–‡ä»¶æ˜¯ web/entry-runtime-with-compiler.jsï¼Œä½†è¿™ä¸ª web æ˜¯å“ªä¸ªç›®å½•å‘¢ï¼Ÿåœ¨ vscode ä¸­åˆ©ç”¨ ctrl + é¼ æ ‡å·¦é”® å¯ä»¥æ¥åˆ° resolve å‡½æ•°çš„å®šä¹‰å¤„ï¼š 123456789const resolve = (p) =&gt; &#123; // web/... const base = p.split(&#x27;/&#x27;)[0] if (aliases[base]) &#123; return path.resolve(aliases[base], p.slice(base.length + 1)) &#125; else &#123; return path.resolve(__dirname, &#x27;../&#x27;, p) &#125;&#125; è¿™é‡Œ resolve æ–¹æ³•çš„è¿”å›æ˜¯ aliases[base] + pathï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ aliases æ˜¯ä»€ä¹ˆï¼š 12345678910module.exports = &#123; vue: resolve(&#x27;src/platforms/web/entry-runtime-with-compiler&#x27;), compiler: resolve(&#x27;src/compiler&#x27;), core: resolve(&#x27;src/core&#x27;), shared: resolve(&#x27;src/shared&#x27;), web: resolve(&#x27;src/platforms/web&#x27;), weex: resolve(&#x27;src/platforms/weex&#x27;), server: resolve(&#x27;src/server&#x27;), sfc: resolve(&#x27;src/sfc&#x27;),&#125; åˆ°è¿™é‡Œï¼Œç»“æœå°±å‡ºæ¥äº†ï¼Œå…¥å£æ–‡ä»¶æ˜¯ï¼šsrc/platforms/web/entry-runtime-with-compiler.jsï¼Œæ¥åˆ°è®©æˆ‘ä»¬æ¥åˆ°è¿™ä¸ªæ–‡ä»¶ï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263const mount = Vue.prototype.$mountVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; query(el) /* istanbul ignore if */ if (el === document.body || el === document.documentElement) &#123; process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; warn(`Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.`) return this &#125; const options = this.$options if (!options.render) &#123; let template = options.template if (template) &#123; if (typeof template === &#x27;string&#x27;) &#123; if (template.charAt(0) === &#x27;#&#x27;) &#123; template = idToTemplate(template) /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; !template) &#123; warn(`Template element not found or is empty: $&#123;options.template&#125;`, this) &#125; &#125; &#125; else if (template.nodeType) &#123; template = template.innerHTML &#125; else &#123; if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; warn(&#x27;invalid template option:&#x27; + template, this) &#125; return this &#125; &#125; else if (el) &#123; template = getOuterHTML(el) &#125; if (template) &#123; /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(&#x27;compile&#x27;) &#125; const &#123; render, staticRenderFns &#125; = compileToFunctions( template, &#123; outputSourceRange: process.env.NODE_ENV !== &#x27;production&#x27;, shouldDecodeNewlines, shouldDecodeNewlinesForHref, delimiters: options.delimiters, comments: options.comments, &#125;, this ) options.render = render options.staticRenderFns = staticRenderFns /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; config.performance &amp;&amp; mark) &#123; mark(&#x27;compile end&#x27;) measure(`vue $&#123;this._name&#125; compile`, &#x27;compile&#x27;, &#x27;compile end&#x27;) &#125; &#125; &#125; return mount.call(this, el, hydrating)&#125; è¿™ä¸ªæ–‡ä»¶æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯æ‰©å±•äº† web å¹³å°éœ€è¦çš„ $mountï¼Œè¿™ä¹Ÿè¯´æ˜åŸºæœ¬çš„ $mount æ˜¯ä¸æ»¡è¶³ web å¹³å°çš„éœ€æ±‚çš„ã€‚ åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œèƒ½çœ‹åˆ°ä»¥ä¸‹æ¯”è¾ƒé‡è¦çš„é€»è¾‘ï¼š å¦‚æœå­˜åœ¨ render å‡½æ•°ï¼Œåˆ™ä¸å†å…³æ³¨ template å’Œ el å½“ä¸å­˜åœ¨ render å‡½æ•°ï¼Œåˆ™ä¼˜å…ˆå…³æ³¨ template å½“åŒæ—¶ä¸å­˜åœ¨ render å’Œ templateï¼Œåˆ™æœ€ç»ˆé€‰æ‹© elï¼Œå¹¶ä¸”é€šè¿‡ getOuterHTML å°†å…¶è½¬åŒ–ä¸º template å¤„ç†å®Œä¸Šé¢çš„é€»è¾‘ä¹‹åå°† template é€šè¿‡ compileToFunctions ç¼–è¯‘æˆ render å‡½æ•° æœ€åè°ƒç”¨ mount å°†å†…å®¹æŒ‚è½½åˆ° root èŠ‚ç‚¹ä¸Š ä¼˜å…ˆçº§ï¼šrender &gt; template &gt; el è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Vue æ˜¯å¤–éƒ¨å¼•å…¥çš„ï¼Œä½ç½®å¦‚ä¸‹ï¼š 1import Vue from &#x27;./runtime/index&#x27; éšæœºæ¥åˆ°ç›®æ ‡æ–‡ä»¶ src/platforms/webs/runtime/index.jsï¼š 123456Vue.prototype.__patch__ = inBrowser ? patch : noopVue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; inBrowser ? query(el) : undefined return mountComponent(this, el, hydrating)&#125; å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ä¸»è¦åšäº†ä¸€äº›å¯¹ vue æ‰©å±•çš„äº‹æƒ…ï¼Œæœ€ä¸ºå…³é”®çš„ä¸¤ç‚¹åˆ™æ˜¯ä¸Šé¢ä»£ç ä¸­çš„éƒ¨åˆ†ï¼š å®‰è£…äº†å¹³å°ç‰¹æœ‰çš„ __patch__ å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†è™šæ‹Ÿ dom è½¬åŒ–æˆçœŸå® domï¼Œè€Œ diff ä¹Ÿå°†åœ¨è¿™é‡Œå‘ç”Ÿ å®ç°äº† $mountï¼Œä¸è¿‡è¿™é‡Œä¹Ÿåªæ˜¯å¯¹ mountComponent çš„ä¸€å±‚å°è£…ï¼Œå¹¶æ²¡æœ‰è§¦åŠçœŸæ­£çš„åŠŸèƒ½ä»£ç  æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­é¡ºç€å¼•å…¥ Vue çš„çº¿ç´¢æ¨è¿›ï¼š 1import Vue from &#x27;core/index&#x27; äºæ˜¯æ¥åˆ°æ–‡ä»¶ src/core/indexï¼š 1initGlobalAPI(Vue) æ–‡ä»¶çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯åˆå§‹åŒ–å…¨å±€çš„ APIï¼Œäºæ˜¯ç¦»å¼€è¿™é‡Œï¼Œç»§ç»­æ·±å…¥ï¼š 1import Vue from &#x27;./instance/index&#x27; ç»ˆäºæ¥åˆ°äº† Vue çš„æ„é€ å‡½æ•°ï¼Œä»£ç åœ¨æœ€ä¸Šé¢å·²ç»è´´å‡ºï¼Œè¿™é‡Œå°±ä¸å†è´´äº†ã€‚ è„‘å›¾å¦‚ä¸‹ï¼š åˆå§‹åŒ–æµç¨‹åˆ†æè¦åˆ†æ Vue åˆå§‹åŒ–æµç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ„é€ å‡½æ•°æ–‡ä»¶å§ï¼š 123456789101112131415161718192021import &#123; initMixin &#125; from &#x27;./init&#x27;import &#123; stateMixin &#125; from &#x27;./state&#x27;import &#123; renderMixin &#125; from &#x27;./render&#x27;import &#123; eventsMixin &#125; from &#x27;./events&#x27;import &#123; lifecycleMixin &#125; from &#x27;./lifecycle&#x27;import &#123; warn &#125; from &#x27;../util/index&#x27;function Vue(options) &#123; if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; !(this instanceof Vue)) &#123; warn(&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;) &#125; this._init(options)&#125;initMixin(Vue)stateMixin(Vue)eventsMixin(Vue)lifecycleMixin(Vue)renderMixin(Vue)export default Vue å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œäº†ä¸€ä¸ª this._init() æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä»ä½•è€Œæ¥å‘¢ï¼Ÿ æˆ‘ä»¬å¾€ä¸‹ï¼Œå‘ç° initMixin(Vue) è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™åº”è¯¥æ˜¯ä¸º Vue æ‰©å±• init çš„æ–¹æ³•ï¼Œäºæ˜¯è·³è½¬è¿›å»çœ‹çœ‹ï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152export function initMixin(Vue: Class&lt;Component&gt;) &#123; Vue.prototype._init = function (options?: Object) &#123; const vm: Component = this vm._uid = uid++ let startTag, endTag /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; config.performance &amp;&amp; mark) &#123; startTag = `vue-perf-start:$&#123;vm._uid&#125;` endTag = `vue-perf-end:$&#123;vm._uid&#125;` mark(startTag) &#125; // a flag to avoid this being observed vm._isVue = true if (options &amp;&amp; options._isComponent) &#123; // optimize internal component instantiation // since dynamic options merging is pretty slow, and none of the // internal component options needs special treatment. initInternalComponent(vm, options) &#125; else &#123; vm.$options = mergeOptions(resolveConstructorOptions(vm.constructor), options || &#123;&#125;, vm) &#125; /* istanbul ignore else */ if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; initProxy(vm) &#125; else &#123; vm._renderProxy = vm &#125; // expose real self vm._self = vm initLifecycle(vm) initEvents(vm) initRender(vm) callHook(vm, &#x27;beforeCreate&#x27;) initInjections(vm) initState(vm) initProvide(vm) callHook(vm, &#x27;created&#x27;) /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; config.performance &amp;&amp; mark) &#123; vm._name = formatComponentName(vm, false) mark(endTag) measure(`vue $&#123;vm._name&#125; init`, startTag, endTag) &#125; if (vm.$options.el) &#123; vm.$mount(vm.$options.el) &#125; &#125;&#125; æœç„¶ï¼Œ_init() æ˜¯åœ¨è¿™é‡Œæ‰©å±•çš„ï¼Œå®ƒåšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ ä»”ç»†é˜…è¯»åå¯ä»¥çŸ¥é“ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½æœ‰ä¸¤ç‚¹ï¼š è¿›è¡Œå„ç§åˆå§‹åŒ–æ“ä½œ å¦‚æœè®¾ç½®äº† elï¼Œåˆ™è‡ªåŠ¨è°ƒç”¨ $mount è¿›è¡ŒæŒ‚è½½ ç»§ç»­æ·±å…¥ï¼Œæ¥çœ‹çœ‹å…·ä½“æ‰§è¡Œäº†å“ªäº›åˆå§‹åŒ–æ“ä½œï¼š 12345678initLifecycle(vm)initEvents(vm)initRender(vm)callHook(vm, &#x27;beforeCreate&#x27;)initInjections(vm)initState(vm)initProvide(vm)callHook(vm, &#x27;created&#x27;) æˆ‘ä»¬é€ä¸€åˆ†æï¼š initLifecycle(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/lifecycle.js 12345678910111213141516171819202122232425export function initLifecycle(vm: Component) &#123; const options = vm.$options // locate first non-abstract parent let parent = options.parent if (parent &amp;&amp; !options.abstract) &#123; while (parent.$options.abstract &amp;&amp; parent.$parent) &#123; parent = parent.$parent &#125; parent.$children.push(vm) &#125; vm.$parent = parent vm.$root = parent ? parent.$root : vm vm.$children = [] vm.$refs = &#123;&#125; vm._watcher = null vm._inactive = null vm._directInactive = false vm._isMounted = false vm._isDestroyed = false vm._isBeingDestroyed = false&#125; è¿™é‡Œä¸»è¦åˆå§‹åŒ–äº†ä»¥ä¸‹å…³ç³»ï¼š $root $parent $children $refs initEvents(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/events.js 123456789export function initEvents(vm: Component) &#123; vm._events = Object.create(null) vm._hasHookEvent = false // init parent attached events const listeners = vm.$options._parentListeners if (listeners) &#123; updateComponentListeners(vm, listeners) &#125;&#125; è¿™é‡Œåˆå§‹åŒ–äº†äº‹ä»¶çš„ç›‘å¬è€…ã€‚ initRender(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/render.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546export function initRender(vm: Component) &#123; vm._vnode = null // the root of the child tree vm._staticTrees = null // v-once cached trees const options = vm.$options const parentVnode = (vm.$vnode = options._parentVnode) // the placeholder node in parent tree const renderContext = parentVnode &amp;&amp; parentVnode.context vm.$slots = resolveSlots(options._renderChildren, renderContext) vm.$scopedSlots = emptyObject // bind the createElement fn to this instance // so that we get proper render context inside it. // args order: tag, data, children, normalizationType, alwaysNormalize // internal version is used by render functions compiled from templates vm._c = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, false) // normalization is always applied for the public version, used in // user-written render functions. vm.$createElement = (a, b, c, d) =&gt; createElement(vm, a, b, c, d, true) // $attrs &amp; $listeners are exposed for easier HOC creation. // they need to be reactive so that HOCs using them are always updated const parentData = parentVnode &amp;&amp; parentVnode.data /* istanbul ignore else */ if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; defineReactive( vm, &#x27;$attrs&#x27;, (parentData &amp;&amp; parentData.attrs) || emptyObject, () =&gt; &#123; !isUpdatingChildComponent &amp;&amp; warn(`$attrs is readonly.`, vm) &#125;, true ) defineReactive( vm, &#x27;$listeners&#x27;, options._parentListeners || emptyObject, () =&gt; &#123; !isUpdatingChildComponent &amp;&amp; warn(`$listeners is readonly.`, vm) &#125;, true ) &#125; else &#123; defineReactive(vm, &#x27;$attrs&#x27;, (parentData &amp;&amp; parentData.attrs) || emptyObject, null, true) defineReactive(vm, &#x27;$listeners&#x27;, options._parentListeners || emptyObject, null, true) &#125;&#125; è¿™é‡Œä¸»è¦åˆå§‹åŒ–äº†ä¸¤ä¸ªæ–¹æ³•ï¼š $slots $createElement callHook(vm, â€˜beforeCreateâ€™)ä¸€ç›´åˆ°è¿™é‡Œï¼Œéƒ½å¤„äº Vue ç”Ÿå‘½å‘¨æœŸä¸­çš„ beforeCreateï¼Œè€Œä¸Šé¢çš„ä»£ç ä¸­å®Œå…¨æ²¡æœ‰å¯¹ data çš„å¤„ç†ï¼Œæ‰€ä»¥åœ¨ beforeCreate ä¸­æ˜¾ç„¶æ˜¯æ— æ³•è·å–åˆ° data çš„ã€‚ initInjections(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/inject.js 12345678910111213141516171819202122export function initInjections(vm: Component) &#123; const result = resolveInject(vm.$options.inject, vm) if (result) &#123; toggleObserving(false) Object.keys(result).forEach((key) =&gt; &#123; /* istanbul ignore else */ if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; defineReactive(vm, key, result[key], () =&gt; &#123; warn( `Avoid mutating an injected value directly since the changes will be ` + `overwritten whenever the provided component re-renders. ` + `injection being mutated: &quot;$&#123;key&#125;&quot;`, vm ) &#125;) &#125; else &#123; defineReactive(vm, key, result[key]) &#125; &#125;) toggleObserving(true) &#125;&#125; è¿™é‡Œæ³¨å…¥äº†ç¥–è¾ˆä¸­çš„æ•°æ®ï¼Œä»¥ä¾¿åœ¨åé¢æ¥æ”¶ã€‚ initState(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/state.js 123456789101112131415export function initState(vm: Component) &#123; vm._watchers = [] const opts = vm.$options if (opts.props) initProps(vm, opts.props) if (opts.methods) initMethods(vm, opts.methods) if (opts.data) &#123; initData(vm) &#125; else &#123; observe((vm._data = &#123;&#125;), true /* asRootData */) &#125; if (opts.computed) initComputed(vm, opts.computed) if (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123; initWatch(vm, opts.watch) &#125;&#125; å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåˆå§‹åŒ–äº†æˆ‘ä»¬ç†ŸçŸ¥çš„å¯¹è±¡ï¼š props methods data computed watch ä»æµç¨‹ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œdata æ˜¯æ™šäº propsï¼Œå…ˆäº computed çš„ï¼Œè¿™ä¹Ÿèƒ½è§£å†³å¹³æ—¶å¾ˆå¤šå›°æ‰°æˆ‘ä»¬çš„é—®é¢˜ã€‚ initProvide(vm)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/inject.js 123456export function initProvide(vm: Component) &#123; const provide = vm.$options.provide if (provide) &#123; vm._provided = typeof provide === &#x27;function&#x27; ? provide.call(vm) : provide &#125;&#125; è¿™é‡Œå¯¹å‰é¢æ³¨å…¥çš„æ•°æ®è¿›è¡Œäº†æ¥æ”¶ã€‚ callHook(vm, â€˜createdâ€™)è¿™é‡Œè°ƒç”¨ç”Ÿå‘½é’©å­ï¼Œè¯´æ˜åˆ° created é˜¶æ®µï¼Œç»„ä»¶å·²ç»æˆåŠŸåˆ›å»ºï¼Œæ‰€ä»¥åˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆã€‚ ä¸‹é¢è´´ä¸Šè„‘å›¾ï¼Œæ–¹ä¾¿å¤§å®¶å‚è€ƒï¼š æ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ°æ„é€ å‡½æ•°ï¼Œçœ‹çœ‹å‰©ä¸‹çš„ Mixin éƒ½åšäº†äº›ä»€ä¹ˆï¼š 12345initMixin(Vue)stateMixin(Vue)eventsMixin(Vue)lifecycleMixin(Vue)renderMixin(Vue) initMixin() ä¸Šé¢åˆšåˆ†æå®Œï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹çœ‹ä¸‹é¢çš„ Mixin éƒ½åšäº†äº›ä»€ä¹ˆå§ï¼ stateMixin(Vue)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/state.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546export function stateMixin(Vue: Class&lt;Component&gt;) &#123; // flow somehow has problems with directly declared definition object // when using Object.defineProperty, so we have to procedurally build up // the object here. const dataDef = &#123;&#125; dataDef.get = function () &#123; return this._data &#125; const propsDef = &#123;&#125; propsDef.get = function () &#123; return this._props &#125; if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; dataDef.set = function () &#123; warn(&#x27;Avoid replacing instance root $data. &#x27; + &#x27;Use nested data properties instead.&#x27;, this) &#125; propsDef.set = function () &#123; warn(`$props is readonly.`, this) &#125; &#125; Object.defineProperty(Vue.prototype, &#x27;$data&#x27;, dataDef) Object.defineProperty(Vue.prototype, &#x27;$props&#x27;, propsDef) Vue.prototype.$set = set Vue.prototype.$delete = del Vue.prototype.$watch = function (expOrFn: string | Function, cb: any, options?: Object): Function &#123; const vm: Component = this if (isPlainObject(cb)) &#123; return createWatcher(vm, expOrFn, cb, options) &#125; options = options || &#123;&#125; options.user = true const watcher = new Watcher(vm, expOrFn, cb, options) if (options.immediate) &#123; try &#123; cb.call(vm, watcher.value) &#125; catch (error) &#123; handleError(error, vm, `callback for immediate watcher &quot;$&#123;watcher.expression&#125;&quot;`) &#125; &#125; return function unwatchFn() &#123; watcher.teardown() &#125; &#125;&#125; å…¶å®é¡¾åæ€ä¹‰ï¼Œå·²ç»èƒ½å¤§è‡´çŒœåˆ°è¿™é‡Œçš„åŠŸèƒ½äº†ï¼ˆpsï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„å‘½åè§„èŒƒå¸¦æ¥çš„å¥½å¤„ï¼‰ã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç»“åˆä»£ç åˆ†æï¼Œè¿™é‡Œæ‰©å±•äº†ä»¥ä¸‹åŠŸèƒ½ï¼š $data $props $set $delete $watch eventsMixin(Vue)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/events.js 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192export function eventsMixin(Vue: Class&lt;Component&gt;) &#123; const hookRE = /^hook:/ Vue.prototype.$on = function (event: string | Array&lt;string&gt;, fn: Function): Component &#123; const vm: Component = this if (Array.isArray(event)) &#123; for (let i = 0, l = event.length; i &lt; l; i++) &#123; vm.$on(event[i], fn) &#125; &#125; else &#123; ;(vm._events[event] || (vm._events[event] = [])).push(fn) // optimize hook:event cost by using a boolean flag marked at registration // instead of a hash lookup if (hookRE.test(event)) &#123; vm._hasHookEvent = true &#125; &#125; return vm &#125; Vue.prototype.$once = function (event: string, fn: Function): Component &#123; const vm: Component = this function on() &#123; vm.$off(event, on) fn.apply(vm, arguments) &#125; on.fn = fn vm.$on(event, on) return vm &#125; Vue.prototype.$off = function (event?: string | Array&lt;string&gt;, fn?: Function): Component &#123; const vm: Component = this // all if (!arguments.length) &#123; vm._events = Object.create(null) return vm &#125; // array of events if (Array.isArray(event)) &#123; for (let i = 0, l = event.length; i &lt; l; i++) &#123; vm.$off(event[i], fn) &#125; return vm &#125; // specific event const cbs = vm._events[event] if (!cbs) &#123; return vm &#125; if (!fn) &#123; vm._events[event] = null return vm &#125; // specific handler let cb let i = cbs.length while (i--) &#123; cb = cbs[i] if (cb === fn || cb.fn === fn) &#123; cbs.splice(i, 1) break &#125; &#125; return vm &#125; Vue.prototype.$emit = function (event: string): Component &#123; const vm: Component = this if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; const lowerCaseEvent = event.toLowerCase() if (lowerCaseEvent !== event &amp;&amp; vm._events[lowerCaseEvent]) &#123; tip( `Event &quot;$&#123;lowerCaseEvent&#125;&quot; is emitted in component ` + `$&#123;formatComponentName(vm)&#125; but the handler is registered for &quot;$&#123;event&#125;&quot;. ` + `Note that HTML attributes are case-insensitive and you cannot use ` + `v-on to listen to camelCase events when using in-DOM templates. ` + `You should probably use &quot;$&#123;hyphenate(event)&#125;&quot; instead of &quot;$&#123;event&#125;&quot;.` ) &#125; &#125; let cbs = vm._events[event] if (cbs) &#123; cbs = cbs.length &gt; 1 ? toArray(cbs) : cbs const args = toArray(arguments, 1) const info = `event handler for &quot;$&#123;event&#125;&quot;` for (let i = 0, l = cbs.length; i &lt; l; i++) &#123; invokeWithErrorHandling(cbs[i], vm, args, vm, info) &#125; &#125; return vm &#125;&#125; è¿™é‡Œæ˜¯æ‰©å±•äº‹ä»¶ç›¸å…³çš„æ–¹æ³•ï¼š $on $once - è¿™ä¸ªæ–¹æ³•åœ¨å¹³æ—¶ä¸šåŠ¡å¼€å‘ä¸­éå¸¸å°‘ç”¨ $off $emit lifecycleMixin(Vue)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/lifecycle.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879808182export function lifecycleMixin(Vue: Class&lt;Component&gt;) &#123; Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) &#123; const vm: Component = this const prevEl = vm.$el const prevVnode = vm._vnode const restoreActiveInstance = setActiveInstance(vm) vm._vnode = vnode // Vue.prototype.__patch__ is injected in entry points // based on the rendering backend used. if (!prevVnode) &#123; // initial render vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */) &#125; else &#123; // updates vm.$el = vm.__patch__(prevVnode, vnode) &#125; restoreActiveInstance() // update __vue__ reference if (prevEl) &#123; prevEl.__vue__ = null &#125; if (vm.$el) &#123; vm.$el.__vue__ = vm &#125; // if parent is an HOC, update its $el as well if (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123; vm.$parent.$el = vm.$el &#125; // updated hook is called by the scheduler to ensure that children are // updated in a parent&#x27;s updated hook. &#125; Vue.prototype.$forceUpdate = function () &#123; const vm: Component = this if (vm._watcher) &#123; vm._watcher.update() &#125; &#125; Vue.prototype.$destroy = function () &#123; const vm: Component = this if (vm._isBeingDestroyed) &#123; return &#125; callHook(vm, &#x27;beforeDestroy&#x27;) vm._isBeingDestroyed = true // remove self from parent const parent = vm.$parent if (parent &amp;&amp; !parent._isBeingDestroyed &amp;&amp; !vm.$options.abstract) &#123; remove(parent.$children, vm) &#125; // teardown watchers if (vm._watcher) &#123; vm._watcher.teardown() &#125; let i = vm._watchers.length while (i--) &#123; vm._watchers[i].teardown() &#125; // remove reference from data ob // frozen object may not have observer. if (vm._data.__ob__) &#123; vm._data.__ob__.vmCount-- &#125; // call the last hook... vm._isDestroyed = true // invoke destroy hooks on current rendered tree vm.__patch__(vm._vnode, null) // fire destroyed hook callHook(vm, &#x27;destroyed&#x27;) // turn off all instance listeners. vm.$off() // remove __vue__ reference if (vm.$el) &#123; vm.$el.__vue__ = null &#125; // release circular reference (#6759) if (vm.$vnode) &#123; vm.$vnode.parent = null &#125; &#125;&#125; è¿™é‡Œæ‰©å±•äº†ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ï¼š _updateï¼šè¿™æ˜¯æ ¸å¿ƒçš„æ›´æ–°å‡½æ•° $forceUpdate $destroy renderMixin(Vue)æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/render.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364export function renderMixin(Vue: Class&lt;Component&gt;) &#123; // install runtime convenience helpers installRenderHelpers(Vue.prototype) Vue.prototype.$nextTick = function (fn: Function) &#123; return nextTick(fn, this) &#125; Vue.prototype._render = function (): VNode &#123; const vm: Component = this const &#123; render, _parentVnode &#125; = vm.$options if (_parentVnode) &#123; vm.$scopedSlots = normalizeScopedSlots(_parentVnode.data.scopedSlots, vm.$slots, vm.$scopedSlots) &#125; // set parent vnode. this allows render functions to have access // to the data on the placeholder node. vm.$vnode = _parentVnode // render self let vnode try &#123; // There&#x27;s no need to maintain a stack because all render fns are called // separately from one another. Nested component&#x27;s render fns are called // when parent component is patched. currentRenderingInstance = vm vnode = render.call(vm._renderProxy, vm.$createElement) &#125; catch (e) &#123; handleError(e, vm, `render`) // return error render result, // or previous vnode to prevent render error causing blank component /* istanbul ignore else */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; vm.$options.renderError) &#123; try &#123; vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e) &#125; catch (e) &#123; handleError(e, vm, `renderError`) vnode = vm._vnode &#125; &#125; else &#123; vnode = vm._vnode &#125; &#125; finally &#123; currentRenderingInstance = null &#125; // if the returned array contains only a single node, allow it if (Array.isArray(vnode) &amp;&amp; vnode.length === 1) &#123; vnode = vnode[0] &#125; // return empty vnode in case the render function errored out if (!(vnode instanceof VNode)) &#123; if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; Array.isArray(vnode)) &#123; warn( &#x27;Multiple root nodes returned from render function. Render function &#x27; + &#x27;should return a single root node.&#x27;, vm ) &#125; vnode = createEmptyVNode() &#125; // set parent vnode.parent = _parentVnode return vnode &#125;&#125; è¿™é‡Œæ˜¯æ‰©å±•äº†æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•ï¼š $nextTickï¼šè¿™ä¸ªæ–¹æ³•éå¸¸æœ‰æ„æ€ï¼Œåé¢å°†æ·±å…¥åˆ†æ _render è€è§„çŸ©ï¼Œä¸Šè„‘å›¾ï¼š å¦‚æœå†™ä¸€ä¸ªæµ‹è¯• demo è°ƒè¯•ï¼Œä¼šå‘ç°ï¼Œå½“ä¸Šé¢çš„æµç¨‹éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œé¡µé¢ä¸­è¿˜æ²¡æœ‰æ¸²æŸ“å‡ºå¯¹åº”çš„å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰æ‰§è¡Œ vue åˆå§‹åŒ–æœ€é‡è¦çš„ä¸€æ­¥ï¼šæŒ‚è½½ã€‚æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹ vue ä¸­æ˜¯å¦‚ä½•è¿›è¡ŒæŒ‚è½½çš„ã€‚ ç›¸ä¿¡å¤§å®¶å¯¹å‰é¢æåˆ°çš„æµç¨‹ç†Ÿæ‚‰çš„è¯ï¼Œå¯¹ mount åº”è¯¥æœ‰ä¸€å®šçš„å°è±¡ï¼šæ‰“åŒ…å…¥å£æ–‡ä»¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æ‰©å±• mountã€‚ æŒ‚è½½é€šè¿‡åŸºæœ¬åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®ç° mount çš„ä½ç½®ï¼šsrc/platforms/web/runtime/index.js ï¼š 1234Vue.prototype.$mount = function (el?: string | Element, hydrating?: boolean): Component &#123; el = el &amp;&amp; inBrowser ? query(el) : undefined return mountComponent(this, el, hydrating)&#125; å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ mountComponent è¿™ä¸ªæ–¹æ³•å®ç°äº† mount çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè®©æˆ‘ä»¬è¿½è¿›å»çœ‹çœ‹ã€‚ æ–‡ä»¶ä½ç½®ï¼šcore/instance/lifecycle.js ï¼š 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071export function mountComponent(vm: Component, el: ?Element, hydrating?: boolean): Component &#123; vm.$el = el if (!vm.$options.render) &#123; vm.$options.render = createEmptyVNode if (process.env.NODE_ENV !== &#x27;production&#x27;) &#123; /* istanbul ignore if */ if ((vm.$options.template &amp;&amp; vm.$options.template.charAt(0) !== &#x27;#&#x27;) || vm.$options.el || el) &#123; warn( &#x27;You are using the runtime-only build of Vue where the template &#x27; + &#x27;compiler is not available. Either pre-compile the templates into &#x27; + &#x27;render functions, or use the compiler-included build.&#x27;, vm ) &#125; else &#123; warn(&#x27;Failed to mount component: template or render function not defined.&#x27;, vm) &#125; &#125; &#125; callHook(vm, &#x27;beforeMount&#x27;) let updateComponent /* istanbul ignore if */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; config.performance &amp;&amp; mark) &#123; updateComponent = () =&gt; &#123; const name = vm._name const id = vm._uid const startTag = `vue-perf-start:$&#123;id&#125;` const endTag = `vue-perf-end:$&#123;id&#125;` mark(startTag) const vnode = vm._render() mark(endTag) measure(`vue $&#123;name&#125; render`, startTag, endTag) mark(startTag) vm._update(vnode, hydrating) mark(endTag) measure(`vue $&#123;name&#125; patch`, startTag, endTag) &#125; &#125; else &#123; updateComponent = () =&gt; &#123; vm._update(vm._render(), hydrating) &#125; &#125; // we set this to vm._watcher inside the watcher&#x27;s constructor // since the watcher&#x27;s initial patch may call $forceUpdate (e.g. inside child // component&#x27;s mounted hook), which relies on vm._watcher being already defined new Watcher( vm, updateComponent, noop, &#123; before() &#123; if (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123; callHook(vm, &#x27;beforeUpdate&#x27;) &#125; &#125;, &#125;, true /* isRenderWatcher */ ) hydrating = false // manually mounted instance, call mounted on self // mounted is called for render-created child components in its inserted hook if (vm.$vnode == null) &#123; vm._isMounted = true callHook(vm, &#x27;mounted&#x27;) &#125; return vm&#125; ä¸Šé¢çš„æµç¨‹å¹¶ä¸å¤æ‚ï¼š é¦–å…ˆè°ƒç”¨äº† beforeMount é’©å­ éšåè°ƒç”¨äº† updateComponent è¿›è¡Œç»„ä»¶çš„æ›´æ–° ç„¶ååˆ›å»ºäº†ä¸€ä¸ª Wathcerï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨äº† beforeUpdate é’©å­ æœ€åè°ƒç”¨ mounted é’©å­ ä»æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒæŒ‚è½½çš„æ ¸å¿ƒåŠŸèƒ½åº”è¯¥æ˜¯åœ¨ updateComponent è¿›è¡Œçš„ï¼Œè€Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å…ˆæ‰§è¡Œ _render()ï¼Œåæ‰§è¡Œ _update()ã€‚ è€Œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿›å…¥çœ‹çœ‹ï¼š _render()æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/render.js 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455Vue.prototype._render = function (): VNode &#123; const vm: Component = this const &#123; render, _parentVnode &#125; = vm.$options if (_parentVnode) &#123; vm.$scopedSlots = normalizeScopedSlots(_parentVnode.data.scopedSlots, vm.$slots, vm.$scopedSlots) &#125; // set parent vnode. this allows render functions to have access // to the data on the placeholder node. vm.$vnode = _parentVnode // render self let vnode try &#123; // There&#x27;s no need to maintain a stack because all render fns are called // separately from one another. Nested component&#x27;s render fns are called // when parent component is patched. currentRenderingInstance = vm vnode = render.call(vm._renderProxy, vm.$createElement) &#125; catch (e) &#123; handleError(e, vm, `render`) // return error render result, // or previous vnode to prevent render error causing blank component /* istanbul ignore else */ if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; vm.$options.renderError) &#123; try &#123; vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e) &#125; catch (e) &#123; handleError(e, vm, `renderError`) vnode = vm._vnode &#125; &#125; else &#123; vnode = vm._vnode &#125; &#125; finally &#123; currentRenderingInstance = null &#125; // if the returned array contains only a single node, allow it if (Array.isArray(vnode) &amp;&amp; vnode.length === 1) &#123; vnode = vnode[0] &#125; // return empty vnode in case the render function errored out if (!(vnode instanceof VNode)) &#123; if (process.env.NODE_ENV !== &#x27;production&#x27; &amp;&amp; Array.isArray(vnode)) &#123; warn( &#x27;Multiple root nodes returned from render function. Render function &#x27; + &#x27;should return a single root node.&#x27;, vm ) &#125; vnode = createEmptyVNode() &#125; // set parent vnode.parent = _parentVnode return vnode&#125; è¿™é‡Œç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¾—åˆ°è™šæ‹Ÿ dom _update()æ–‡ä»¶ä½ç½®ï¼šsrc/core/instance/lifecycle.js 123456789101112131415161718192021222324252627282930Vue.prototype._update = function (vnode: VNode, hydrating?: boolean) &#123; const vm: Component = this const prevEl = vm.$el const prevVnode = vm._vnode const restoreActiveInstance = setActiveInstance(vm) vm._vnode = vnode // Vue.prototype.__patch__ is injected in entry points // based on the rendering backend used. if (!prevVnode) &#123; // initial render vm.$el = vm.__patch__(vm.$el, vnode, hydrating, false /* removeOnly */) &#125; else &#123; // updates vm.$el = vm.__patch__(prevVnode, vnode) &#125; restoreActiveInstance() // update __vue__ reference if (prevEl) &#123; prevEl.__vue__ = null &#125; if (vm.$el) &#123; vm.$el.__vue__ = vm &#125; // if parent is an HOC, update its $el as well if (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123; vm.$parent.$el = vm.$el &#125; // updated hook is called by the scheduler to ensure that children are // updated in a parent&#x27;s updated hook.&#125; è¿™é‡Œæœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ __patch__ï¼Œå³å°†è™šæ‹Ÿ dom è½¬åŒ–ä¸ºçœŸå® domã€‚ è„‘å›¾å¦‚ä¸‹ï¼š è°ƒè¯•éªŒè¯å‰é¢ä¸€é€šåˆ†æï¼ŒæŒºæœ‰é“ç†ï¼Œä½†åªæ˜¯ç†è®ºå¦‚æ­¤ï¼Œä¸ç¨³ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡è°ƒè¯•å™¨ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œæ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„æƒ³æ³•æ˜¯å¦æ­£ç¡®ï¼š Step 1 - ç¡®å®šåˆå§‹åŒ–å‡½æ•°æµ‹è¯• demo å°±ä¸è´´å‡ºæ¥äº†ï¼Œéšä¾¿ä¸€ä¸ª vue æ ·ä¾‹éƒ½è¡Œï¼Œæˆ‘ä»¬ä» new Vue() å¤„è¿›å…¥å³å¯ï¼š æ˜¾ç„¶ï¼Œè¿™é‡Œåªä¼šæ‰§è¡Œ _initï¼Œä¹Ÿå³æ˜¯è¯´è¿™å°±æ˜¯åˆå§‹åŒ–å‡½æ•°ï¼Œä¹ŸéªŒè¯äº†ä¸Šé¢çš„çŒœæƒ³ã€‚ Step 2 - éªŒè¯æ‰§è¡Œæµç¨‹å‰é¢çŒœæµ‹æ‰§è¡Œ initState(Vue) ä¹‹å‰æ˜¯æ— æ³•è®¿é—®åˆ° data æ•°æ®çš„ï¼Œè¿™ä¸ªä¹Ÿå¾ˆå¥½éªŒè¯ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ‰§è¡Œä¹‹å‰çš„ vmï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ—¶å€™ data å’Œ props éƒ½è¿˜æ— æ³•è®¿é—®ï¼Œæ¥ä¸‹æ¥å•æ­¥æ‰§è¡Œ initState(Vue)ï¼Œå†çœ‹çœ‹ç»“æœï¼š æ˜¾ç„¶ï¼Œè¿™ä¸ªæ—¶å€™ data å·²ç»æœ‰å€¼äº†ï¼Œè€Œ props ä¹‹æ‰€ä»¥è¿˜æ˜¯ undefinedï¼Œæ˜¯å› ä¸ºè¿™é‡Œæœ¬å°±æ²¡æœ‰çˆ¶ç»„ä»¶è¿›è¡Œä¼ å€¼ã€‚ Step 3 - éªŒè¯æŒ‚è½½åŒæ ·ï¼Œæˆ‘ä»¬ç°åœ¨å°†æ–­ç‚¹å®šåœ¨ updateComponent å³å¯ï¼Œæ‰§è¡Œ _update ä¹‹å‰ï¼š æ‰§è¡Œ _update ä¹‹åï¼š ä¸Šé¢çš„ç»“æœä¸æˆ‘ä»¬åˆ†æ vue æºç å¾—æ¥çš„ç»“è®ºæ— å¼‚ï¼Œè¿™èƒ½å¾ˆå¥½çš„æå‡å£«æ°”å’Œä¿¡å¿ƒï¼Œä¸ºæ¥ä¸‹æ¥çš„æºç å­¦ä¹ ä¹‹æ—…æ‰“ä¸‹ä¸é”™çš„åŸºç¡€ã€‚ é‚£ä¹ˆæœ¬ç¯‡çš„ç²—æµ…åˆ†æåˆ°æ­¤ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„æ¥æ—¥å†è®®è®ºå§ï¼ å’•å’•å’•~ ğŸ¥ ğŸ¥ ğŸ¥ ç»“è¯­æ›´ä½³é˜…è¯»ä½“éªŒï¼šVue 2.6 æºç åˆ†æä¹‹æ—… - ä¸€ï¼šåˆå§‹åŒ–æµç¨‹","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"Vue 2.6 æºç åˆ†æä¹‹æ—…ã€0ã€‘ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º","slug":"2020-08-12","date":"2020-08-12T08:49:54.841Z","updated":"2020-08-12T08:49:54.841Z","comments":false,"path":"2020/08/12/2020-08-12/","link":"","permalink":"http://yoursite.com/2020/08/12/2020-08-12/","excerpt":"ä»¥å‰å¾ˆå¤š vue åŸç†ç›¸å…³çš„çŸ¥è¯†ï¼Œæ¯”å¦‚å“åº”å¼ï¼Œæ¯”å¦‚è™šæ‹Ÿ domï¼Œæ¯”å¦‚ diff ç®—æ³•â€¦â€¦ä½†éƒ½æ²¡æœ‰çœŸæ­£æ·±å…¥çš„çœ‹è¿‡æºç ï¼Œæ­£å› ä¸ºæ­¤ï¼Œè¿™äº›çŸ¥è¯†å®›å¦‚ç©ºä¸­æ¥¼é˜ï¼Œç©ºæ´ä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆè¯´æœåŠ›ã€‚æ‰€ä»¥ä»Šå¤©å¼€å§‹å¯¹ vue è¿›è¡Œç²—æµ…çš„æºç åˆ†æã€‚ è¦åˆ†ææºç ï¼Œè‡ªç„¶é¦–å…ˆè¦æ­å»ºè°ƒè¯•ç¯å¢ƒï¼Œè¿™æ ·æ‰å¯ä»¥é€šè¿‡ç¼–å†™æµ‹è¯• demo å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æƒ³è¦åˆ†æçš„ä½ç½®ã€‚ é‚£ä¹ˆå¼€å§‹å§ï¼","text":"ä»¥å‰å¾ˆå¤š vue åŸç†ç›¸å…³çš„çŸ¥è¯†ï¼Œæ¯”å¦‚å“åº”å¼ï¼Œæ¯”å¦‚è™šæ‹Ÿ domï¼Œæ¯”å¦‚ diff ç®—æ³•â€¦â€¦ä½†éƒ½æ²¡æœ‰çœŸæ­£æ·±å…¥çš„çœ‹è¿‡æºç ï¼Œæ­£å› ä¸ºæ­¤ï¼Œè¿™äº›çŸ¥è¯†å®›å¦‚ç©ºä¸­æ¥¼é˜ï¼Œç©ºæ´ä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆè¯´æœåŠ›ã€‚æ‰€ä»¥ä»Šå¤©å¼€å§‹å¯¹ vue è¿›è¡Œç²—æµ…çš„æºç åˆ†æã€‚ è¦åˆ†ææºç ï¼Œè‡ªç„¶é¦–å…ˆè¦æ­å»ºè°ƒè¯•ç¯å¢ƒï¼Œè¿™æ ·æ‰å¯ä»¥é€šè¿‡ç¼–å†™æµ‹è¯• demo å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æƒ³è¦åˆ†æçš„ä½ç½®ã€‚ é‚£ä¹ˆå¼€å§‹å§ï¼ Step 1 - å…‹éš†æºç 1git clone git@github.com:vuejs/vue.git Step 2 - å®‰è£…ç¯å¢ƒ12npm install // å®‰è£…åˆ° phantom æ—¶å°±å¯ä»¥ç»ˆæ­¢äº†npm install rollup -g Step 3 - ä¿®æ”¹è¿è¡Œå‚æ•°æ–‡ä»¶ï¼šroot/pakage.json 12- &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --environment TARGET:web-full-dev&quot;+ &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev&quot; Step 4 - ç¼–è¯‘æºç 1npm run dev Step 5 - æµ‹è¯•è°ƒè¯•æµç¨‹åˆ°è¿™é‡Œï¼Œå¦‚æœåœ¨ root/dist ç›®å½•ä¸‹æ–°ç”Ÿæˆäº†ä¸€ä¸ª vue.js.map æ–‡ä»¶ï¼Œåˆ™è¯´æ˜åº”è¯¥å·²ç»æˆåŠŸå»ºç«‹äº† map æ˜ å°„å…³ç³»ï¼Œè¿™é‡Œåœ¨ root/examples/test-demo ä¸‹å»ºç«‹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š 12345678910111213141516171819&lt;!DOCTYPE html&gt;&lt;html&gt;&lt;head&gt; &lt;script src=&quot;../../dist/vue.js&quot;&gt;&lt;/script&gt;&lt;/head&gt;&lt;body&gt; &lt;div id=&quot;demo&quot;&gt; &lt;h1&gt;Hello &#123;&#123; name &#125;&#125;&lt;/h1&gt; &lt;/div&gt; &lt;script&gt; const app = new Vue(&#123; el: &#x27;#demo&#x27;, data: &#123; name: &#x27;vue&#x27; &#125;, &#125;) &lt;/script&gt;&lt;/body&gt;&lt;/html&gt; æ‰“å¼€è¿™ä¸ªé¡µé¢ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè°ƒè¯•ï¼Œå°†æ–­ç‚¹å®šåœ¨åˆ›å»ºå®ä¾‹çš„è¿™ä¸€è¡Œï¼š æˆåŠŸæ–­ä¸‹æ¥ä¹‹åï¼ŒæŒ‰ f11 è¿›å…¥å‡½æ•°ï¼Œç„¶ååœ¨ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©ï¼šReveal in sidebarï¼Œå¦‚æœå·¦ä¾§ä¾§è¾¹æ ä¸­å‡ºç° vue çš„ç›®å½•ç»“æ„ï¼Œåˆ™è¯´æ˜è°ƒè¯•ç¯å¢ƒå·²ç»æ­å»ºæˆåŠŸï¼š ç»“è¯­æ›´ä½³é˜…è¯»ä½“éªŒï¼šVue 2.6 æºç åˆ†æä¹‹æ—… - é›¶ï¼šè°ƒè¯•ç¯å¢ƒæ­å»º","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"å‰ç«¯é€ è½®å­ã€3ã€‘ â€”â€” mvvm","slug":"2020-08-10","date":"2020-08-11T02:17:56.653Z","updated":"2020-08-11T02:17:56.653Z","comments":false,"path":"2020/08/11/2020-08-10/","link":"","permalink":"http://yoursite.com/2020/08/11/2020-08-10/","excerpt":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue2 çš„å“åº”å¼å®ç°åŸç†ã€‚ è¿™é‡Œæ˜¯å‰è¾ˆç ”ç©¶ vue å“åº”å¼åŸç†ç¼©å†™çš„ä»£ç å’Œæ–‡ç« ï¼Œéå¸¸å…·æœ‰å­¦ä¹ ä»·å€¼ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»å®Œæœ¬æ–‡ä¹‹åç»§ç»­å­¦ä¹ ï¼šã€Šå‰–æ Vue å®ç°åŸç† - å¦‚ä½•å®ç°åŒå‘ç»‘å®š mvvmã€‹","text":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue2 çš„å“åº”å¼å®ç°åŸç†ã€‚ è¿™é‡Œæ˜¯å‰è¾ˆç ”ç©¶ vue å“åº”å¼åŸç†ç¼©å†™çš„ä»£ç å’Œæ–‡ç« ï¼Œéå¸¸å…·æœ‰å­¦ä¹ ä»·å€¼ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»å®Œæœ¬æ–‡ä¹‹åç»§ç»­å­¦ä¹ ï¼šã€Šå‰–æ Vue å®ç°åŸç† - å¦‚ä½•å®ç°åŒå‘ç»‘å®š mvvmã€‹ æ€è·¯æ•´ç†é¦–å…ˆæ¥çœ‹çœ‹å®˜ç½‘ç»™å‡ºçš„ç¤ºä¾‹ï¼š 12345678910&lt;div id=&quot;app&quot;&gt; &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt; &lt;input v-model=&quot;message&quot;&gt;&lt;/div&gt;var app = new Vue(&#123; el: &#x27;#app&#x27;, data: &#123; message: &#x27;Hello Vue!&#x27; &#125;&#125;) è¿™ä¸ªä¾‹å­å¾ˆå¥½çš„å±•ç¤ºäº† mvvm çš„æ ¸å¿ƒåŠŸèƒ½ï¼š æ•°æ®é©±åŠ¨è§†å›¾æ›´æ–° å†ç»“åˆä»£ç çœ‹çœ‹ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œçš„å®šä¹‰å¹¶ä¸å¤æ‚ï¼Œä»…ä»…æ˜¯ï¼š elï¼šæŒ‡å®šè·ŸèŠ‚ç‚¹ dataï¼šå®šä¹‰å“åº”å¼æ•°æ® æ’å€¼è¡¨è¾¾å¼ï¼šæ¸²æŸ“å˜é‡ v-xxxï¼švue æŒ‡ä»¤ ä»ä¸Šé¢æˆ‘ä»¬èƒ½å¾—åˆ°ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ æ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦å¯¹èŠ‚ç‚¹è¿›è¡Œè§£æï¼Œè§£æå…¶ä¸­çš„æ’å€¼è¡¨è¾¾å¼å’Œ v-xxx æŒ‡ä»¤ï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å¯ä»¥å«å®ƒ Compilerã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¯¹ data ä¸­çš„æ•°æ®è¿›è¡ŒåŠ«æŒï¼Œå½“å…¶ä¸­çš„æ•°æ®å‘ç”Ÿ get/set çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å«å®ƒ Observerã€‚æœ€åæˆ‘ä»¬éœ€è¦ç›‘å¬è¿™äº›æ•°æ®ï¼Œå½“ä»–ä»¬å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé€šçŸ¥è§†å›¾å»è¿›è¡Œæ›´æ–°æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å«å®ƒ Watcherã€‚ è¿™é‡Œå¼•ç”¨ä¸€ä¸‹å¤§ä½¬çš„å›¾ï¼š å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¸‰ä¸ªæ¨¡å—ä»¥å¤–ï¼Œè¿™é‡Œè¿˜å¤šäº† Updater å’Œ Depï¼ŒUpdater å€’è¿˜å¥½ç†è§£ï¼Œä½†è¿™ Dep æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ æˆ‘ä»¬çŸ¥é“ï¼Œdata å’Œ view ä¸­çš„æ˜¾ç¤ºå­˜åœ¨å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå¦‚ä¸‹ï¼š 123456789101112131415;&lt;div id=&quot;app&quot;&gt; &lt;p&gt;1: &#123;&#123; data_1 &#125;&#125;&lt;/p&gt; &lt;p&gt;2: &#123;&#123; data_1 &#125;&#125;&lt;/p&gt; &lt;p&gt;3: &#123;&#123; data_2 &#125;&#125;&lt;/p&gt; &lt;p&gt;4: &#123;&#123; data_3 &#125;&#125;&lt;/p&gt; &lt;p&gt;5: &#123;&#123; data_3 &#125;&#125;&lt;/p&gt;&lt;/div&gt;var vm = new Vue(&#123; el: &#x27;#app&#x27;, data: &#123; data_1: 1, data_2: 2, data_3: 3, &#125;,&#125;) ä¸Šé¢çš„ä»£ç ä¸­ï¼š å½“ data_1 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp1 å’Œ p2 éƒ½è¦é‡æ–°æ¸²æŸ“ å½“ data_2 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp3 è¦é‡æ–°æ¸²æŸ“ å½“ data_3 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp4 å’Œ p5 éƒ½è¦é‡æ–°æ¸²æŸ“ æ˜¾ç„¶è¿™éœ€è¦è¢«æ§åˆ¶ç®¡ç†èµ·æ¥ï¼Œå¦åˆ™è§†å›¾çš„æ›´æ–°è‚¯å®šæ˜¯ä¸€å›¢ä¹±ï¼Œè€Œ Dep å°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼š view ä¸­æ¯ä¸€ä¸ªéœ€è¦è¢«æ¸²æŸ“çš„å€¼å¯¹åº”ä¸€ä¸ª Watcher æ¯ä¸€ä¸ªå“åº”å¼å˜é‡å¯¹åº”ä¸€ä¸ª Dep é‚£ä¹ˆæ›´æ–°æµç¨‹å°±åº”è¯¥æ˜¯è¿™æ ·ï¼šå½“æ˜¯æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼ŒObserver é€šçŸ¥å¯¹åº”çš„ Depï¼Œç„¶å Dep é€šçŸ¥è‡ªå·±ç®¡ç†çš„ Watcher è°ƒç”¨ Updater è¿›è¡Œè§†å›¾çš„æ›´æ–°ã€‚ å½“ç„¶ï¼Œæœ€åæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¥å£ä½œä¸ºæ¡¥æ¢ï¼Œå°†ä¸Šé¢çš„å„ä¸ªæ¨¡å—ç»™è”ç³»èµ·æ¥ï¼Œç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„ mvvm æ¡†æ¶ã€‚ å¤§è‡´çš„æ€è·¯å·²ç»æœ‰äº†ï¼Œé‚£ä¹ˆå¼€å§‹å§ï¼Œitâ€™s show timeï¼ åŠŸèƒ½å®ç°Entryé¦–å…ˆå†æ¥çœ‹çœ‹å®˜æ–¹ç¤ºä¾‹ï¼š 12345678910&lt;div id=&quot;app&quot;&gt; &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt; &lt;input v-model=&quot;message&quot;&gt;&lt;/div&gt;var app = new Vue(&#123; el: &#x27;#app&#x27;, data: &#123; message: &#x27;Hello Vue!&#x27; &#125;&#125;) è¿™é‡Œ new äº†ä¸€ä¸ª Vueï¼Œå¹¶ä¸”åªä¼ äº†ä¸€ä¸ª obj è¿›å»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆå¯¹å¤–æš´éœ²çš„å¯¹è±¡ä¹Ÿåº”å½“å¦‚æ­¤ã€‚ æ€»æ‰€å‘¨çŸ¥ï¼Œvue æ˜¯æ³•è¯­è§†å›¾çš„æ„æ€ï¼Œé‚£ä¹ˆè¿™é‡Œå°±ç”¨å®ƒçš„å¥½æœ‹å‹æ¥ä½œä¸ºå‘½åè¯­è¨€å§ 123456789export default Aus &#123; constructor(options = &#123;&#125;)&#123; this.$options = options; this.$el = options.el; this.$data = options.data; if (!this.$el) throw new Error(&quot;è¯·æŒ‡å®šæŒ‚è½½ç‚¹&quot;); &#125;&#125; æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°æ¨¡æ¿çš„è§£æã€‚ Compileræˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Compiler éœ€è¦åšä»€ä¹ˆï¼š é€šè¿‡ el è·å–éœ€è¦è¢«ç¼–è¯‘çš„ root èŠ‚ç‚¹ è¿›è¡Œæ¨¡æ¿ç¼–è¯‘ å°†ç¼–è¯‘åçš„èŠ‚ç‚¹è¦†ç›–åˆ° root èŠ‚ç‚¹çš„ä½ç½® è€Œæ¨¡æ¿ç¼–è¯‘åº”è¯¥æ€ä¹ˆè¿›è¡Œå‘¢ï¼Ÿ é¦–å…ˆæˆ‘ä»¬å¯ä»¥å°†èŠ‚ç‚¹ç¢ç‰‡åŒ–ï¼Œåœ¨å†…å­˜ä¸­å¤„ç† éå†å½“å‰çš„èŠ‚ç‚¹æ ‘ï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ä¸¤ç±»èŠ‚ç‚¹ï¼š å…ƒç´ èŠ‚ç‚¹ï¼šå¤„ç† a-xxx æŒ‡ä»¤ æ–‡æœ¬èŠ‚ç‚¹ï¼šå¤„ç†æ’å€¼è¡¨è¾¾å¼ å°†ç¼–è¯‘å¥½çš„èŠ‚ç‚¹ç¢ç‰‡ append åˆ° root èŠ‚ç‚¹ä¸Š é‚£ä¹ˆæˆ‘ä»¬çš„é—®é¢˜å°±æ¥åˆ°äº†å¦‚ä½•å¤„ç†æ–‡æœ¬å’Œå…ƒç´ èŠ‚ç‚¹ï¼š å…ƒç´ èŠ‚ç‚¹ï¼šnode.attributes æ–‡æœ¬èŠ‚ç‚¹ï¼šæ­£åˆ™è¡¨è¾¾å¼ è¿›è¿‡ä¸Šé¢ä¸€é€šåˆ†æï¼Œæ•´ä¸ªç»“æ„å·²ç»æ¯”è¾ƒæ¸…æ™°äº†ï¼Œè¿™é‡Œå†è¡¥ä¸Šè„‘å›¾ï¼š 1234567891011121314&lt;div id=&quot;app&quot;&gt; &lt;p&gt;å•å±‚ï¼š&#123;&#123; msg &#125;&#125;&lt;/p&gt; &lt;p a-text=&quot;msg&quot;&gt;&lt;/p&gt;&lt;/div&gt;&lt;script type=&quot;module&quot;&gt; import Aus from &#x27;./aus.js&#x27; const am = new Aus(&#123; el: &#x27;#app&#x27;, data: &#123; msg: &#x27;Hello Aussicht!&#x27;, &#125; &#125;)&lt;/script&gt; æ•ˆæœå¦‚ä¸‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå·²ç»æˆåŠŸå°† a-text å’Œæ’å€¼è¡¨è¾¾å¼æ›¿æ¢æˆäº†æˆ‘ä»¬æƒ³è¦æ¸²æŸ“çš„å˜é‡äº†ã€‚ æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³è¦å®ç°çš„æ•ˆæœæ˜¯å½“æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè§†å›¾ä¹Ÿéšä¹‹æ›´æ–°ï¼Œé‚£ä¹ˆé¦–å…ˆåº”è¯¥å®ç°çš„æ˜¯ Observerã€‚ ObserveråŒæ ·çš„ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Observer éœ€è¦åšä»€ä¹ˆã€‚ äº‹å®ä¸Šï¼Œä»…ä»…è€ƒè™‘æ•°æ®åŠ«æŒè¿™ä¸€å±‚é¢çš„è¯ï¼ŒObserver éœ€è¦å®ç°çš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ Object.defineProperty å¯¹ data è¿›è¡Œä»£ç†å³å¯ã€‚ æµç¨‹å¾ˆç®€å•ï¼š è·å– data çš„æ‰€æœ‰ keyï¼Œå¯¹å…¶è¿›è¡ŒåŠ«æŒ å¦‚æœ data çš„ key ä¸º objï¼Œåˆ™é€’å½’ è„‘å›¾å¦‚ä¸‹ï¼š æœ¬æ–‡ä¸»è¦æ˜¯ç®€å•æ¢è®¨ä¸€ä¸‹ mvvm å®ç°åŸç†ï¼Œè¿™é‡Œå¯¹äºæ•°ç»„å°±ä¸åšå¤„ç†äº†ã€‚ ä»£ç å¾ˆç®€å•ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ€è·¯è¿›è¡Œå®ç°å³å¯ï¼š 12345678910111213141516171819202122232425262728293031323334353637import Dep from &#x27;./dep.js&#x27;class Observer &#123; constructor(data) &#123; this.data = data this.observe(this.data) &#125; observe(data) &#123; if (data &amp;&amp; typeof data === &#x27;object&#x27;) &#123; Object.keys(data).forEach((key) =&gt; &#123; this.defineReactive(data, key, data[key]) &#125;) &#125; &#125; defineReactive(obj, key, value) &#123; this.observe(value) Object.defineProperty(obj, key, &#123; enumerable: true, configurable: false, get: (_) =&gt; &#123; return value &#125;, set: (newVal) =&gt; &#123; // å¯¹æ–°è®¾ç½®çš„å€¼è¿›è¡Œç›‘å¬ this.observe(newVal) if (newVal !== value) &#123; value = newVal &#125; return true &#125;, &#125;) &#125;&#125;export default Observer æ¥ä¸‹æ¥å°±æ˜¯æœ€å…³é”®çš„ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°æ¸²æŸ“äº†ã€‚ Watcher &amp;&amp; Depè¿™é‡Œæˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æä¸€ä¸‹ï¼š Watcher ä¸€ä¸€å¯¹åº”æ¨¡æ¿ä¸­çš„å˜é‡ï¼ˆæ’å€¼è¡¨è¾¾å¼ or a-textï¼‰ Dep å¯¹åº”å…·ä½“å˜é‡ Observer èƒ½å‘å‡ºé€šçŸ¥ åªæœ‰å½“å˜é‡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ¨¡æ¿ä¸­å¯¹åº”çš„åœ°æ–¹éœ€è¦å‘ç”Ÿé‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥æµç¨‹åº”è¯¥æ˜¯ï¼š Observer é€šçŸ¥ Depï¼Œå˜é‡å‘ç”Ÿæ”¹å˜ Dep ç®¡ç†äº†ä¸€ä¸ª Watcher æ•°ç»„ï¼Œæ‰§è¡Œ Watcher çš„ update æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾ é‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆå»ºç«‹ Dep å’Œ Watcher çš„å…³ç³»ã€‚ æ˜¾ç„¶ï¼Œæ¨¡æ¿ä¸­æ¯æœ‰ä¸€ä¸ªéœ€è¦æ¸²æŸ“çš„å€¼ï¼Œå°±åº”è¯¥æœ‰ä¸€ä¸ªå¯¹åº”çš„ Watcherï¼Œè€Œè¿™ä¸ªå€¼åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¿›è¡Œ get æ“ä½œï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯åœ¨ get ä¸­è¿›è¡Œæ“ä½œæœ€åˆé€‚ï¼š åŒæ ·ï¼Œåœ¨ä¿®æ”¹å€¼å¾—ä¹‹åä¼šè¿›è¡Œ set æ“ä½œï¼Œé‚£ä¹ˆåœ¨ set çš„æ—¶å€™åˆ©ç”¨ dep é€šçŸ¥ Watcher è¿›è¡Œæ“ä½œä¹Ÿæœ€åˆé€‚ã€‚ ç»¼ä¸Šï¼š Dep è‡³å°‘éœ€è¦ç®¡ç†ä¸€ä¸ª Watcher æ•°ç»„ï¼Œä¸€ä¸ªæ·»åŠ  Watcher çš„æ–¹æ³•ï¼Œä¸€ä¸ªé€šçŸ¥ Watcher æ›´æ–°è§†å›¾çš„æ–¹æ³• Watcher åœ¨åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºï¼Œç®¡ç† Update æ–¹æ³• è„‘å›¾å¦‚ä¸‹ï¼š é‚£ä¹ˆè¿™é‡Œï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ Compilerï¼Œåœ¨æ¸²æŸ“æ¨¡æ¿çš„æ—¶å€™åˆ›å»º Watcherï¼š 123456789101112131415161718192021222324const compileUtil = &#123; text(node, exp, am) &#123; const value = this.getValue(exp, am) const updaterFn = (node, value) =&gt; &#123; node.textContent = value &#125; updaterFn &amp;&amp; updaterFn(node, value) new Watcher() &#125;, getValue(exp, am) &#123; return exp.split(&#x27;.&#x27;).reduce((d, c) =&gt; d[c], am.$data) &#125;, setValue(exp, am, value) &#123; exp.split(&#x27;.&#x27;).forEach((k, i) =&gt; &#123; if (i &lt; exp.length - 1) &#123; am = am[k] &#125; else &#123; am[k] = value &#125; &#125;) &#125;,&#125; å› ä¸ºæˆ‘ä»¬åæœŸä¸å¯èƒ½åªå¤„ç† a-text æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¯¹å·¥å…·æ–¹æ³•è¿›è¡Œä¸€äº›å°è£…ä¼˜åŒ–ï¼š 12345678910111213141516171819202122232425262728293031323334const compileUtil = &#123; text(node, exp, am) &#123; this.bind(node, exp, am, &#x27;text&#x27;) &#125;, bind(node, exp, am, dir) &#123; const value = this.getValue(exp, am) const updaterFn = updaterUtil[dir] updaterFn &amp;&amp; updaterFn(node, value) new Watcher() &#125;, getValue(exp, am) &#123; return exp.split(&#x27;.&#x27;).reduce((d, c) =&gt; d[c], am.$data) &#125;, setValue(exp, am, value) &#123; exp.split(&#x27;.&#x27;).forEach((k, i) =&gt; &#123; if (i &lt; exp.length - 1) &#123; am = am[k] &#125; else &#123; am[k] = value &#125; &#125;) &#125;,&#125;const updaterUtil = &#123; text(node, value) &#123; node.textContent = value &#125;,&#125;export default compileUtil å› ä¸ºè¿™é‡Œæˆ‘ä»¬é€šè¿‡ getValue è·å–äº† data ä¸­çš„å€¼ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šè§¦å‘ get æ“ä½œï¼Œé‚£ä¹ˆå°±æ¥åˆ°äº† Observer ä¸­ã€‚ å‰é¢æˆ‘ä»¬ä¸€ç›´åå¤æåˆ°ï¼Œä¸€ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ª Depï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åœ¨ defineReactive ä¸­åˆ›å»º dep å®ä¾‹ï¼Œåœ¨ get ä¸­è°ƒç”¨ dep çš„ addWatcher æ–¹æ³•ï¼š 123456789101112131415class Observer &#123; /*...*/ defineReactive(obj, key, value) &#123; /*...*/ const dep = new Dep() Object.defineProperty(obj, key, &#123; get: (_) =&gt; &#123; dep.addWatcher(Watcher) return value &#125;, /*...*/ &#125;) &#125;&#125; åŒæ ·çš„ï¼Œåœ¨ set ä¸­è°ƒç”¨ dep çš„ notify æ–¹æ³•ï¼š 12345678910111213141516171819class Observer &#123; /*...*/ defineReactive(obj, key, value) &#123; /*...*/ const dep = new Dep() Object.defineProperty(obj, key, &#123; /*...*/ set: (newVal) =&gt; &#123; // å¯¹æ–°è®¾ç½®çš„å€¼è¿›è¡Œç›‘å¬ this.observe(newVal) if (newVal !== value) &#123; value = newVal dep.notify() &#125; &#125;, &#125;) &#125;&#125; ä¸Šé¢çš„ä»£ç ä¸­è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ get ä¸­æœ‰ä¸€è¡Œä»£ç ï¼š 1dep.addWatcher(Watcher) è¿™ä¸ª Watcher ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ° Watcherã€‚ Watcher éœ€è¦ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä»¬çŸ¥é“å®ƒçš„åŠŸèƒ½å°±å¾ˆæ¸…æ¥šäº†ï¼š å®ƒéœ€è¦è·å–å½“å‰çš„ data å€¼ï¼Œæ‰€ä»¥éœ€è¦ am å®ä¾‹ï¼Œä»¥åŠå€¼å¯¹åº”çš„ key å®ƒéœ€è¦æ›´æ–°è§†å›¾ï¼Œæ‰€ä»¥éœ€è¦ update å›è°ƒå‡½æ•° é‚£ä¹ˆæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š 12345678class Watcher &#123; constructor(am, exp, cb) &#123; this.am = am this.exp = exp this.cb = cb this.oldValue = this.getOldValue() &#125;&#125; è€Œåœ¨æ‰§è¡Œ getOldValue çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›çµæ´»çš„å°æ“ä½œï¼š å› ä¸º getOldValue å¿…å®šè§¦å‘ getï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ get ä¹‹å‰å°† Watcher æŒ‚è½½åˆ° Dep ä¸Šï¼Œåœ¨ get ä¹‹åæ¸…ç©ºå³å¯ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ get ä¸­è·å–åˆ° Watcher äº†ã€‚ 123456789class Watcher &#123; /*...*/ getOldVal() &#123; Dep.target = this const oldVal = compileUtil.getValue(this.exp, this.am) Dep.target = null return oldVal &#125;&#125; Watcher çš„åŠŸèƒ½æ˜¯åœ¨ value å˜åŒ–çš„æ—¶å€™è¿›è¡Œè§†å›¾æ›´æ–°ï¼Œè‡ªç„¶è¿˜éœ€è¦ä¸€ä¸ª updater æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åªéœ€è¦åœ¨ oldValue â‰  newValue çš„æ—¶å€™è°ƒç”¨å›è°ƒå‡½æ•°æ›´æ–°è§†å›¾å³å¯ï¼š 123456789class Watcher &#123; /*...*/ updater() &#123; const newValue = compileUtil.getValue(this.exp, this.am) if (this.oldValue !== newValue) &#123; this.cb(newVal) &#125; &#125;&#125; é‚£ä¹ˆåˆ›å»º Watcher çš„æ—¶å€™ï¼Œå‚æ•°ä¹Ÿå¾ˆå¥½å¡«äº†ï¼š 123456789101112const compileUtil = &#123; /*...*/ bind(node, exp, am, dir) &#123; /*...*/ const value = this.getValue(exp, am) const updaterFn = updaterUtil[dir] updaterFn &amp;&amp; updaterFn(node, value) new Watcher(am, exp, (value) =&gt; &#123; updaterFn &amp;&amp; updaterFn(node, value) &#125;) &#125;,&#125; Watcher æå®šäº†ï¼Œé‚£ä¹ˆç®¡ç† Watcher çš„ Dep å°±å¾ˆç®€å•äº†ï¼š 12345678910111213class Dep &#123; constructor() &#123; this.watchers = [] &#125; addWatcher(w) &#123; this.watchers.push(w) &#125; notify() &#123; this.watchers.forEach((w) =&gt; &#123; w.updater() &#125;) &#125;&#125; å†ä¿®æ”¹ä¸€ä¸‹ Observer ä¸­çš„ getï¼Œè¿™æ ·æ•´ä¸ªæµç¨‹å°±éƒ½é€šäº†ï¼š 1234get: (_) =&gt; &#123; Dep.target &amp;&amp; dep.addWatcher(Dep.target) return value&#125; æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š ç»“è¯­æ›´åŠ é˜…è¯»ä½“éªŒï¼šæ‰‹å†™ç®€æ˜“ MVVM","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"å‰ç«¯é€ è½®å­ã€2ã€‘ â€”â€” vuex","slug":"2020-08-07_3","date":"2020-08-10T08:14:02.776Z","updated":"2020-08-10T08:14:02.776Z","comments":false,"path":"2020/08/10/2020-08-07_3/","link":"","permalink":"http://yoursite.com/2020/08/10/2020-08-07_3/","excerpt":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vuex çš„å†…éƒ¨å®ç°åŸç†ã€‚æˆ‘ä»¬çŸ¥é“ vuex æ˜¯ vue å®˜æ–¹çš„çŠ¶æ€ç®¡ç†åº“ã€‚è‡³äºä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†åº“å‘¢ï¼Ÿè¿™ä¸ªå¤§æ¦‚è¦ä» flux è¯´èµ·ã€‚å¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ï¼šFlux æ¶æ„å…¥é—¨æ•™ç¨‹","text":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vuex çš„å†…éƒ¨å®ç°åŸç†ã€‚æˆ‘ä»¬çŸ¥é“ vuex æ˜¯ vue å®˜æ–¹çš„çŠ¶æ€ç®¡ç†åº“ã€‚è‡³äºä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†åº“å‘¢ï¼Ÿè¿™ä¸ªå¤§æ¦‚è¦ä» flux è¯´èµ·ã€‚å¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ï¼šFlux æ¶æ„å…¥é—¨æ•™ç¨‹ Step 1 - éœ€æ±‚åˆ†æé¦–å…ˆç”¨ vue-cli 4.x åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œé€‰æ‹©ä½¿ç”¨ vuexï¼Œç­‰é¡¹ç›®åˆ›å»ºå¥½ä¹‹åï¼Œåœ¨ src ç›®å½•ä¸‹åº”è¯¥å­˜åœ¨ä¸€ä¸ª store æ–‡ä»¶ï¼Œå…¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š 12345678910111213141516171819202122import Vue from &#x27;vue&#x27;import Vuex from &#x27;./yvuex&#x27;Vue.use(Vuex)export default new Vuex.Store(&#123; state: &#123; counter: 0, &#125;, mutations: &#123; add(state, num = 1) &#123; state.counter += num &#125;, &#125;, actions: &#123; add(&#123; commit &#125;) &#123; setTimeout(() =&gt; &#123; commit(&#x27;add&#x27;) &#125;, 1000) &#125;, &#125;,&#125;) ä½¿ç”¨è¿‡çŠ¶æ€ç®¡ç†åº“çš„åŒå­¦åº”è¯¥å¾ˆæ¸…æ¥š action ä¸»è¦ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸å…³å¿ƒå®ƒï¼ŒæŠŠåŒæ­¥æ“ä½œå¤„ç†å®Œä¹‹åå†æ¥çœ‹å®ƒå°±ä¼šæ¸…æ™°å¾ˆå¤šäº†ï¼š 123456789101112131415import Vue from &#x27;vue&#x27;import Vuex from &#x27;./yvuex&#x27;Vue.use(Vuex)export default new Vuex.Store(&#123; state: &#123; counter: 0, &#125;, mutations: &#123; add(state, num = 1) &#123; state.counter += num &#125;, &#125;,&#125;) ä»ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºä»¥ä¸‹å‡ ç‚¹ï¼š é¦–å…ˆ vuex æ˜¯ vue çš„æ’ä»¶ï¼Œé¦–å…ˆä¼š useï¼Œåœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨å…¶ install æ–¹æ³• é€šè¿‡ new æ–°å»ºå®ä¾‹çš„æ˜¯ vuex ä¸Šçš„ store å¯¹è±¡è€Œé vuex æœ¬èº« å¯¼å‡ºçš„ store ä¼šåœ¨ main ä¸­ä¼ ç»™ vueï¼ˆè¿™ä¸€éƒ¨åˆ†åœ¨ main ä¸­ï¼Œè€Œä¸åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼‰ é‚£ä¹ˆæˆ‘ä»¬çš„ vuex åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ æˆ‘è®¤ä¸ºåº”è¯¥ç»“åˆ vuex çš„ä½¿ç”¨æ¥è¿›è¡Œåˆ†æï¼š æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ vuex çš„æ—¶å€™ï¼Œé€šå¸¸å½¢å¦‚ï¼š 123this.$store.state.xxxthis.$store.commit(&#x27;xxx&#x27;)// this.$store.dispatch(&#x27;xxx&#x27;) å¼‚æ­¥ï¼Œæš‚ä¸è€ƒè™‘ æ˜¾ç„¶ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æŠŠ store æŒ‚è½½åˆ° vue å®ä¾‹ä¸Šï¼Œå…¶æ¬¡ï¼Œstore ä¸Šè¿˜åº”è¯¥æœ‰ state å’Œ commitï¼Œå®ƒä»¬ä¸¤åˆ†åˆ«æ˜¯ä¸€ä¸ª object å’Œä¸€ä¸ª functionã€‚ æ­¤æ—¶çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š Step 2 - åŠŸèƒ½å®ç°åŸºç¡€åŠŸèƒ½é‚£ä¹ˆæˆ‘ä»¬æŒ‰ç…§è¿™æ ·çš„æ–¹å¼æ„å»º vuexï¼š 123456789101112131415161718// export default Vuexexport default &#123; install(Vue) &#123; Vue.mixin(&#123; beforeCreate() &#123; if (this.$options.store) &#123; Vue.prototype.$store = this.$options.store &#125; &#125;, &#125;) &#125;, Store: class Store &#123; constructor() &#123; this.state = &#123;&#125; &#125; commit() &#123;&#125; &#125;,&#125; æ¥ä¸‹æ¥æˆ‘ä»¬å†å›åˆ° store ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åœ¨åˆ›å»º store å®ä¾‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ é€’äº†ä¸¤ä¸ªå¯¹è±¡ï¼š stateï¼šç”¨äºå­˜å‚¨çŠ¶æ€ mutationsï¼šç”¨äºåŒæ­¥ä¿®æ”¹çŠ¶æ€ ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„å»ºå®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°† state å­˜å‚¨åˆ° $store.state ä¸­ï¼Œå°† mutations å­˜å‚¨èµ·æ¥ï¼Œåœ¨ commit çš„æ—¶å–å‡ºè°ƒç”¨ï¼Œæ€ç»´å¯¼å›¾å¦‚ä¸‹ï¼š é‚£ä¹ˆæˆ‘ä»¬å¯¹åº”å®ç°çš„ä»£ç åº”è¯¥æ˜¯ï¼š 12345678910111213export default &#123; /*...*/ Store: class Store &#123; constructor(options) &#123; this._mutations = options.mutations this.state = options.state &#125; commit(type, payload) &#123; const mutation = this._mutations[type] return mutation(this.state, payload) &#125; &#125;,&#125; è¿™ä¸ªæ—¶å€™ï¼Œå·²ç»èƒ½ä» this.$store.state ä¸­å–å‡º counter äº†ï¼š å¹¶ä¸” commit ä¹Ÿèƒ½æˆåŠŸè°ƒç”¨äº†ï¼š ä½†è¿™é‡Œè¿˜æœ‰é—®é¢˜ï¼Œæœ€å…³é”®çš„å°±æ˜¯ counter çš„æ”¹å˜å¹¶æ²¡æœ‰å¼•èµ·é¡µé¢çš„é‡æ–°æ¸²æŸ“ã€‚æ˜¾ç„¶æˆ‘ä»¬åº”è¯¥å°† state æ”¹æˆå“åº”å¼æ•°æ®ï¼Œåœ¨ æ‰‹å†™ç®€æ˜“ vue-router ä¸­æˆ‘ä»¬ä½¿ç”¨äº† vue å®˜æ–¹æä¾›çš„é™æ€æ–¹æ³•ï¼šVue.util.defineReactive é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªåŠæ³•æ¥å®ç°å“åº”å¼æ•°æ®ï¼šåˆ›å»º vue å®ä¾‹ï¼Œåˆ©ç”¨å…¶ä¸­çš„ data æ–¹æ³•å°† state è½¬åŒ–ä¸ºå“åº”å¼æ•°æ®ï¼Œå®é™…ä»£ç å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324export default &#123; /*...*/ Store: class Store &#123; constructor(options) &#123; this._mutations = options.mutations this._vm = new _Vue(&#123; data() &#123; return &#123; // ç”±äºä¸å¸Œæœ›æ•°æ®è¢«ä»£ç†ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸Š $ $$state: options.state, &#125; &#125;, &#125;) &#125; get state() &#123; return this._vm._data.$$state &#125; set state(value) &#123; // ä¸å…è®¸ç›´æ¥ä¿®æ”¹ state console.error(&#x27;please use replaceState to reset state&#x27;) &#125; /*...*/ &#125;,&#125; ç°åœ¨æˆ‘ä»¬å†çœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼š è‡³æ­¤ï¼Œä¸€ä¸ªæœ€æœ€åŸºç¡€çš„ store å·²ç»åŸºæœ¬å®ç°äº†ï¼Œæ¥ä¸‹æ¥è‡ªç„¶æ˜¯å¼‚æ­¥æ“ä½œçš„ action äº†ã€‚ å¼‚æ­¥æ“ä½œå…¶å®æ˜ç™½äº† mutationsï¼Œactions ä¹Ÿå·²ç»æ¸…æ¥šäº†å¤§åŠï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ action ä¸­æˆ‘ä»¬éœ€è¦è°ƒç”¨ commit æ¥ä¿®æ”¹ stateï¼Œé‚£ä¹ˆè¿™ä¸ª commit ä»å“ªé‡Œæ¥è‡ªç„¶å°±å¾ˆæ¸…æ¥šäº†ï¼šthis å¯¼å›¾å¦‚ä¸‹ï¼š å®ç°ä»£ç å¦‚ä¸‹ï¼š 1234567891011121314export default &#123; /*...*/ Store: class Store &#123; constructor(options) &#123; /*...*/ this._actions = options.actions &#125; /*...*/ dispatch(type, payload) &#123; const action = this._actions[type] return action(this, payload) &#125; &#125;,&#125; niceï¼Œéå¸¸å®Œç¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœï¼š æŠ¥é”™äº†ï¼Ÿ è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ äºæ˜¯è·Ÿè¸ªè°ƒè¯•ä¸€ç•ªï¼Œå‘ç°å¦‚ä¸‹æƒ…å†µï¼š this æ²¡äº†ï¼Œå†çœ‹çœ‹ actionï¼š æ˜¾ç„¶ï¼Œè¿™é‡Œå› ä¸ºæ˜¯åœ¨ setTimeout ä¸­è°ƒç”¨ commitï¼Œä¸¢å¤±äº† thisï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ„å»ºå®ä¾‹çš„æ—¶å€™è¿›è¡Œç»‘å®šå°±å¯ä»¥å•¦ã€‚ è¿™ä¸‹å°±æ²¡æœ‰é—®é¢˜äº†ã€‚ æ‰©å±• - gettteræˆ‘ä»¬å·²ç»å®ç°äº†åŸºç¡€çš„ vuexï¼Œè€Œå¹³æ—¶ä½¿ç”¨ vuex çš„æ—¶å€™ï¼Œå¤§å®¶çŸ¥é“ getter ä¹Ÿæ˜¯ç»å¸¸è¢«ä½¿ç”¨åˆ°çš„ã€‚ é‚£ä¹ˆè¿™ä¸ª getter åº”å½“å¦‚ä½•å®ç°å‘¢ï¼Ÿ æˆ‘ä»¬å‡è®¾åœ¨åˆ›å»º vuex çš„æ—¶å€™ä¼ å…¥ getterï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå€¼ï¼Œæ˜¯ doubleCounterï¼Œè¿”å›å€¼æ˜¯ counter * 2ï¼Œé‚£ä¹ˆè‡ªç„¶ doubleCounter æ˜¯è¢« counter æ‰€å½±å“ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥ç”»å‡ºå¦‚ä¸‹å¯¼å›¾ï¼š é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼šæ€ä¹ˆå°† getter å’Œ state å…³è”èµ·æ¥å‘¢ï¼Ÿ ä»”ç»†æƒ³ä¸€æƒ³ï¼Œæ˜¾ç„¶è¿™é‡Œæ˜¯åšä»£ç†ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼šObject.definePropertyã€‚æœ‰äº†è¿™ä¸ªæ ¸å¿ƒæ€æƒ³ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æï¼Œç”±äº getter ä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šéœ€è¦éå†ä¼ å…¥çš„ getter objï¼Œå°†å…¶æ³¨å†Œåˆ° store ä¸Šã€‚ æˆ‘ä»¬å¯ä»¥å…ˆæ¥å®ç°è¿™ä¸€æ­¥æ“ä½œï¼š 1234567891011121314151617181920212223export default &#123; /*...*/ Store: class Store &#123; constructor(options) &#123; /*...*/ this._getters = options.getters this.= Object.create(null) this.forEachGetter(this, this._getters) &#125; /*...*/ forEachGetter(store, getters) &#123; Object.keys(getters).forEach((key) =&gt; &#123; const getter = getters[key] this.registerGetter(store, getter, key) &#125; &#125; registerGetter(store, getter, key)&#123; store._wrappedGetters[key] = function wrappedGetter(store)&#123; return getter(store.state) &#125; &#125; &#125;,&#125; æ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒè¯•çœ‹çœ‹ï¼š å¯ä»¥çœ‹åˆ°ï¼Œstore ä¸Šçš„å±æ€§ _wrappedGetters ä¸­ç°åœ¨åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š doubleCounterï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå³ registerGetter ä¸­è¿”å›çš„ wrappedGetterï¼Œå½“æˆ‘ä»¬è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œä¼šè¿”å› getter(store.state) æ‰§è¡Œçš„ç»“æœï¼ŒåŠ state.counter * 2 stateï¼šè¿™é‡Œæ˜¯å“åº”å¼æ•°æ®ï¼ˆä¸è¿‡ç°åœ¨è¿˜ä¸æ˜¯å“åº”å¼çš„ï¼‰ ç°åœ¨å·²ç»å»ºç«‹å¥½äº† options.getter å’Œ store._wrappedGetters çš„æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é€šè¿‡ Object.defineProperty æ¥åšä»£ç†äº†ï¼š 123456789101112131415161718192021222324252627282930export default &#123; /*...*/ Store: class Store &#123; constructor(options) &#123; /*...*/ this.resetStoreVm(this, options.state) &#125; /*...*/ resetStoreVm(store, state) &#123; store.getters = &#123;&#125; const computed = &#123;&#125; const wrappedGetters = store._wrappedGetters Object.keys(wrappedGetters).forEach((key) =&gt; &#123; computed[key] = this.partial(wrappedGetters[key], store) Object.defineProperty(store.getters, key, &#123; get: () =&gt; store._vm[key], &#125;) &#125;) this._vm = new _Vue(&#123; data() &#123; return &#123; $$state: state, &#125; &#125;, // ! è®¡ç®—å±æ€§ï¼Œç”¨äºå®ç° getter computed: computed, &#125;) &#125; partial = (fn, arg) =&gt; () =&gt; fn(arg)&#125; ä¸Šé¢çš„ä»£ç ï¼Œæ¯”è¾ƒæœ‰å®¹æ˜“æä¸æ¸…æ¥šçš„å°±ä¸¤ä¸ªåœ°æ–¹ï¼š wrappedGetters[key] æ˜¯ä»€ä¹ˆ partial è¿”å›å€¼æ˜¯ä»€ä¹ˆ è¿™ä¸ªé—®é¢˜ç›´æ¥åœ¨è°ƒè¯•å™¨é‡Œçœ‹çœ‹å°±æ¸…æ¥šäº†ï¼š æ˜¾ç„¶ï¼Œè¿™ä¸¤ä½ï¼Œä¸€ä¸ªæ˜¯ getter çš„åŒ…è£¹å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯å…¶æœ¬èº«ã€‚ åˆ°è¿™é‡Œï¼Œgetter ä¹Ÿç®—æ˜¯åŸºæœ¬å®ç°äº†ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š ç»“è¯­æ›´ä½³é˜…è¯»ä½“éªŒï¼šæ‰‹å†™ç®€æ˜“ vuex","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"å‰ç«¯é€ è½®å­ã€1ã€‘ â€”â€” vue-router","slug":"2020-08-07_2","date":"2020-08-10T08:13:19.038Z","updated":"2020-08-10T08:13:19.038Z","comments":false,"path":"2020/08/10/2020-08-07_2/","link":"","permalink":"http://yoursite.com/2020/08/10/2020-08-07_2/","excerpt":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue-router çš„å†…éƒ¨å®ç°åŸç†ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œvue app æ˜¯ spaï¼Œæ˜¯æ²¡æœ‰é¡µé¢ä¹‹é—´çš„è·³è½¬çš„ï¼Œè¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯æ²¡æœ‰åˆ·æ–°ã€‚é‚£ä¹ˆåœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå®ç°ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸åŒé¡µé¢ï¼Œä¸åŒç»„ä»¶ä¹‹é—´çš„åˆ‡æ¢å±•ç¤ºå‘¢ï¼Ÿ é€šè¿‡å­¦ä¹  vue-router çš„æºç ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œæµè§ˆå™¨ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼š hashï¼ˆå°±æ˜¯é¡µé¢ä¸Šçš„ #ï¼‰ historyï¼ˆh5ï¼‰ ä»Šå¤©æˆ‘ä»¬å°±ç®€å•æ¥å®ç°ä¸€ä¸‹é€šè¿‡ hash çš„æ–¹å¼å®ç° vue çš„è·¯ç”±è·³è½¬ã€‚","text":"ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue-router çš„å†…éƒ¨å®ç°åŸç†ã€‚ æˆ‘ä»¬çŸ¥é“ï¼Œvue app æ˜¯ spaï¼Œæ˜¯æ²¡æœ‰é¡µé¢ä¹‹é—´çš„è·³è½¬çš„ï¼Œè¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯æ²¡æœ‰åˆ·æ–°ã€‚é‚£ä¹ˆåœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå®ç°ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸åŒé¡µé¢ï¼Œä¸åŒç»„ä»¶ä¹‹é—´çš„åˆ‡æ¢å±•ç¤ºå‘¢ï¼Ÿ é€šè¿‡å­¦ä¹  vue-router çš„æºç ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œæµè§ˆå™¨ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼š hashï¼ˆå°±æ˜¯é¡µé¢ä¸Šçš„ #ï¼‰ historyï¼ˆh5ï¼‰ ä»Šå¤©æˆ‘ä»¬å°±ç®€å•æ¥å®ç°ä¸€ä¸‹é€šè¿‡ hash çš„æ–¹å¼å®ç° vue çš„è·¯ç”±è·³è½¬ã€‚ Step 1 - éœ€æ±‚åˆ†æé¦–å…ˆé€šè¿‡ vue-cli 4.x åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä½¿ç”¨ routerï¼Œå¹¶ä¸”æ¨¡å¼é€‰æ‹©ä¸º hashã€‚ é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° src ç›®å½•ä¸‹æœ‰ä¸€ä¸ª router æ–‡ä»¶ï¼Œå…¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š 123456789101112131415161718192021222324import Vue from &#x27;vue&#x27;import VueRouter from &#x27;./yvue-router&#x27;import Home from &#x27;../views/Home.vue&#x27;Vue.use(VueRouter)const routes = [ &#123; path: &#x27;/&#x27;, name: &#x27;Home&#x27;, component: Home, &#125;, &#123; path: &#x27;/about&#x27;, name: &#x27;About&#x27;, component: () =&gt; import(&#x27;../views/About.vue&#x27;), &#125;,]const router = new VueRouter(&#123; routes,&#125;)export default router æˆ‘ä»¬é€æ­¥æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š é¦–å…ˆæ˜¯ç”¨è¿‡ Vue.use(VueRouter) æ³¨å†Œäº†æ’ä»¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶ VueRouter æ˜¯ Vue çš„æ’ä»¶ï¼Œéœ€è¦æœ‰è‡ªå·±çš„é™æ€ install æ–¹æ³• æ¥ç€æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ï¼Œé…ç½®äº†è·¯æœ‰æ˜ å°„è¡¨ï¼Œç”¨äºç¡®å®šè·¯ç”±å’Œç»„ä»¶çš„å…³ç³» ç„¶åé€šè¿‡ new VueRouter({routers}) åˆ›å»ºäº†è·¯ç”±å®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶å¯¼å‡º æœ€åç†Ÿæ‚‰ vue çš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œå¯¼å‡ºçš„è¿™ä¸ª vueï¼Œæˆ‘ä»¬åœ¨ main ä¸­å°†å…¶å¼•ç”¨å¹¶ä¸”ä¼ é€’ç»™äº† Vue æœ¬èº« ä¸Šè¿°æµç¨‹éå¸¸ç®€å•ï¼Œé‚£ä¹ˆä» VueRouter çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ é¦–å…ˆè¿™é‡Œ Vue.use çš„æ—¶å€™ä¼šè°ƒç”¨ VueRouter.install æ–¹æ³•ï¼Œè€Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ è”åˆ vue-router çš„ä½¿ç”¨æˆ‘ä»¬çŸ¥é“ï¼Œæ³¨å†Œ router ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€ä½¿ç”¨ä¸¤ä¸ªç»„ä»¶ï¼š router-viewï¼šç”¨äºæ˜¾ç¤ºç»„ä»¶ router-linkï¼šç”¨äºè·¯ç”±è·³è½¬ æ˜¾ç„¶ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶çš„æ³¨å†Œè¿‡ç¨‹æ˜¯åœ¨ install ä¸­ï¼Œå› ä¸ºè¿™é‡Œæ‹¥æœ‰å¯¹å…¨å±€ Vue çš„å¼•ç”¨ã€‚ æ¥ä¸‹æ¥ï¼Œå°±æ˜¯ router çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå½“ hash æ”¹å˜çš„æ—¶å€™ï¼Œæ”¹å˜å±•ç¤ºçš„ç»„ä»¶ï¼Œæ˜¾ç„¶è¿™é‡Œæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªå“åº”å¼çš„ currentï¼Œå½“ current æ”¹å˜çš„æ—¶å€™ï¼Œå°±è§¦å‘ render é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚ ä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š Step 2 - åŠŸèƒ½å®ç°é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¯ä»¥ç€æ‰‹å¼€å§‹å®ç°è‡ªå·±çš„ vue-router äº†ã€‚ é¦–å…ˆæˆ‘ä»¬è‚¯å®šéœ€è¦ä¸€ä¸ª VueRouter çš„ç±»ï¼Œåº”ä¸ºåœ¨åé¢å®ƒéœ€è¦è¢«å®ä¾‹åŒ–ï¼š 1234567class VueRouter &#123; // å¯¹åº” Vue.use static install(Vue) &#123;&#125; // å¯¹åº” new constructor(options) &#123;&#125;&#125; ç´§æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ install ä¸­å®ç°å¯¹ä¸¤ä¸ªå…¨å±€ç»„ä»¶çš„æ³¨å†Œï¼š 123456789101112131415161718192021222324252627282930313233343536373839404142class VueRouter &#123; // å¯¹åº” Vue.use static install(Vue)&#123; // step 1: æ³¨å†Œç»„ä»¶ router-linkï¼Œç”¨äºè·¯ç”±è·³è½¬ // å›å¿†ä¸€ä¸‹ router-link çš„ä½¿ç”¨ï¼š // * &lt;router-link to=&quot;/login&quot;&gt;login&lt;/router-link&gt; Vue.component(&#x27;router-link&#x27;, &#123; // å¿…è¦å‚æ•° to props: &#123; to: &#123; type: String, require: true, &#125;, &#125;, // æ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨ templateï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ renderã€‚ // * render æ›´åŠ çµæ´»ï¼Œå¹¶ä¸”åœ¨ vue ä¸­ä¼šæŠŠ template ç¼–è¯‘æˆ render å‡½æ•°ã€‚ render() &#123; // è¿™é‡Œå¯ä»¥å†™ jsxï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ h å‡½æ•° // è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ jsxï¼Œåœ¨ view-router ä¸­ä½¿ç”¨ hï¼Œéƒ½å°è¯•ä¸€ä¸‹ // * h å‡½æ•°ç±»ä¼¼äº react ä¸­çš„ createElement return &lt;a href=&#123;`#$&#123;this.to&#125;`&#125;&gt;&#123;this.$slots.default&#125;&lt;/a&gt; &#125; // step 2: æ³¨å†Œç»„ä»¶ router-viewï¼Œç”¨äºæ˜¾ç¤ºç»„ä»¶ // å›å¿†ä¸€ä¸‹ router-link çš„ä½¿ç”¨ï¼š // &lt;router-view /&gt; Vue.component(&#x27;router-view&#x27;, &#123; // æ²¡æœ‰å‚æ•°ï¼Œç›´æ¥ template render(h) &#123; // è¿™é‡Œä½¿ç”¨ h // view-router çš„åŠŸèƒ½æ˜¯æ¸²æŸ“ç»„ä»¶ï¼Œé‚£ä¹ˆç»„ä»¶ä»å“ªé‡Œè·å–å‘¢ï¼Ÿ // å›å¿† router.js çš„è·¯ç”±è¡¨ï¼Œå…¶ä¸­æœ‰æ˜ å°„ url åœ°å€å’Œç»„ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶æ˜¾ç„¶æ˜¯ä»è¿™é‡Œè·å– // è€Œå½“å‰è·¯ç”±æˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ª current æ¥è¡¨ç¤º // æ‰€ä»¥å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ‰¾åˆ°å½“å‰ current å¯¹åº”çš„ç»„ä»¶ const &#123; routeMap, current &#125; = this.$router const component = routeMap[current] ? routeMap[current].component : null return h(component) &#125;, &#125;) &#125; /*...*/&#125; åˆ°è¿™é‡Œï¼Œè‡³å°‘æˆ‘ä»¬çš„ å·²ç»æ˜¯å¯ç”¨çš„äº†ï¼Œè€Œ åˆ™éœ€è¦æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­å®ç°å¯¹è·¯ç”±è¡¨çš„ç®¡ç†ä»¥åŠå¯¹ hashchange çš„ç›‘å¬ã€‚ é‚£ä¹ˆæ¥ä¸‹æ¥è‡ªç„¶æ˜¯å®ç° constructor 12345678910111213141516171819202122class VueRouter &#123; /*...*/ // å¯¹åº” new constructor(options) &#123; // åˆå§‹åŒ–è·¯ç”±è¡¨ this.routerMap = &#123;&#125; options.routes.map((route) =&gt; &#123; this.routerMap[route.path] = route &#125;) // å®šä¹‰ current const current = window.location.hash.slice(1) || &#x27;/&#x27; // ç›‘å¬ hashchange window.addEventListener(&#x27;hashchange&#x27;, this.onHashChange.bind(this)) &#125; onHashChange() &#123; this.current = window.location.hash.slice(1) &#125;&#125; åˆ°è¿™é‡Œï¼Œæ•´ä¸ª vue-router å·²ç»å®ç°å¾—å·®ä¸å¤šäº†ï¼Œä½†è¿˜å­˜åœ¨è¿™ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ current å¹¶ä¸æ˜¯å“åº”å¼çš„ï¼Œå½“è·¯ç”±åˆ‡æ¢ï¼Œcurrent æ”¹å˜çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šè§¦å‘ render é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼š é‚£åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼šæ€ä¹ˆå°† current è½¬æˆ vue å“åº”å¼æ•°æ®ï¼Ÿ å¯¹äºä¸Šè¿°é—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼š æ–°å»º vue å®ä¾‹ï¼Œé€šè¿‡ data å°† current è½¬æˆå“åº”å¼æ•°æ® åˆ©ç”¨ vue æä¾›çš„é™æ€æ–¹æ³• Vue.util.defineReactive è¿™é‡Œæˆ‘ä»¬é‡‡å–ç¬¬äºŒç§æ–¹æ¡ˆï¼š 1234567891011121314151617181920212223class VueRouter &#123; /*...*/ // å¯¹åº” new constructor(options) &#123; // åˆå§‹åŒ–è·¯ç”±è¡¨ this.routerMap = &#123;&#125; options.routes.map((route) =&gt; &#123; this.routerMap[route.path] = route &#125;) // å®šä¹‰ current const initial = window.location.hash.slice(1) || &#x27;/&#x27; Vue.util.defineReactive(this, &#x27;current&#x27;, initial) // ç›‘å¬ hashchange window.addEventListener(&#x27;hashchange&#x27;, this.onHashChange.bind(this)) &#125; onHashChange() &#123; this.current = window.location.hash.slice(1) &#125;&#125; åˆ°è¿™é‡Œåˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ª Vue ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ å…¶å®è¿™é‡Œéœ€è¦è®©æ€ç»´è·³å‡º constructorï¼šæˆ‘ä»¬çŸ¥é“æ‰§è¡Œ install çš„æ—¶å€™ä¼šä¼ å…¥ Vueï¼Œé‚£ä¹ˆåœ¨ install çš„æ—¶å€™æˆ‘ä»¬ä¿å­˜ä¸€ä¸ªå…¨å±€å˜é‡ _Vue å³å¯åœ¨ constructor ä¸­è¿›è¡Œä½¿ç”¨äº†ï¼š 12345678910111213141516171819202122232425let _Vueclass VueRouter &#123; /*...*/ // å¯¹åº” new constructor(options) &#123; // åˆå§‹åŒ–è·¯ç”±è¡¨ this.routerMap = &#123;&#125; options.routes.map((route) =&gt; &#123; this.routerMap[route.path] = route &#125;) // å®šä¹‰ current const initial = window.location.hash.slice(1) || &#x27;/&#x27; _Vue.util.defineReactive(this, &#x27;current&#x27;, initial) // ç›‘å¬ hashchange window.addEventListener(&#x27;hashchange&#x27;, this.onHashChange.bind(this)) &#125; onHashChange() &#123; this.current = window.location.hash.slice(1) &#125;&#125; åˆ°è¿™é‡Œï¼ŒåŸºæœ¬çš„è·¯ç”±å·²ç»å®ç°äº†ï¼š è¿˜æœ‰ä¸€äº›å¯ä»¥æ‰©å±•çš„åœ°æ–¹ï¼š æ¯”å¦‚ä¼˜åŒ–ä¸€ä¸‹ constructorï¼Œå°† options ä¿å­˜åˆ°æœ¬åœ°ï¼š 123456789101112131415constructor(options)&#123; this.$options = options // åˆå§‹åŒ–è·¯ç”±è¡¨ this.routerMap = &#123;&#125; this.$options.routes.map((route)=&gt;&#123; this.routerMap[route.path] = route &#125;) // å®šä¹‰ current const initial = window.location.hash.slice(1) || &#x27;/&#x27; _Vue.util.defineReactive(this, &#x27;current&#x27;, initial) // ç›‘å¬ hashchange window.addEventListener(&#x27;hashchange&#x27;, this.onHashChange.bind(this))&#125; è¿™å¯ä»¥ä¿è¯æ•°æ®çš„å•å‘æµåŠ¨ã€‚ æ¯”å¦‚ä¸ºç»„ä»¶å®ä¾‹æŒ‚è½½ $routerï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åƒ this.$router.push() è¿™æ ·ä½¿ç”¨ router ä¸Šçš„æ–¹æ³•äº†ã€‚ ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼Œé‚£å°±æ˜¯æ—¶é—´ï¼š å› ä¸ºå½“æˆ‘ä»¬æ‰§è¡Œ install çš„æ—¶å€™ï¼ŒVueRouter çš„å®ä¾‹è¿˜æ²¡åˆ›å»ºï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡ï¼š 1Vue.prototype.$router = this.$options.router è¿›è¡ŒæŒ‚è½½æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚ è¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© mixin æ¥ä½¿ç”¨ Vue çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå½“ç»„ä»¶åˆ›å»ºä¹‹å‰è¿›è¡ŒæŒ‚è½½æ“ä½œï¼š 1234567Vue.mixin(&#123; beforeCreate() &#123; if (this.$options.router) &#123; Vue.prototype.$router = this.$options.router &#125; &#125;,&#125;) è¿™æ ·å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚ ç»“è¯­æ›´ä½³é˜…è¯»ä½“éªŒï¼šæ‰‹å†™ç®€æ˜“ vue-router","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"Github + Hexo çˆ¬å‘ä¹‹æ—…ã€2ã€‘ â€”â€” ç½‘ç«™é…ç½®","slug":"2020-08-07_1","date":"2020-08-07T03:29:03.057Z","updated":"2020-08-07T03:10:32.504Z","comments":false,"path":"2020/08/07/2020-08-07_1/","link":"","permalink":"http://yoursite.com/2020/08/07/2020-08-07_1/","excerpt":"å‰é¢å·²ç»å°†ç½‘ç«™çš„åŸºæœ¬æ¶å­æ­å¥½äº†ï¼Œä½†é€šç”¨çš„é…ç½®æ˜¾ç„¶å¹¶ä¸é€‚ç”¨äºæ¯ä¸€ä¸ªäººï¼Œè¿™é‡Œå°±é€šè¿‡é…ç½®æ–‡ä»¶ç¨å¾®è‡ªå®šä¹‰ä¸€ä¸‹ã€‚","text":"å‰é¢å·²ç»å°†ç½‘ç«™çš„åŸºæœ¬æ¶å­æ­å¥½äº†ï¼Œä½†é€šç”¨çš„é…ç½®æ˜¾ç„¶å¹¶ä¸é€‚ç”¨äºæ¯ä¸€ä¸ªäººï¼Œè¿™é‡Œå°±é€šè¿‡é…ç½®æ–‡ä»¶ç¨å¾®è‡ªå®šä¹‰ä¸€ä¸‹ã€‚ ç«™ç‚¹é…ç½®ç›®æ ‡æ–‡ä»¶ï¼šroot/ _config.yml 1234title: ä¸–ç•Œçš„ä¾§é¢subtitle: &#x27;&#x27;author: åˆå¿ƒYearthfavicon: https://s1.ax1x.com/2020/08/06/agXE9K.png ä¸»é¢˜é…ç½®ç›®æ ‡æ–‡ä»¶ï¼šroot/themes/volantis/_config.yml å°é¢é…ç½®12345cover: M title: &#x27;æ ‡é¢˜&#x27; M # subtitle: &#x27;&#x27; M search: ä½ æƒ³çœ‹ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ M # features: // è¿™ä¸ªé€‰é¡¹æ˜¯æœç´¢æ¡†ä¸‹çš„å¯¼èˆªæŒ‰é’®ï¼Œè¿™é‡Œé€‰æ‹©æ³¨é‡Šæ‰ å¯¼èˆªæ é…ç½®12345678910111213141516171819202122232425navbar: logo: img: icon: title: &#x27;æ ‡é¢˜&#x27; menu: M # - name: åšå®¢ M # icon: fas fa-rss M # url: / - name: åˆ†ç±» icon: fas fa-tags url: tags/ - name: æ ‡ç­¾ icon: fas fa-tags url: tags/ M # - name: å½’æ¡£ M # icon: fas fa-archive M # url: archives/ M # - name: å‹é“¾ M # icon: fas fa-link M # url: friends/ - name: å…³äº icon: fas fa-info-circle url: about/ search: ä½ æƒ³çœ‹ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ å¸ƒå±€é…ç½®123layout:on_page:M body: [article] æ’ä»¶é…ç½®123456plugins:backstretch:M position: fixedaplayer:M id: 170672512M autoplay: true æœ€ç»ˆæ•ˆæœ","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}},{"title":"Github + Hexo çˆ¬å‘ä¹‹æ—…ã€1ã€‘ â€”â€” åŸºç¡€æ­å»º","slug":"2020-08-06","date":"2020-08-07T03:10:56.541Z","updated":"2020-08-07T03:10:56.541Z","comments":false,"path":"2020/08/07/2020-08-06/","link":"","permalink":"http://yoursite.com/2020/08/07/2020-08-06/","excerpt":"æ²¡æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç¨‹åºå‘˜çš„ï¼Œäºæ˜¯ä»Šå¤©åœ¨ä¸€ç•ªæŠ˜è…¾ä¹‹ä¸‹ï¼Œé€šè¿‡ Github + Hexo é…ç½®äº†ä¸€ä¸ªåœ¨çº¿çš„åšå®¢ï¼Œç‰¹æ­¤è®°å½•ã€‚å½“ç„¶å¦‚æœå–œæ¬¢æ›´åŠ åå‘æ–‡æ¡£é£æ ¼çš„ç«¥é‹ï¼Œå¯ä»¥é€‰æ‹© Vuepressã€‚","text":"æ²¡æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç¨‹åºå‘˜çš„ï¼Œäºæ˜¯ä»Šå¤©åœ¨ä¸€ç•ªæŠ˜è…¾ä¹‹ä¸‹ï¼Œé€šè¿‡ Github + Hexo é…ç½®äº†ä¸€ä¸ªåœ¨çº¿çš„åšå®¢ï¼Œç‰¹æ­¤è®°å½•ã€‚å½“ç„¶å¦‚æœå–œæ¬¢æ›´åŠ åå‘æ–‡æ¡£é£æ ¼çš„ç«¥é‹ï¼Œå¯ä»¥é€‰æ‹© Vuepressã€‚ Step 1 - Hexo æœ¬åœ°å®‰è£…åŠè¿è¡Œæµ‹è¯•é¦–å…ˆå…¨å±€å®‰è£… Hexoï¼š 1sudo npm install hexo-cli -g å®‰è£…å¥½ä¹‹åä½¿ç”¨ Hexo åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºæ„å»ºä¸ªäººåšå®¢ç½‘ç«™ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å« daily_recordï¼š 1hexo init daily_record æ¥ä¸‹æ¥è¿›å…¥åˆ°åšå®¢ç›®å½•ä¸‹ï¼Œå®‰è£…ä¾èµ–ï¼Œè¿è¡Œå³å¯æŸ¥çœ‹åˆå§‹çŠ¶æ€äº† 123cd daily_recordnpm installhexo server å¦‚æœä¸Šè¿°æ­¥éª¤æ²¡æœ‰å‡ºé”™çš„è¯ï¼Œåº”è¯¥å¯ä»¥åœ¨æœ¬åœ°çš„ 4000 ç«¯å£çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š Step 2 - æ›´æ¢ Volantis ä¸»é¢˜æƒ³å¿…ä½ ä¹Ÿè§‰å¾—é»˜è®¤ä¸»é¢˜æœ‰ç‚¹ lowã€‚(æ¯•ç«Ÿæ˜¯å¤šå¹´å‰çš„äº§ç‰©äº†ï¼Œæœ‰ç‚¹è·Ÿä¸ä¸Šæ—¶ä»£çš„å®¡ç¾) å¥½åœ¨ Hexo ç”Ÿæ€è¶³å¤Ÿä¸°å¯Œï¼Œæœ‰å¾ˆå¤šä¼˜ç§€çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ Volantisã€‚ æ¥ä¸‹æ¥è¿›å…¥åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¼€å§‹å®‰è£…ä¸»é¢˜ï¼š 1git clone https://github.com/xaoxuu/hexo-theme-volantis themes/volantis ä¸‹è½½å¥½ä¹‹åï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼š 12- theme: landscape+ theme: volantis ç„¶åå®‰è£…ä¸€äº›ä¾èµ–ï¼š 1npm install hexo-generator-search hexo-generator-json-content hexo-renderer-stylus -S ç°åœ¨é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œä½ çš„ç½‘ç«™åº”è¯¥å˜æˆäº†è¿™æ · Step 3 - éƒ¨ç½²åˆ° Gitubè¿™ä¸ªä¸»é¢˜æœ‰å¾ˆå¤šé…ç½®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒå®˜æ–¹æ–‡æ¡£ï¼Œè¿™é‡Œå°±è¿˜ä¸åœ¨èµ˜è¿°ã€‚ è¦å°†ä¸ªäººä¸»é¡µéƒ¨ç½²åˆ° Githubï¼Œé¦–å…ˆæˆ‘ä»¬è¦å» Github åˆ›å»ºä¸€ä¸ª yourname.github.io çš„ä»“åº“ã€‚ éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œyourname ä¸€å®šè¦å’Œä½ çš„ github name å®Œå…¨ä¸€æ ·ï¼Œå¹¶ä¸”ä¸€å®šè¦é€‰æ‹©åˆå§‹åŒ–é¡¹ç›® ç„¶åå®‰è£… Hexo çš„éƒ¨ç½²æ’ä»¶ï¼š 1npm install hexo-deployer-git -S å®‰è£…å¥½ä¹‹åï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼š 1234deploy:+ type: &#x27;git&#x27;+ repo: https://github.com/yourname/yourname.github.io+ branch: master æœ€åé€šè¿‡ä»¥ä¸‹å‘½ä»¤å³å¯ä¸€é”®éƒ¨ç½²ï¼š 1hexo g -d Step 4 - è®¿é—®ä¸ªäººä¸»é¡µæ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ä¸‹é¢çš„åœ°å€è®¿é—®ä½ çš„ä¸ªäººä¸»é¡µäº†ï¼š 1https://yourname.github.io/","categories":[],"tags":[],"author":{"name":"åˆå¿ƒYearth","url":"https://space.bilibili.com/11282054"}}],"categories":[],"tags":[]}