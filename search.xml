<?xml version="1.0" encoding="utf-8"?>
<search> 
  
  
    
    <entry>
      <title>Vue 2.6 æºç åˆ†æä¹‹æ—…ã€2ã€‘ â€”â€” æ•°æ®å“åº”å¼</title>
      <link href="/2020/08/17/2020-08-17/"/>
      <url>/2020/08/17/2020-08-17/</url>
      
        <content type="html"><![CDATA[<p><a href="https://www.notion.so/37c7e6218fc449a684ace2de187f18d7">ä¸Šä¸€ç« </a>ç²—æµ…çš„åˆ†æäº† vue 2.6.x çš„åˆå§‹åŒ–æµç¨‹ï¼Œææ¸…æ¥šäº†ä»¥ä¸‹å‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>vue çš„å…¥å£åœ¨å“ªé‡Œ</li><li>vue çš„åˆå§‹åŒ–åšäº†ä»€ä¹ˆæ“ä½œ</li><li>åœ¨ vue åˆå§‹åŒ–è¿‡ç¨‹ä¸­ï¼Œå“ªäº›æ“ä½œå…ˆæ‰§è¡Œï¼Œå“ªäº›æ“ä½œåæ‰§è¡Œ</li></ul><p>è€Œä»Šå¤©ï¼Œæˆ‘ä»¬å°†åˆ†æ vue 2.6.x ä¸­æ˜¯å¦‚ä½•å®Œæˆæ•°æ®å“åº”å¼æ“ä½œçš„ã€‚</p><p>é‚£ä¹ˆå¼€å§‹å§ï¼</p><a id="more"></a><h2 id="å¤„ç†å¯¹è±¡"><a href="#å¤„ç†å¯¹è±¡" class="headerlink" title="å¤„ç†å¯¹è±¡"></a>å¤„ç†å¯¹è±¡</h2><p>ç›¸ä¿¡å¤§å®¶éƒ½çŸ¥é“ï¼Œvue 2.6.x ä¸­å®ç°æ•°æ®å“åº”å¼çš„æ ¸å¿ƒæ–¹æ³•æ˜¯ <code>Object.defineProperty</code>ï¼Œè€Œè¿™ä¸ªæ–¹æ³•å¹¶ä¸èƒ½å¤„ç†æ•°ç»„ï¼Œæ‰€ä»¥ vue å¯¹äºæ•°ç»„å’Œå¯¹è±¡çš„å¤„ç†æ–¹æ³•æ˜¯ä¸åŒçš„ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…ˆæ¥åˆ†æå®ƒæ˜¯å¦‚ä½•å¤„ç†å¯¹è±¡çš„ã€‚</p><p>é€šè¿‡ä¸Šä¸€ç« çš„åˆ†æï¼Œæˆ‘ä»¬çŸ¥é“ï¼Œåœ¨åˆå§‹åŒ–æµç¨‹ä¸­ï¼Œå¤„ç†æ•°æ®çš„æ–¹æ³•æ˜¯ <code>initState</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initState</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._watchers = []</span><br><span class="line">  <span class="keyword">const</span> opts = vm.$options</span><br><span class="line">  <span class="keyword">if</span> (opts.props) initProps(vm, opts.props)</span><br><span class="line">  <span class="keyword">if</span> (opts.methods) initMethods(vm, opts.methods)</span><br><span class="line">  <span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe((vm._data = &#123;&#125;), <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (opts.computed) initComputed(vm, opts.computed)</span><br><span class="line">  <span class="keyword">if</span> (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123;</span><br><span class="line">    initWatch(vm, opts.watch)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å‘Šè¯‰æˆ‘ä»¬ä¸¤æ¡ä¿¡æ¯ï¼š</p><ul><li>ä¼˜å…ˆçº§ï¼šprops &gt; methods &gt; data &gt; computed &gt; watch</li><li>å®ç°æ•°æ®å“åº”å¼çš„æ–¹æ³•æ˜¯ <code>initData(vm)</code></li></ul><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">initData</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> data = vm.$options.data</span><br><span class="line">  data = vm._data = <span class="keyword">typeof</span> data === <span class="string">&#x27;function&#x27;</span> ? getData(data, vm) : data || &#123;&#125;</span><br><span class="line">  <span class="keyword">if</span> (!isPlainObject(data)) &#123;</span><br><span class="line">    data = &#123;&#125;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">&#x27;data functions should return an object:\n&#x27;</span> +</span><br><span class="line">          <span class="string">&#x27;https://vuejs.org/v2/guide/components.html#data-Must-Be-a-Function&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// proxy data on instance</span></span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(data)</span><br><span class="line">  <span class="keyword">const</span> props = vm.$options.props</span><br><span class="line">  <span class="keyword">const</span> methods = vm.$options.methods</span><br><span class="line">  <span class="keyword">let</span> i = keys.length</span><br><span class="line">  <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">    <span class="keyword">const</span> key = keys[i]</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">if</span> (methods &amp;&amp; hasOwn(methods, key)) &#123;</span><br><span class="line">        warn(<span class="string">`Method &quot;<span class="subst">$&#123;key&#125;</span>&quot; has already been defined as a data property.`</span>, vm)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (props &amp;&amp; hasOwn(props, key)) &#123;</span><br><span class="line">      process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">        warn(<span class="string">`The data property &quot;<span class="subst">$&#123;key&#125;</span>&quot; is already declared as a prop. `</span> + <span class="string">`Use prop default value instead.`</span>, vm)</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (!isReserved(key)) &#123;</span><br><span class="line">      proxy(vm, <span class="string">`_data`</span>, key)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// observe data</span></span><br><span class="line">  observe(data, <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæœ€æ ¸å¿ƒçš„æ–¹æ³•æ˜¯ <code>observe</code>ã€‚</p><p>é‚£ä¹ˆè·³è¿‡å»çœ‹çœ‹ï¼š</p><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/observer/index.js</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">observe</span>(<span class="params">value: any, asRootData: ?boolean</span>): <span class="title">Observer</span> | <span class="title">void</span> </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (!isObject(value) || value <span class="keyword">instanceof</span> VNode) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">let</span> ob: Observer | <span class="keyword">void</span></span><br><span class="line">  <span class="keyword">if</span> (hasOwn(value, <span class="string">&#x27;__ob__&#x27;</span>) &amp;&amp; value.__ob__ <span class="keyword">instanceof</span> Observer) &#123;</span><br><span class="line">    ob = value.__ob__</span><br><span class="line">  &#125; <span class="keyword">else</span> <span class="keyword">if</span> (</span><br><span class="line">    shouldObserve &amp;&amp;</span><br><span class="line">    !isServerRendering() &amp;&amp;</span><br><span class="line">    (<span class="built_in">Array</span>.isArray(value) || isPlainObject(value)) &amp;&amp;</span><br><span class="line">    <span class="built_in">Object</span>.isExtensible(value) &amp;&amp;</span><br><span class="line">    !value._isVue</span><br><span class="line">  ) &#123;</span><br><span class="line">    ob = <span class="keyword">new</span> Observer(value)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (asRootData &amp;&amp; ob) &#123;</span><br><span class="line">    ob.vmCount++</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> ob</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œä»è¿™é‡Œçš„ä»£ç ï¼Œæˆ‘ä»¬èƒ½çœ‹åˆ°ä»¥ä¸‹ä¿¡æ¯ï¼š</p><ul><li>å¦‚æœä¸æ˜¯å¯¹è±¡ï¼Œåˆ™ä¸ä¼šè¿›è¡Œ <code>new Observer()</code> æ“ä½œ</li><li>å¦‚æœä¸€ä¸ªå¯¹è±¡æ‹¥æœ‰ <code>__ob__</code> å±æ€§ï¼Œé‚£ä¹ˆå®ƒå°±æ˜¯ä¸€ä¸ªå“åº”å¼çš„æ•°æ®</li><li>å®ç°å“åº”å¼çš„æ ¸å¿ƒæ“ä½œåœ¨ <code>new Observer()</code> ä¸­</li></ul><p>æ‰€ä»¥ç°åœ¨è·³è½¬éƒ½ Observer ä¸­çœ‹çœ‹ï¼š</p><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/observer/index.js</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(value: any) &#123;</span><br><span class="line">    <span class="built_in">this</span>.value = value</span><br><span class="line">    <span class="built_in">this</span>.dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="built_in">this</span>.vmCount = <span class="number">0</span></span><br><span class="line">    def(value, <span class="string">&#x27;__ob__&#x27;</span>, <span class="built_in">this</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (hasProto) &#123;</span><br><span class="line">        protoAugment(value, arrayMethods)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="built_in">this</span>.observeArray(value)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.walk(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯ä»¥çœ‹åˆ°ï¼Œæ¯ä¸€ä¸ª ob å®ä¾‹ä¸€å®šä¼šæœ‰ä¸€ä¸ª dep å®ä¾‹ï¼Œè€Œæ¯ä¸€ä¸ªæ•°æ®å¯¹è±¡ä¼šæœ‰ä¸€ä¸ª obï¼Œ<strong>æ‰€ä»¥æ¯ä¸ªå¯¹è±¡å°†æœ‰ä¸€ä¸ª dep å®ä¾‹</strong>ï¼Œæš‚ä¸”æˆ‘ä»¬å«å®ƒ<strong>å¯¹è±¡ä¾èµ–ç®¡ç†å™¨</strong>ï¼Œè‡³äºå®ƒçš„ç”¨å¤„ï¼Œæš‚ä¸æ·±å…¥è®¨è®ºï¼Œåé¢å†å›è¿‡å¤´æ¥çœ‹ã€‚</p><p>å‰é¢å·²ç»æåˆ°è¿‡ï¼Œæ•°ç»„å’Œå¯¹è±¡çš„å“åº”å¼æœ‰åŒºåˆ«ï¼Œè¿™é‡Œæˆ‘ä»¬å…ˆçœ‹å“åº”å¼æ˜¯å¦‚ä½•å®ç°çš„ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">walk(obj: <span class="built_in">Object</span>) &#123;</span><br><span class="line">  <span class="keyword">const</span> keys = <span class="built_in">Object</span>.keys(obj)</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; keys.length; i++) &#123;</span><br><span class="line">    defineReactive(obj, keys[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œ<code>defineReactive</code> å°±æ˜¯å®ç°æ•°æ®å“åº”å¼çš„æ ¸å¿ƒæ–¹æ³•äº†ã€‚</p><p>å¹¶ä¸”è¿™ä¸ªæ–¹æ³•æŒ‚åˆ°äº† <code>Vue.util.defineReactive</code> ä¸Š</p><p>é‚£ä¹ˆæˆ‘ä»¬æ·±å…¥åˆ°æ–¹æ³•å†…éƒ¨çœ‹çœ‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">defineReactive</span>(<span class="params">obj: Object, key: string, val: any, customSetter?: ?Function, shallow?: boolean</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> property = <span class="built_in">Object</span>.getOwnPropertyDescriptor(obj, key)</span><br><span class="line">  <span class="keyword">if</span> (property &amp;&amp; property.configurable === <span class="literal">false</span>) &#123;</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// cater for pre-defined getter/setters</span></span><br><span class="line">  <span class="keyword">const</span> getter = property &amp;&amp; property.get</span><br><span class="line">  <span class="keyword">const</span> setter = property &amp;&amp; property.set</span><br><span class="line">  <span class="keyword">if</span> ((!getter || setter) &amp;&amp; <span class="built_in">arguments</span>.length === <span class="number">2</span>) &#123;</span><br><span class="line">    val = obj[key]</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> childOb = !shallow &amp;&amp; observe(val)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">    enumerable: <span class="literal">true</span>,</span><br><span class="line">    configurable: <span class="literal">true</span>,</span><br><span class="line">    get: <span class="function"><span class="keyword">function</span> <span class="title">reactiveGetter</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">        dep.depend()</span><br><span class="line">        <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">          childOb.dep.depend()</span><br><span class="line">          <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">            dependArray(value)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> value</span><br><span class="line">    &#125;,</span><br><span class="line">    set: <span class="function"><span class="keyword">function</span> <span class="title">reactiveSetter</span>(<span class="params">newVal</span>) </span>&#123;</span><br><span class="line">      <span class="keyword">const</span> value = getter ? getter.call(obj) : val</span><br><span class="line">      <span class="comment">/* eslint-disable no-self-compare */</span></span><br><span class="line">      <span class="keyword">if</span> (newVal === value || (newVal !== newVal &amp;&amp; value !== value)) &#123;</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">/* eslint-enable no-self-compare */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; customSetter) &#123;</span><br><span class="line">        customSetter()</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="comment">// #7981: for accessor properties without setter</span></span><br><span class="line">      <span class="keyword">if</span> (getter &amp;&amp; !setter) <span class="keyword">return</span></span><br><span class="line">      <span class="keyword">if</span> (setter) &#123;</span><br><span class="line">        setter.call(obj, newVal)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        val = newVal</span><br><span class="line">      &#125;</span><br><span class="line">      childOb = !shallow &amp;&amp; observe(newVal)</span><br><span class="line">      dep.notify()</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¹ä¸€çœ‹æŒºå¤æ‚ï¼Œå®é™…ä¸Šä¸Šé¢çš„ä»£ç æ€»å…±åšäº†ä¸‰ä»¶äº‹ï¼š</p><ul><li>ç»™æ¯ä¸ª key åˆ›å»ºä¸€ä¸ª depï¼ˆè¿™ä¸ª dep æˆ‘ä»¬å«å®ƒ<strong>æ•°æ®ä¾èµ–ç®¡ç†å™¨</strong>ï¼‰</li><li>å¦‚æœä¼ å…¥çš„ val æ˜¯ <code>object</code>ï¼Œåˆ™è¿›è¡Œé€’å½’æ“ä½œ</li><li>é€šè¿‡ <code>Object.defineProperty</code> å®ç°æ•°æ®å“åº”å¼</li></ul><p>é‚£ä¹ˆå…·ä½“æ˜¯å¦‚ä½•å®ç°çš„å‘¢ï¼Ÿ</p><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨ get çš„æ—¶å€™ï¼Œè¿›è¡Œäº†å¦‚ä¸‹æ“ä½œï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">  dep.depend()</span><br><span class="line">  <span class="keyword">if</span> (childOb) &#123;</span><br><span class="line">    childOb.dep.depend()</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">      dependArray(value)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç”¨æ¯”è¾ƒä¸“ä¸šè¯´çš„è¯´æ³•ï¼Œè¿™ä¸€æ­¥å«åš<strong>ä¾èµ–æ”¶é›†</strong>ï¼Œè¿™é‡Œæˆ‘ä»¬éœ€è¦ææ¸…æ¥šå‡ ä¸ªé—®é¢˜ï¼š</p><ul><li>ä»€ä¹ˆæ˜¯ä¾èµ–æ”¶é›†ï¼Ÿ</li><li>Dep.target æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>depend åšäº†ä»€ä¹ˆï¼Ÿ</li><li>dependArray åšäº†ä»€ä¹ˆï¼Ÿ</li></ul><p>è¿™é‡Œä¸€ä¸€å›ç­”ï¼š</p><p>æˆ‘ä»¬éƒ½çŸ¥é“ï¼Œvue æ˜¯ä¸€æ¬¾ mvvm çš„æ¡†æ¶ï¼Œå®ç°äº†æ•°æ®çš„å“åº”å¼ï¼Œè®©å¼€å‘è€…ä¸ç”¨å†è¿‡åˆ†å…³æ³¨æ•°æ®ï¼Œè§†å›¾çš„è”ç³»ï¼Œåªéœ€è¦æ›´æ–°æ•°æ®ï¼Œè§†å›¾ä¼šè‡ªåŠ¨çš„æ›´æ–°ã€‚</p><p>å‡è®¾ç°åœ¨æœ‰ a, b, c, d å››ä¸ªå˜é‡ï¼Œè€Œè§†å›¾ä¸­åªç”¨åˆ°äº† a, c, dï¼Œé‚£ä¹ˆ b æ›´æ”¹çš„æ—¶å€™ï¼Œè§†å›¾è‡ªç„¶ä¸åº”è¯¥åˆ·æ–°ï¼Œè¦æ€ä¹ˆåˆ¤æ–­ b å’Œè§†å›¾æœ‰æ²¡æœ‰å…³ç³»å‘¢ï¼Ÿè¿™å°±æ˜¯ä¾èµ–æ”¶é›†éœ€è¦åšåˆ°çš„ã€‚</p><p>è‡³äºä¸‹é¢çš„é—®é¢˜ï¼Œæˆ‘ä»¬å¾—å…ˆåˆ° dep ä¸­çœ‹çœ‹ï¼š</p><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/observer/dep.js</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> target: ?Watcher</span><br><span class="line">  id: number</span><br><span class="line">  subs: <span class="built_in">Array</span>&lt;Watcher&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = uid++</span><br><span class="line">    <span class="built_in">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addSub(sub: Watcher) &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs.push(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeSub(sub: Watcher) &#123;</span><br><span class="line">    remove(<span class="built_in">this</span>.subs, sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  depend() &#123;</span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      Dep.target.addDep(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="comment">// stabilize the subscriber list first</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="built_in">this</span>.subs.slice()</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; !config.async) &#123;</span><br><span class="line">      <span class="comment">// subs aren&#x27;t sorted in scheduler if not running async</span></span><br><span class="line">      <span class="comment">// we need to sort them now to make sure they fire in correct</span></span><br><span class="line">      <span class="comment">// order</span></span><br><span class="line">      subs.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.id - b.id)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.length; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é€šè¿‡ç±»å‹å¯ä»¥çœ‹åˆ°ï¼Œtarget åº”è¯¥æ˜¯ä¸€ä¸ª Wathcerï¼Œè€Œ Wathcerï¼Œæˆ‘ä»¬å‰é¢æ‰‹å†™ vue å“åº”å¼çš„æ—¶å€™ï¼Œå·²ç»ä»‹ç»çš„å¾ˆæ¸…æ¥šäº†ï¼Œå¦‚æœæœ‰ä¸æ¸…æ¥šçš„ç«¥é‹å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« ï¼š<a href="https://www.notion.so/01-MVVM-24ae2e3c17a9403689c01a73879939de">æ‰‹å†™ç®€æ˜“ MVVM</a>ã€‚</p><p>é‚£ä¹ˆ depend åšäº†ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>æˆ‘ä»¬æ¥åˆ° Watcherï¼š</p><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/observer/watcher.js</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">addDep(dep: Dep) &#123;</span><br><span class="line">  <span class="keyword">const</span> id = dep.id</span><br><span class="line">  <span class="keyword">if</span> (!<span class="built_in">this</span>.newDepIds.has(id)) &#123;</span><br><span class="line">    <span class="built_in">this</span>.newDepIds.add(id)</span><br><span class="line">    <span class="built_in">this</span>.newDeps.push(dep)</span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.depIds.has(id)) &#123;</span><br><span class="line">      dep.addSub(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åšäº†ä¸¤ä¸ªæ“ä½œï¼š</p><ul><li>å»ºç«‹ watcher å’Œ dep çš„å…³ç³»</li><li>åå‘å»ºç«‹ dep å’Œ watcher çš„å…³ç³»</li></ul><p>é‚£ä¹ˆä¸ºä»€ä¹ˆè¦å»ºç«‹åŒå‘çš„å…³ç³»å‘¢ï¼Ÿä¹‹å‰å®ç° mvvm çš„æ—¶å€™ï¼Œä¸æ˜¯å»ºç«‹å•å‘å…³ç³»å°±å¯ä»¥äº†å—ï¼Ÿ</p><p>è¿™ä¸ªé—®é¢˜æˆ‘ä»¬ç¨åå†è¯´ï¼Œç°åœ¨å…ˆæ¥çœ‹çœ‹ä¸Šé¢çš„æœ€åä¸€ä¸ªé—®é¢˜ï¼ŒdependArray åˆåšäº†ä»€ä¹ˆï¼Ÿ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">dependArray</span>(<span class="params">value: Array&lt;any&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> e, i = <span class="number">0</span>, l = value.length; i &lt; l; i++) &#123;</span><br><span class="line">    e = value[i]</span><br><span class="line">    e &amp;&amp; e.__ob__ &amp;&amp; e.__ob__.dep.depend()</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(e)) &#123;</span><br><span class="line">      dependArray(e)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™é‡Œæ˜¯éå†æ•°ç»„ï¼Œå¯¹å…¶æ¯ä¸€ä¸ªå…ƒç´ å»ºç«‹å’Œ dep çš„å…³ç³»ã€‚</p><p>è¿™é‡Œä¸ºäº†ç†æ¸…æ€è·¯ï¼Œè¡¥ä¸Šè„‘å›¾ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff93fea11-2190-4d96-ae32-23d459e17191%2FUntitled.png?table=block&id=8d568f9f-c565-4e37-88c3-547a107ab887&name=Untitled.png&cache=v2"></p><p>ä»å›¾ä¸­æˆ‘ä»¬å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œçš„å…³é”®ç‚¹æ˜¯ï¼š</p><ul><li>Wathcer æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>Dep æ˜¯ä»€ä¹ˆï¼Ÿ</li><li>ä¸ºä»€ä¹ˆè¦å»ºç«‹å®ƒä»¬çš„å…³ç³»ï¼Ÿ</li><li>å»ºç«‹äº†å®ƒä»¬çš„å…³ç³»æœ‰ä»€ä¹ˆç”¨ï¼Ÿ</li></ul><p>å‰é¢å·²ç»å¤šæ¬¡æåˆ° Dep äº†ï¼Œæœ‰ obj ä¸­çš„ Depï¼Œä¹Ÿæœ‰ key ä¸­çš„ Depï¼Œè¿™é‡Œæˆ‘ä»¬å°±å…ˆæ¥çœ‹çœ‹ Depï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">static</span> target: ?Watcher</span><br><span class="line">  id: number</span><br><span class="line">  subs: <span class="built_in">Array</span>&lt;Watcher&gt;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">this</span>.id = uid++</span><br><span class="line">    <span class="built_in">this</span>.subs = []</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  addSub(sub: Watcher) &#123;</span><br><span class="line">    <span class="built_in">this</span>.subs.push(sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  removeSub(sub: Watcher) &#123;</span><br><span class="line">    remove(<span class="built_in">this</span>.subs, sub)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  depend() &#123;</span><br><span class="line">    <span class="keyword">if</span> (Dep.target) &#123;</span><br><span class="line">      Dep.target.addDep(<span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="comment">// stabilize the subscriber list first</span></span><br><span class="line">    <span class="keyword">const</span> subs = <span class="built_in">this</span>.subs.slice()</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; !config.async) &#123;</span><br><span class="line">      <span class="comment">// subs aren&#x27;t sorted in scheduler if not running async</span></span><br><span class="line">      <span class="comment">// we need to sort them now to make sure they fire in correct</span></span><br><span class="line">      <span class="comment">// order</span></span><br><span class="line">      subs.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> a.id - b.id)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = subs.length; i &lt; l; i++) &#123;</span><br><span class="line">      subs[i].update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç å‘Šè¯‰æˆ‘ä»¬å‡ æ¡ä¿¡æ¯ï¼š</p><ul><li>dep ç®¡ç†ç€ä¸€ä¸ªæœ‰ Wathcer ç»„æˆçš„æ•°ç»„</li><li>åœ¨ notify ä¸­ä¼šéå†è¿™ä¸ªæ•°ç»„ï¼Œæ‰§è¡Œå…¶ä¸­çš„ update æ–¹æ³•</li></ul><p>è€Œ update çš„å…·ä½“å®ç°æ¶‰åŠåˆ° vue çš„å¼‚æ­¥æ›´æ–°ï¼Œæ‰€ä»¥è¿™é‡Œå°±ä»…æŠŠå®ƒå½“æˆæ˜¯è§†å›¾æ›´æ–°å‡½æ•°å³å¯ï¼Œæš‚ä¸è®¨è®ºå…¶å…·ä½“å®ç°ã€‚</p><p>é‚£ä¹ˆ Dep å’Œ Watcher çš„å…³ç³»æ˜¯ï¼š<strong>Dep ç®¡ç† Watcherï¼ŒWatcher ç®¡ç†è§†å›¾æ›´æ–°</strong>ã€‚</p><p>åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å·²ç»å¤§è‡´æ¸…æ¥š vue çš„æ•°æ®å“åº”å¼æµç¨‹äº†ï¼Œä¸è¿‡è¿˜å­˜æœ‰ä¸€äº›ç–‘é—®ï¼š</p><ul><li>ä¸ºä»€ä¹ˆè¦å»ºç«‹ Dep å’Œ Watcher çš„åŒå‘å…³ç³»ï¼Ÿ</li><li>å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ</li><li>æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ</li></ul><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥æ¥å›ç­”è¿™äº›é—®é¢˜äº†ï¼š</p><h3 id="ä¸ºä»€ä¹ˆè¦å»ºç«‹-Dep-å’Œ-Watcher-çš„åŒå‘å…³ç³»ï¼Ÿ"><a href="#ä¸ºä»€ä¹ˆè¦å»ºç«‹-Dep-å’Œ-Watcher-çš„åŒå‘å…³ç³»ï¼Ÿ" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å»ºç«‹ Dep å’Œ Watcher çš„åŒå‘å…³ç³»ï¼Ÿ"></a>ä¸ºä»€ä¹ˆè¦å»ºç«‹ Dep å’Œ Watcher çš„åŒå‘å…³ç³»ï¼Ÿ</h3><p>æ€»æ‰€å‘¨çŸ¥ï¼Œvue æ˜¯ç»„ä»¶åŒ–çš„å‰ç«¯æ¡†æ¶ï¼Œé‚£ä¹ˆè‡ªç„¶å°±ä¼šå­˜åœ¨ä¸‹é¢è¿™æ ·çš„æƒ…å†µï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;demo&quot;</span>&gt;</span><br><span class="line">      &lt;h1&gt;Vueç»„ä»¶åŒ–æœºåˆ¶&lt;/h1&gt;</span><br><span class="line">      &lt;comp :msg=<span class="string">&quot;msg&quot;</span>&gt;&lt;/comp&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">      Vue.component(<span class="string">&#x27;comp&#x27;</span>, &#123;</span><br><span class="line">        template: <span class="string">&#x27;&lt;div&gt;I am comp&lt;/div&gt;&#x27;</span>,</span><br><span class="line">                props: [<span class="string">&#x27;msg&#x27;</span>],</span><br><span class="line">        data: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            compMsg: <span class="built_in">this</span>.msg + <span class="string">&#x27;comp&#x27;</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">&#x27;#demo&#x27;</span>,</span><br><span class="line">        data() &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            msg: <span class="string">&#x27;hello vue&#x27;</span>,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">  &lt;/body&gt;</span><br></pre></td></tr></table></figure><p>åœ¨è¿™æ ·çš„æƒ…å†µä¸‹ï¼Œä»…æœ‰ Dep åˆ° Wathcer çš„å…³ç³»æ˜¾ç„¶æ˜¯ä¸å¤Ÿçš„äº†ï¼Œæ‰€ä»¥è¿˜éœ€è¦å»ºç«‹ Wathcer åˆ° Dep çš„å…³ç³»ã€‚</p><h3 id="å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver-ä¸­çš„-Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ"><a href="#å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver-ä¸­çš„-Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ" class="headerlink" title="å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ"></a>å¯¹è±¡ä¾èµ–ç®¡ç†å™¨ï¼ˆObserver ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ</h3><p>è¿™ä¸ªå¾ˆå¥½è§£é‡Šï¼Œå½“ data ä¸­å­˜åœ¨å¯¹è±¡ï¼Œç”šè‡³å¯¹è±¡åµŒå¥—çš„æ—¶å€™ï¼Œä¿®æ”¹å…¶ä¸­çš„å€¼ï¼ŒåŒæ ·éœ€è¦å‡ºå‘è§†å›¾çš„æ›´æ–°ï¼Œè¿™å°±æ˜¯å¯¹è±¡ä¾èµ–ç®¡ç†å™¨çš„ä½œç”¨ã€‚</p><h3 id="æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive-ä¸­çš„-Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ"><a href="#æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive-ä¸­çš„-Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ" class="headerlink" title="æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ"></a>æ•°æ®ä¾èµ–ç®¡ç†å™¨ï¼ˆdefineReactive ä¸­çš„ Depï¼‰æ˜¯å¹²å˜›çš„ï¼Ÿ</h3><p>æœ€ç›´æ¥é€šçŸ¥ Wathcer æ›´æ–°è§†å›¾çš„åœ°æ–¹ã€‚</p><p>è¡¥ä¸Šè„‘å›¾ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/4373eb26-a250-45da-bc4e-f846ac70bc1d/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200817/us-west-2/s3/aws4_request&X-Amz-Date=20200817T080623Z&X-Amz-Expires=86400&X-Amz-Signature=54d3796478432f5f2d3489e18cf3ab75607d87ba3c3292ae4eac6ed96b34d61b&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>åˆ°è¿™é‡Œï¼Œå¯¹è±¡çš„å“åº”å¼å¤„ç†å·²ç»å®Œæˆäº†ï¼Œæˆ‘ä»¬å†æ¥çœ‹çœ‹å¯¹äºæ•°ç»„ï¼Œæ˜¯æ€ä¹ˆæ“ä½œçš„ã€‚</p><h2 id="å¤„ç†æ•°ç»„"><a href="#å¤„ç†æ•°ç»„" class="headerlink" title="å¤„ç†æ•°ç»„"></a>å¤„ç†æ•°ç»„</h2><p>æœ‰å‰é¢çš„ç§¯ç´¯ï¼Œå¯ä»¥å¾ˆå¿«å®šä½åˆ°å¤„ç†æ•°ç»„çš„æ–¹æ³•ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(value)) &#123;</span><br><span class="line">  <span class="keyword">if</span> (hasProto) &#123;</span><br><span class="line">    protoAugment(value, arrayMethods)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    copyAugment(value, arrayMethods, arrayKeys)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>.observeArray(value)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬å…ˆçœ‹çœ‹ <code>observeArray</code>ï¼Œæ¯•ç«Ÿåå­—éƒ½è¿™ä¹ˆç›´ç™½äº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">observeArray(items: <span class="built_in">Array</span>&lt;any&gt;) &#123;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = items.length; i &lt; l; i++) &#123;</span><br><span class="line">    observe(items[i])</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™é‡Œå°±æ˜¯éå†æ•°ç»„ï¼Œå¯¹å…¶æ¯ä¸ªå…ƒç´ è¿›è¡Œå“åº”å¼å¤„ç†ã€‚</p><p>é‚£ä¹ˆæ¥åˆ° <code>protoAugment</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">protoAugment</span>(<span class="params">target, src: Object</span>) </span>&#123;</span><br><span class="line">  <span class="comment">/* eslint-disable no-proto */</span></span><br><span class="line">  target.__proto__ = src</span><br><span class="line">  <span class="comment">/* eslint-enable no-proto */</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä»è°ƒç”¨å¯ä»¥çœ‹åˆ°ï¼Œtarget æ˜¯ä¸€ä¸ªæ•°ç»„å®ä¾‹ï¼Œé‚£ä¹ˆè¿™é‡Œçš„æ“ä½œå°±æ˜¯è¦†ç›–å…¶åŸå‹ã€‚</p><p>é‚£ä¹ˆ src æ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> arrayMethods = <span class="built_in">Object</span>.create(arrayProto)</span><br></pre></td></tr></table></figure><p>å…‰çœ‹è¿™ä¸ªå¥½åƒå¹¶ä¸èƒ½çœ‹å‡ºç‚¹ä»€ä¹ˆï¼Œç»“åˆä¸‹é¢çš„ä»£ç å†çœ‹çœ‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> methodsToPatch = [<span class="string">&#x27;push&#x27;</span>, <span class="string">&#x27;pop&#x27;</span>, <span class="string">&#x27;shift&#x27;</span>, <span class="string">&#x27;unshift&#x27;</span>, <span class="string">&#x27;splice&#x27;</span>, <span class="string">&#x27;sort&#x27;</span>, <span class="string">&#x27;reverse&#x27;</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Intercept mutating methods and emit events</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line">methodsToPatch.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">method</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// cache original method</span></span><br><span class="line">  <span class="keyword">const</span> original = arrayProto[method]</span><br><span class="line">  def(arrayMethods, method, <span class="function"><span class="keyword">function</span> <span class="title">mutator</span>(<span class="params">...args</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> result = original.apply(<span class="built_in">this</span>, args)</span><br><span class="line">    <span class="keyword">const</span> ob = <span class="built_in">this</span>.__ob__</span><br><span class="line">    <span class="keyword">let</span> inserted</span><br><span class="line">    <span class="keyword">switch</span> (method) &#123;</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;push&#x27;</span>:</span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;unshift&#x27;</span>:</span><br><span class="line">        inserted = args</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      <span class="keyword">case</span> <span class="string">&#x27;splice&#x27;</span>:</span><br><span class="line">        inserted = args.slice(<span class="number">2</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (inserted) ob.observeArray(inserted)</span><br><span class="line">    <span class="comment">// notify change</span></span><br><span class="line">    ob.dep.notify()</span><br><span class="line">    <span class="keyword">return</span> result</span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™é‡Œé€šè¿‡è£…é¥°å™¨æ–¹æ³•å¯¹ <code>methodsToPatch</code> ä¸­çš„ä¸ƒä¸ªæ•°ç»„æ–¹æ³•è¿›è¡Œäº†æ‰©å±•ã€‚</p><p>å¤§è‡´åˆ†ä¸ºä»¥ä¸‹å‡ æ­¥ï¼š</p><ul><li>å…ˆæ‰§è¡ŒåŸæ¥çš„æ•°ç»„æ–¹æ³•ï¼ˆåŸæœ‰åŠŸèƒ½ä¸å˜ï¼‰</li><li>å¯¹äºæ–°æ’å…¥çš„æ•°æ®ï¼Œ åšå“åº”å¼å¤„ç†ï¼š<code>if (inserted) ob.observeArray(inserted)</code></li><li>é€šçŸ¥ watcher æ›´æ–°è§†å›¾ï¼š<code>ob.dep.notify()</code></li></ul><p>æœ€ç»ˆè„‘å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/bcb22159-5ef1-43d5-8b72-e2b994a608ea/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200817/us-west-2/s3/aws4_request&X-Amz-Date=20200817T080642Z&X-Amz-Expires=86400&X-Amz-Signature=73390add1165cce038d33e18a5332858d39bc32607e3365eace327cba22304c1&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´ä½³é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/8c0511b31a0745c4bc866d98dee89c39">Vue 2.6 æºç åˆ†æä¹‹æ—… - äºŒï¼šæ•°æ®å“åº”å¼</a></p><p>é‚£ä¹ˆæœ¬ç¯‡çš„ç²—æµ…åˆ†æåˆ°æ­¤ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„æ¥æ—¥å†è®®è®ºå§ï¼<br>å’•å’•å’•~ ğŸ¥ ğŸ¥ ğŸ¥</p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue 2.6 æºç åˆ†æä¹‹æ—…ã€1ã€‘ â€”â€” åˆå§‹åŒ–æµç¨‹</title>
      <link href="/2020/08/13/2020-08-12_1/"/>
      <url>/2020/08/13/2020-08-12_1/</url>
      
        <content type="html"><![CDATA[<p>Vue æºç è¿˜æ˜¯æ¯”è¾ƒåºå¤§çš„ï¼Œå¦‚æœåˆ†ææºç æ²¡æœ‰æ¡ç†ï¼Œç›´æ¥ä¸€å¤´æ‰è¿›å»ï¼Œå¾ˆå®¹æ˜“é™·è¿›ä»£ç æµ·ä¸­ï¼Œä¸€é€šåˆ†æä¸‹æ¥ä¸€å¤´é›¾æ°´ï¼Œè¿˜æ‰“å‡»ä¿¡å¿ƒã€‚</p><p>é‚£ä¹ˆåº”è¯¥æ€ä¹ˆåˆ†ææºç å‘¢ï¼Ÿ</p><p>ä»¥ä¸‹æ˜¯ä¸ªäººæ€»ç»“çš„å‡ ç‚¹ç»éªŒï¼Œå¦‚æœ‰è°¬è¯¯ä¹‹å¤„ï¼Œæœ›æŒ‡å‡ºï¼š</p><ul><li>é¦–è¦ä»»åŠ¡æ˜¯æ‰¾åˆ°å…¥å£ï¼Œå¦‚ Vue åˆ™æ‰¾åˆ°å…¶æ„é€ å‡½æ•°</li><li>å…ˆç†æ¸…ä¸»çº¿ï¼Œååˆ†æå®ç°ï¼Œåˆ«è¢«ç»†ææœ«èŠ‚çš„ä»£ç å½±å“æ€è·¯</li></ul><p>é‚£ä¹ˆæ¥ä¸‹æ¥ï¼Œæˆ‘ä»¬å°±æ¥å°è¯•æ‰¾æ‰¾ Vue çš„æ„é€ å‡½æ•°å§ï¼</p><a id="more"></a><h2 id="å¯»æ‰¾æ„é€ å‡½æ•°"><a href="#å¯»æ‰¾æ„é€ å‡½æ•°" class="headerlink" title="å¯»æ‰¾æ„é€ å‡½æ•°"></a>å¯»æ‰¾æ„é€ å‡½æ•°</h2><p>å¯¹äºè¿™ä¸ªé—®é¢˜ï¼Œæˆ‘ä»¬å¯ä»¥åˆ©ç”¨è°ƒè¯•å™¨ï¼Œç”¨æœ€ç›´æ¥çš„åŠæ³•å®šä½åˆ°å…¥å£æ–‡ä»¶ã€‚</p><p>é¦–å…ˆç¼–å†™æµ‹è¯• demoï¼Œå°†æ–­ç‚¹å®šåœ¨ <code>new Vue(&#123;&#125;)</code> å¤„ï¼Œé€šè¿‡ f11 è¿›å…¥æ„é€ å‡½æ•°ï¼Œç„¶åé€šè¿‡é¼ æ ‡å³é”®å®šä½åˆ°ç›®æ ‡æ–‡ä»¶ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/13c626a5-0b11-42f0-84a7-7d0d30f5a796/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200812/us-west-2/s3/aws4_request&X-Amz-Date=20200812T081104Z&X-Amz-Expires=86400&X-Amz-Signature=5129d2be261da3e658e60c84a935d5b058ddd816be91cd5729511aea3ee8bfe2&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; !(<span class="built_in">this</span> <span class="keyword">instanceof</span> Vue)) &#123;</span><br><span class="line">    warn(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>._init(options)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œè¿™å°±æ˜¯ Vue çš„æ„é€ å‡½æ•°äº†ï¼Œå…¶æ–‡ä»¶è·¯å¾„ä¸ºï¼š<code>src/core/instance/index.js</code> ã€‚</p><p>å½“ç„¶ï¼Œä¸Šé¢çš„æ–¹æ³•èƒ½å¤Ÿå¿«é€Ÿæœ‰æ•ˆçš„å®šä½åˆ°ç›®æ ‡æ–‡ä»¶ï¼Œè¿™èƒ½æé«˜æˆ‘ä»¬çš„åˆ†ææ•ˆç‡ï¼Œä½†è¿™é‡Œæˆ‘ä»¬ä¹Ÿå¯ä»¥å°è¯•ä¸€ä¸‹å¦ä¸€ç§ç±»ä¼¼è§£å¯†çš„åˆ†ææ€è·¯ï¼Œä»è››ä¸é©¬è¿¹ä¸­æ‰¾åˆ°ç­”æ¡ˆï¼š</p><p>é¦–å…ˆæˆ‘ä»¬æ¥çœ‹çœ‹ <code>pakage.json</code>ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&quot;dev&quot;: &quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev&quot;</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œæˆ‘ä»¬å¯ä»¥å¾—åˆ°ä¸¤ä¸ªä¿¡æ¯ï¼š</p><ul><li>é…ç½®æ–‡ä»¶æ˜¯ <code>scripts/config.js</code></li><li>ç¯å¢ƒå˜é‡æ˜¯ <code>TARGET:web-full-dev</code></li></ul><p>é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ° <code>scripts/config.js</code>ï¼Œå®šä½åˆ° <code>web-full-dev</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;web-full-dev&#x27;</span>: &#123;</span><br><span class="line">    entry: resolve(<span class="string">&#x27;web/entry-runtime-with-compiler.js&#x27;</span>),</span><br><span class="line">    dest: resolve(<span class="string">&#x27;dist/vue.js&#x27;</span>),</span><br><span class="line">    format: <span class="string">&#x27;umd&#x27;</span>,</span><br><span class="line">    env: <span class="string">&#x27;development&#x27;</span>,</span><br><span class="line">    alias: &#123; <span class="attr">he</span>: <span class="string">&#x27;./entity-decoder&#x27;</span> &#125;,</span><br><span class="line">    banner</span><br><span class="line">  &#125;,</span><br></pre></td></tr></table></figure><p>ä»è¿™é‡Œå¯ä»¥çœ‹åˆ°å…¥å£æ–‡ä»¶æ˜¯ <code>web/entry-runtime-with-compiler.js</code>ï¼Œä½†è¿™ä¸ª web æ˜¯å“ªä¸ªç›®å½•å‘¢ï¼Ÿåœ¨ vscode ä¸­åˆ©ç”¨ <code>ctrl + é¼ æ ‡å·¦é”®</code> å¯ä»¥æ¥åˆ° resolve å‡½æ•°çš„å®šä¹‰å¤„ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> resolve = <span class="function">(<span class="params">p</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// web/...</span></span><br><span class="line">  <span class="keyword">const</span> base = p.split(<span class="string">&#x27;/&#x27;</span>)[<span class="number">0</span>]</span><br><span class="line">  <span class="keyword">if</span> (aliases[base]) &#123;</span><br><span class="line">    <span class="keyword">return</span> path.resolve(aliases[base], p.slice(base.length + <span class="number">1</span>))</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> path.resolve(__dirname, <span class="string">&#x27;../&#x27;</span>, p)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ resolve æ–¹æ³•çš„è¿”å›æ˜¯ aliases[base] + pathï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¥çœ‹çœ‹ aliases æ˜¯ä»€ä¹ˆï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">module</span>.exports = &#123;</span><br><span class="line">  vue: resolve(<span class="string">&#x27;src/platforms/web/entry-runtime-with-compiler&#x27;</span>),</span><br><span class="line">  compiler: resolve(<span class="string">&#x27;src/compiler&#x27;</span>),</span><br><span class="line">  core: resolve(<span class="string">&#x27;src/core&#x27;</span>),</span><br><span class="line">  shared: resolve(<span class="string">&#x27;src/shared&#x27;</span>),</span><br><span class="line">  web: resolve(<span class="string">&#x27;src/platforms/web&#x27;</span>),</span><br><span class="line">  weex: resolve(<span class="string">&#x27;src/platforms/weex&#x27;</span>),</span><br><span class="line">  server: resolve(<span class="string">&#x27;src/server&#x27;</span>),</span><br><span class="line">  sfc: resolve(<span class="string">&#x27;src/sfc&#x27;</span>),</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œç»“æœå°±å‡ºæ¥äº†ï¼Œå…¥å£æ–‡ä»¶æ˜¯ï¼š<code>src/platforms/web/entry-runtime-with-compiler.js</code>ï¼Œæ¥åˆ°è®©æˆ‘ä»¬æ¥åˆ°è¿™ä¸ªæ–‡ä»¶ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mount = Vue.prototype.$mount</span><br><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params">el?: string | Element, hydrating?: boolean</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  el = el &amp;&amp; query(el)</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (el === <span class="built_in">document</span>.body || el === <span class="built_in">document</span>.documentElement) &#123;</span><br><span class="line">    process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp;</span><br><span class="line">      warn(<span class="string">`Do not mount Vue to &lt;html&gt; or &lt;body&gt; - mount to normal elements instead.`</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">const</span> options = <span class="built_in">this</span>.$options</span><br><span class="line">  <span class="keyword">if</span> (!options.render) &#123;</span><br><span class="line">    <span class="keyword">let</span> template = options.template</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="keyword">if</span> (<span class="keyword">typeof</span> template === <span class="string">&#x27;string&#x27;</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (template.charAt(<span class="number">0</span>) === <span class="string">&#x27;#&#x27;</span>) &#123;</span><br><span class="line">          template = idToTemplate(template)</span><br><span class="line">          <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">          <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; !template) &#123;</span><br><span class="line">            warn(<span class="string">`Template element not found or is empty: <span class="subst">$&#123;options.template&#125;</span>`</span>, <span class="built_in">this</span>)</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> <span class="keyword">if</span> (template.nodeType) &#123;</span><br><span class="line">        template = template.innerHTML</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">          warn(<span class="string">&#x27;invalid template option:&#x27;</span> + template, <span class="built_in">this</span>)</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">this</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (el) &#123;</span><br><span class="line">      template = getOuterHTML(el)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (template) &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">        mark(<span class="string">&#x27;compile&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">      <span class="keyword">const</span> &#123; render, staticRenderFns &#125; = compileToFunctions(</span><br><span class="line">        template,</span><br><span class="line">        &#123;</span><br><span class="line">          outputSourceRange: process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>,</span><br><span class="line">          shouldDecodeNewlines,</span><br><span class="line">          shouldDecodeNewlinesForHref,</span><br><span class="line">          delimiters: options.delimiters,</span><br><span class="line">          comments: options.comments,</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="built_in">this</span></span><br><span class="line">      )</span><br><span class="line">      options.render = render</span><br><span class="line">      options.staticRenderFns = staticRenderFns</span><br><span class="line"></span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">        mark(<span class="string">&#x27;compile end&#x27;</span>)</span><br><span class="line">        measure(<span class="string">`vue <span class="subst">$&#123;<span class="built_in">this</span>._name&#125;</span> compile`</span>, <span class="string">&#x27;compile&#x27;</span>, <span class="string">&#x27;compile end&#x27;</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> mount.call(<span class="built_in">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–‡ä»¶æœ€ä¸»è¦çš„åŠŸèƒ½æ˜¯æ‰©å±•äº† web å¹³å°éœ€è¦çš„ <code>$mount</code>ï¼Œè¿™ä¹Ÿè¯´æ˜åŸºæœ¬çš„ <code>$mount</code> æ˜¯ä¸æ»¡è¶³ web å¹³å°çš„éœ€æ±‚çš„ã€‚</p><p>åœ¨è¿™ä¸ªå‡½æ•°ä¸­ï¼Œèƒ½çœ‹åˆ°ä»¥ä¸‹æ¯”è¾ƒé‡è¦çš„é€»è¾‘ï¼š</p><ul><li>å¦‚æœå­˜åœ¨ render å‡½æ•°ï¼Œåˆ™ä¸å†å…³æ³¨ template å’Œ el</li><li>å½“ä¸å­˜åœ¨ render å‡½æ•°ï¼Œåˆ™ä¼˜å…ˆå…³æ³¨ template</li><li>å½“åŒæ—¶ä¸å­˜åœ¨ render å’Œ templateï¼Œåˆ™æœ€ç»ˆé€‰æ‹© elï¼Œå¹¶ä¸”é€šè¿‡ <code>getOuterHTML</code> å°†å…¶è½¬åŒ–ä¸º template</li><li>å¤„ç†å®Œä¸Šé¢çš„é€»è¾‘ä¹‹åå°† template é€šè¿‡ <code>compileToFunctions</code> ç¼–è¯‘æˆ render å‡½æ•°</li><li>æœ€åè°ƒç”¨ mount å°†å†…å®¹æŒ‚è½½åˆ° root èŠ‚ç‚¹ä¸Š</li></ul><p>ä¼˜å…ˆçº§ï¼šrender &gt; template &gt; el</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° Vue æ˜¯å¤–éƒ¨å¼•å…¥çš„ï¼Œä½ç½®å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;./runtime/index&#x27;</span></span><br></pre></td></tr></table></figure><p>éšæœºæ¥åˆ°ç›®æ ‡æ–‡ä»¶ <code>src/platforms/webs/runtime/index.js</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.__patch__ = inBrowser ? patch : noop</span><br><span class="line"></span><br><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params">el?: string | Element, hydrating?: boolean</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? query(el) : <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">return</span> mountComponent(<span class="built_in">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°è¿™ä¸ªæ–‡ä»¶ä¸»è¦åšäº†ä¸€äº›å¯¹ vue æ‰©å±•çš„äº‹æƒ…ï¼Œæœ€ä¸ºå…³é”®çš„ä¸¤ç‚¹åˆ™æ˜¯ä¸Šé¢ä»£ç ä¸­çš„éƒ¨åˆ†ï¼š</p><ul><li>å®‰è£…äº†å¹³å°ç‰¹æœ‰çš„ <strong><code>__patch__</code></strong> å‡½æ•°ï¼Œå®ƒçš„åŠŸèƒ½æ˜¯å°†è™šæ‹Ÿ dom è½¬åŒ–æˆçœŸå® domï¼Œè€Œ diff ä¹Ÿå°†åœ¨è¿™é‡Œå‘ç”Ÿ</li><li>å®ç°äº† <code>$mount</code>ï¼Œä¸è¿‡è¿™é‡Œä¹Ÿåªæ˜¯å¯¹ mountComponent çš„ä¸€å±‚å°è£…ï¼Œå¹¶æ²¡æœ‰è§¦åŠçœŸæ­£çš„åŠŸèƒ½ä»£ç </li></ul><p>æ¥ä¸‹æ¥æˆ‘ä»¬ç»§ç»­é¡ºç€å¼•å…¥ Vue çš„çº¿ç´¢æ¨è¿›ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;core/index&#x27;</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯æ¥åˆ°æ–‡ä»¶ <code>src/core/index</code>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">initGlobalAPI(Vue)</span><br></pre></td></tr></table></figure><p>æ–‡ä»¶çš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯åˆå§‹åŒ–å…¨å±€çš„ APIï¼Œäºæ˜¯ç¦»å¼€è¿™é‡Œï¼Œç»§ç»­æ·±å…¥ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;./instance/index&#x27;</span></span><br></pre></td></tr></table></figure><p>ç»ˆäºæ¥åˆ°äº† Vue çš„æ„é€ å‡½æ•°ï¼Œä»£ç åœ¨æœ€ä¸Šé¢å·²ç»è´´å‡ºï¼Œè¿™é‡Œå°±ä¸å†è´´äº†ã€‚</p><p>è„‘å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/aab5df86-ae2f-483f-935c-1fddad551dbd/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200812/us-west-2/s3/aws4_request&X-Amz-Date=20200812T081247Z&X-Amz-Expires=86400&X-Amz-Signature=2c8a6491c650faf82e82aa5bfe3887b94368d91c95a0ac6270ffae6f6a5db94f&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><h2 id="åˆå§‹åŒ–æµç¨‹åˆ†æ"><a href="#åˆå§‹åŒ–æµç¨‹åˆ†æ" class="headerlink" title="åˆå§‹åŒ–æµç¨‹åˆ†æ"></a>åˆå§‹åŒ–æµç¨‹åˆ†æ</h2><p>è¦åˆ†æ Vue åˆå§‹åŒ–æµç¨‹ï¼Œæˆ‘ä»¬å…ˆæ¥çœ‹çœ‹æ„é€ å‡½æ•°æ–‡ä»¶å§ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> &#123; initMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./init&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; stateMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./state&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; renderMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./render&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; eventsMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./events&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; lifecycleMixin &#125; <span class="keyword">from</span> <span class="string">&#x27;./lifecycle&#x27;</span></span><br><span class="line"><span class="keyword">import</span> &#123; warn &#125; <span class="keyword">from</span> <span class="string">&#x27;../util/index&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Vue</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; !(<span class="built_in">this</span> <span class="keyword">instanceof</span> Vue)) &#123;</span><br><span class="line">    warn(<span class="string">&#x27;Vue is a constructor and should be called with the `new` keyword&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">this</span>._init(options)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">initMixin(Vue)</span><br><span class="line">stateMixin(Vue)</span><br><span class="line">eventsMixin(Vue)</span><br><span class="line">lifecycleMixin(Vue)</span><br><span class="line">renderMixin(Vue)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Vue</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œåœ¨æ„é€ å‡½æ•°ä¸­æ‰§è¡Œäº†ä¸€ä¸ª <code>this._init()</code> æ–¹æ³•è¿›è¡Œåˆå§‹åŒ–ï¼Œé‚£ä¹ˆè¿™ä¸ªæ–¹æ³•ä»ä½•è€Œæ¥å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å¾€ä¸‹ï¼Œå‘ç° <code>initMixin(Vue)</code> è¿™ä¸ªæ–¹æ³•ï¼Œé¡¾åæ€ä¹‰ï¼Œè¿™åº”è¯¥æ˜¯ä¸º Vue æ‰©å±• init çš„æ–¹æ³•ï¼Œäºæ˜¯è·³è½¬è¿›å»çœ‹çœ‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initMixin</span>(<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  Vue.prototype._init = <span class="function"><span class="keyword">function</span> (<span class="params">options?: Object</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    vm._uid = uid++</span><br><span class="line"></span><br><span class="line">    <span class="keyword">let</span> startTag, endTag</span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">      startTag = <span class="string">`vue-perf-start:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      endTag = <span class="string">`vue-perf-end:<span class="subst">$&#123;vm._uid&#125;</span>`</span></span><br><span class="line">      mark(startTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// a flag to avoid this being observed</span></span><br><span class="line">    vm._isVue = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">if</span> (options &amp;&amp; options._isComponent) &#123;</span><br><span class="line">      <span class="comment">// optimize internal component instantiation</span></span><br><span class="line">      <span class="comment">// since dynamic options merging is pretty slow, and none of the</span></span><br><span class="line">      <span class="comment">// internal component options needs special treatment.</span></span><br><span class="line">      initInternalComponent(vm, options)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm.$options = mergeOptions(resolveConstructorOptions(vm.constructor), options || &#123;&#125;, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      initProxy(vm)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vm._renderProxy = vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// expose real self</span></span><br><span class="line">    vm._self = vm</span><br><span class="line">    initLifecycle(vm)</span><br><span class="line">    initEvents(vm)</span><br><span class="line">    initRender(vm)</span><br><span class="line">    callHook(vm, <span class="string">&#x27;beforeCreate&#x27;</span>)</span><br><span class="line">    initInjections(vm)</span><br><span class="line">    initState(vm)</span><br><span class="line">    initProvide(vm)</span><br><span class="line">    callHook(vm, <span class="string">&#x27;created&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">      vm._name = formatComponentName(vm, <span class="literal">false</span>)</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(<span class="string">`vue <span class="subst">$&#123;vm._name&#125;</span> init`</span>, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (vm.$options.el) &#123;</span><br><span class="line">      vm.$mount(vm.$options.el)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœç„¶ï¼Œ<code>_init()</code> æ˜¯åœ¨è¿™é‡Œæ‰©å±•çš„ï¼Œå®ƒåšäº†äº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>ä»”ç»†é˜…è¯»åå¯ä»¥çŸ¥é“ï¼Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½æœ‰ä¸¤ç‚¹ï¼š</p><ul><li>è¿›è¡Œå„ç§åˆå§‹åŒ–æ“ä½œ</li><li>å¦‚æœè®¾ç½®äº† elï¼Œåˆ™è‡ªåŠ¨è°ƒç”¨ <code>$mount</code> è¿›è¡ŒæŒ‚è½½</li></ul><p>ç»§ç»­æ·±å…¥ï¼Œæ¥çœ‹çœ‹å…·ä½“æ‰§è¡Œäº†å“ªäº›åˆå§‹åŒ–æ“ä½œï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">initLifecycle(vm)</span><br><span class="line">initEvents(vm)</span><br><span class="line">initRender(vm)</span><br><span class="line">callHook(vm, <span class="string">&#x27;beforeCreate&#x27;</span>)</span><br><span class="line">initInjections(vm)</span><br><span class="line">initState(vm)</span><br><span class="line">initProvide(vm)</span><br><span class="line">callHook(vm, <span class="string">&#x27;created&#x27;</span>)</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€ä¸€åˆ†æï¼š</p><h3 id="initLifecycle-vm"><a href="#initLifecycle-vm" class="headerlink" title="initLifecycle(vm)"></a>initLifecycle(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/lifecycle.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initLifecycle</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> options = vm.$options</span><br><span class="line"></span><br><span class="line">  <span class="comment">// locate first non-abstract parent</span></span><br><span class="line">  <span class="keyword">let</span> parent = options.parent</span><br><span class="line">  <span class="keyword">if</span> (parent &amp;&amp; !options.abstract) &#123;</span><br><span class="line">    <span class="keyword">while</span> (parent.$options.abstract &amp;&amp; parent.$parent) &#123;</span><br><span class="line">      parent = parent.$parent</span><br><span class="line">    &#125;</span><br><span class="line">    parent.$children.push(vm)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  vm.$parent = parent</span><br><span class="line">  vm.$root = parent ? parent.$root : vm</span><br><span class="line"></span><br><span class="line">  vm.$children = []</span><br><span class="line">  vm.$refs = &#123;&#125;</span><br><span class="line"></span><br><span class="line">  vm._watcher = <span class="literal">null</span></span><br><span class="line">  vm._inactive = <span class="literal">null</span></span><br><span class="line">  vm._directInactive = <span class="literal">false</span></span><br><span class="line">  vm._isMounted = <span class="literal">false</span></span><br><span class="line">  vm._isDestroyed = <span class="literal">false</span></span><br><span class="line">  vm._isBeingDestroyed = <span class="literal">false</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åˆå§‹åŒ–äº†ä»¥ä¸‹å…³ç³»ï¼š</p><ul><li>$root</li><li>$parent</li><li>$children</li><li>$refs</li></ul><h3 id="initEvents-vm"><a href="#initEvents-vm" class="headerlink" title="initEvents(vm)"></a>initEvents(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/events.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initEvents</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">  vm._hasHookEvent = <span class="literal">false</span></span><br><span class="line">  <span class="comment">// init parent attached events</span></span><br><span class="line">  <span class="keyword">const</span> listeners = vm.$options._parentListeners</span><br><span class="line">  <span class="keyword">if</span> (listeners) &#123;</span><br><span class="line">    updateComponentListeners(vm, listeners)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåˆå§‹åŒ–äº†äº‹ä»¶çš„ç›‘å¬è€…ã€‚</p><h3 id="initRender-vm"><a href="#initRender-vm" class="headerlink" title="initRender(vm)"></a>initRender(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/render.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initRender</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._vnode = <span class="literal">null</span> <span class="comment">// the root of the child tree</span></span><br><span class="line">  vm._staticTrees = <span class="literal">null</span> <span class="comment">// v-once cached trees</span></span><br><span class="line">  <span class="keyword">const</span> options = vm.$options</span><br><span class="line">  <span class="keyword">const</span> parentVnode = (vm.$vnode = options._parentVnode) <span class="comment">// the placeholder node in parent tree</span></span><br><span class="line">  <span class="keyword">const</span> renderContext = parentVnode &amp;&amp; parentVnode.context</span><br><span class="line">  vm.$slots = resolveSlots(options._renderChildren, renderContext)</span><br><span class="line">  vm.$scopedSlots = emptyObject</span><br><span class="line">  <span class="comment">// bind the createElement fn to this instance</span></span><br><span class="line">  <span class="comment">// so that we get proper render context inside it.</span></span><br><span class="line">  <span class="comment">// args order: tag, data, children, normalizationType, alwaysNormalize</span></span><br><span class="line">  <span class="comment">// internal version is used by render functions compiled from templates</span></span><br><span class="line">  vm._c = <span class="function">(<span class="params">a, b, c, d</span>) =&gt;</span> createElement(vm, a, b, c, d, <span class="literal">false</span>)</span><br><span class="line">  <span class="comment">// normalization is always applied for the public version, used in</span></span><br><span class="line">  <span class="comment">// user-written render functions.</span></span><br><span class="line">  vm.$createElement = <span class="function">(<span class="params">a, b, c, d</span>) =&gt;</span> createElement(vm, a, b, c, d, <span class="literal">true</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// $attrs &amp; $listeners are exposed for easier HOC creation.</span></span><br><span class="line">  <span class="comment">// they need to be reactive so that HOCs using them are always updated</span></span><br><span class="line">  <span class="keyword">const</span> parentData = parentVnode &amp;&amp; parentVnode.data</span><br><span class="line"></span><br><span class="line">  <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    defineReactive(</span><br><span class="line">      vm,</span><br><span class="line">      <span class="string">&#x27;$attrs&#x27;</span>,</span><br><span class="line">      (parentData &amp;&amp; parentData.attrs) || emptyObject,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        !isUpdatingChildComponent &amp;&amp; warn(<span class="string">`$attrs is readonly.`</span>, vm)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    )</span><br><span class="line">    defineReactive(</span><br><span class="line">      vm,</span><br><span class="line">      <span class="string">&#x27;$listeners&#x27;</span>,</span><br><span class="line">      options._parentListeners || emptyObject,</span><br><span class="line">      () =&gt; &#123;</span><br><span class="line">        !isUpdatingChildComponent &amp;&amp; warn(<span class="string">`$listeners is readonly.`</span>, vm)</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="literal">true</span></span><br><span class="line">    )</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    defineReactive(vm, <span class="string">&#x27;$attrs&#x27;</span>, (parentData &amp;&amp; parentData.attrs) || emptyObject, <span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">    defineReactive(vm, <span class="string">&#x27;$listeners&#x27;</span>, options._parentListeners || emptyObject, <span class="literal">null</span>, <span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œä¸»è¦åˆå§‹åŒ–äº†ä¸¤ä¸ªæ–¹æ³•ï¼š</p><ul><li><code>$slots</code></li><li><code>$createElement</code></li></ul><h3 id="callHook-vm-â€˜beforeCreateâ€™"><a href="#callHook-vm-â€˜beforeCreateâ€™" class="headerlink" title="callHook(vm, â€˜beforeCreateâ€™)"></a>callHook(vm, â€˜beforeCreateâ€™)</h3><p>ä¸€ç›´åˆ°è¿™é‡Œï¼Œéƒ½å¤„äº Vue ç”Ÿå‘½å‘¨æœŸä¸­çš„ <strong>beforeCreate</strong>ï¼Œè€Œä¸Šé¢çš„ä»£ç ä¸­å®Œå…¨æ²¡æœ‰å¯¹ data çš„å¤„ç†ï¼Œæ‰€ä»¥åœ¨ <strong>beforeCreate</strong> ä¸­æ˜¾ç„¶æ˜¯æ— æ³•è·å–åˆ° data çš„ã€‚</p><h3 id="initInjections-vm"><a href="#initInjections-vm" class="headerlink" title="initInjections(vm)"></a>initInjections(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/inject.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initInjections</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> result = resolveInject(vm.$options.inject, vm)</span><br><span class="line">  <span class="keyword">if</span> (result) &#123;</span><br><span class="line">    toggleObserving(<span class="literal">false</span>)</span><br><span class="line">    <span class="built_in">Object</span>.keys(result).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">        defineReactive(vm, key, result[key], <span class="function">() =&gt;</span> &#123;</span><br><span class="line">          warn(</span><br><span class="line">            <span class="string">`Avoid mutating an injected value directly since the changes will be `</span> +</span><br><span class="line">              <span class="string">`overwritten whenever the provided component re-renders. `</span> +</span><br><span class="line">              <span class="string">`injection being mutated: &quot;<span class="subst">$&#123;key&#125;</span>&quot;`</span>,</span><br><span class="line">            vm</span><br><span class="line">          )</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        defineReactive(vm, key, result[key])</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">    toggleObserving(<span class="literal">true</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ³¨å…¥äº†ç¥–è¾ˆä¸­çš„æ•°æ®ï¼Œä»¥ä¾¿åœ¨åé¢æ¥æ”¶ã€‚</p><h3 id="initState-vm"><a href="#initState-vm" class="headerlink" title="initState(vm)"></a>initState(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/state.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initState</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  vm._watchers = []</span><br><span class="line">  <span class="keyword">const</span> opts = vm.$options</span><br><span class="line">  <span class="keyword">if</span> (opts.props) initProps(vm, opts.props)</span><br><span class="line">  <span class="keyword">if</span> (opts.methods) initMethods(vm, opts.methods)</span><br><span class="line">  <span class="keyword">if</span> (opts.data) &#123;</span><br><span class="line">    initData(vm)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    observe((vm._data = &#123;&#125;), <span class="literal">true</span> <span class="comment">/* asRootData */</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (opts.computed) initComputed(vm, opts.computed)</span><br><span class="line">  <span class="keyword">if</span> (opts.watch &amp;&amp; opts.watch !== nativeWatch) &#123;</span><br><span class="line">    initWatch(vm, opts.watch)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œåˆå§‹åŒ–äº†æˆ‘ä»¬ç†ŸçŸ¥çš„å¯¹è±¡ï¼š</p><ul><li>props</li><li>methods</li><li>data</li><li>computed</li><li>watch</li></ul><p>ä»æµç¨‹ä¹Ÿå¯ä»¥çœ‹åˆ°ï¼Œdata æ˜¯æ™šäº propsï¼Œå…ˆäº computed çš„ï¼Œè¿™ä¹Ÿèƒ½è§£å†³å¹³æ—¶å¾ˆå¤šå›°æ‰°æˆ‘ä»¬çš„é—®é¢˜ã€‚</p><h3 id="initProvide-vm"><a href="#initProvide-vm" class="headerlink" title="initProvide(vm)"></a>initProvide(vm)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/inject.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">initProvide</span>(<span class="params">vm: Component</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> provide = vm.$options.provide</span><br><span class="line">  <span class="keyword">if</span> (provide) &#123;</span><br><span class="line">    vm._provided = <span class="keyword">typeof</span> provide === <span class="string">&#x27;function&#x27;</span> ? provide.call(vm) : provide</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå¯¹å‰é¢æ³¨å…¥çš„æ•°æ®è¿›è¡Œäº†æ¥æ”¶ã€‚</p><h3 id="callHook-vm-â€˜createdâ€™"><a href="#callHook-vm-â€˜createdâ€™" class="headerlink" title="callHook(vm, â€˜createdâ€™)"></a>callHook(vm, â€˜createdâ€™)</h3><p>è¿™é‡Œè°ƒç”¨ç”Ÿå‘½é’©å­ï¼Œè¯´æ˜åˆ° <strong>created</strong> é˜¶æ®µï¼Œç»„ä»¶å·²ç»æˆåŠŸåˆ›å»ºï¼Œæ‰€ä»¥åˆå§‹åŒ–å·¥ä½œå·²ç»å®Œæˆã€‚</p><p>ä¸‹é¢è´´ä¸Šè„‘å›¾ï¼Œæ–¹ä¾¿å¤§å®¶å‚è€ƒï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F6d7c4cff-625a-469b-9a28-ddd02ab3d449%2FUntitled.png?table=block&id=4f5bdb39-4be2-480b-a824-5743de54ffbd&name=Untitled.png&cache=v2"></p><p>æ¥ä¸‹æ¥æˆ‘ä»¬å›åˆ°æ„é€ å‡½æ•°ï¼Œçœ‹çœ‹å‰©ä¸‹çš„ Mixin éƒ½åšäº†äº›ä»€ä¹ˆï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">initMixin(Vue)</span><br><span class="line">stateMixin(Vue)</span><br><span class="line">eventsMixin(Vue)</span><br><span class="line">lifecycleMixin(Vue)</span><br><span class="line">renderMixin(Vue)</span><br></pre></td></tr></table></figure><p><code>initMixin()</code> ä¸Šé¢åˆšåˆ†æå®Œï¼ŒåŒæ ·çš„ï¼Œæˆ‘ä»¬ä¸€æ­¥ä¸€æ­¥æ¥çœ‹çœ‹ä¸‹é¢çš„ Mixin éƒ½åšäº†äº›ä»€ä¹ˆå§ï¼</p><h3 id="stateMixin-Vue"><a href="#stateMixin-Vue" class="headerlink" title="stateMixin(Vue)"></a>stateMixin(Vue)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/state.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">stateMixin</span>(<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// flow somehow has problems with directly declared definition object</span></span><br><span class="line">  <span class="comment">// when using Object.defineProperty, so we have to procedurally build up</span></span><br><span class="line">  <span class="comment">// the object here.</span></span><br><span class="line">  <span class="keyword">const</span> dataDef = &#123;&#125;</span><br><span class="line">  dataDef.get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._data</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">const</span> propsDef = &#123;&#125;</span><br><span class="line">  propsDef.get = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">this</span>._props</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">    dataDef.set = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      warn(<span class="string">&#x27;Avoid replacing instance root $data. &#x27;</span> + <span class="string">&#x27;Use nested data properties instead.&#x27;</span>, <span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    propsDef.set = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">      warn(<span class="string">`$props is readonly.`</span>, <span class="built_in">this</span>)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">&#x27;$data&#x27;</span>, dataDef)</span><br><span class="line">  <span class="built_in">Object</span>.defineProperty(Vue.prototype, <span class="string">&#x27;$props&#x27;</span>, propsDef)</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$set = set</span><br><span class="line">  Vue.prototype.$delete = del</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$watch = <span class="function"><span class="keyword">function</span> (<span class="params">expOrFn: string | Function, cb: any, options?: Object</span>): <span class="title">Function</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (isPlainObject(cb)) &#123;</span><br><span class="line">      <span class="keyword">return</span> createWatcher(vm, expOrFn, cb, options)</span><br><span class="line">    &#125;</span><br><span class="line">    options = options || &#123;&#125;</span><br><span class="line">    options.user = <span class="literal">true</span></span><br><span class="line">    <span class="keyword">const</span> watcher = <span class="keyword">new</span> Watcher(vm, expOrFn, cb, options)</span><br><span class="line">    <span class="keyword">if</span> (options.immediate) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        cb.call(vm, watcher.value)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (error) &#123;</span><br><span class="line">        handleError(error, vm, <span class="string">`callback for immediate watcher &quot;<span class="subst">$&#123;watcher.expression&#125;</span>&quot;`</span>)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">unwatchFn</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      watcher.teardown()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å…¶å®é¡¾åæ€ä¹‰ï¼Œå·²ç»èƒ½å¤§è‡´çŒœåˆ°è¿™é‡Œçš„åŠŸèƒ½äº†ï¼ˆpsï¼šè¿™ä¹Ÿæ˜¯ä¸€ä¸ªå¥½çš„å‘½åè§„èŒƒå¸¦æ¥çš„å¥½å¤„ï¼‰ã€‚ä¸è¿‡è¿™é‡Œè¿˜æ˜¯ç»“åˆä»£ç åˆ†æï¼Œè¿™é‡Œæ‰©å±•äº†ä»¥ä¸‹åŠŸèƒ½ï¼š</p><ul><li><code>$data</code></li><li><code>$props</code></li><li><code>$set</code></li><li><code>$delete</code></li><li><code>$watch</code></li></ul><h3 id="eventsMixin-Vue"><a href="#eventsMixin-Vue" class="headerlink" title="eventsMixin(Vue)"></a>eventsMixin(Vue)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/events.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">eventsMixin</span>(<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> hookRE = <span class="regexp">/^hook:/</span></span><br><span class="line">  Vue.prototype.$on = <span class="function"><span class="keyword">function</span> (<span class="params">event: string | Array&lt;string&gt;, fn: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(event)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = event.length; i &lt; l; i++) &#123;</span><br><span class="line">        vm.$on(event[i], fn)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      ;(vm._events[event] || (vm._events[event] = [])).push(fn)</span><br><span class="line">      <span class="comment">// optimize hook:event cost by using a boolean flag marked at registration</span></span><br><span class="line">      <span class="comment">// instead of a hash lookup</span></span><br><span class="line">      <span class="keyword">if</span> (hookRE.test(event)) &#123;</span><br><span class="line">        vm._hasHookEvent = <span class="literal">true</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$once = <span class="function"><span class="keyword">function</span> (<span class="params">event: string, fn: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">on</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">      vm.$off(event, on)</span><br><span class="line">      fn.apply(vm, <span class="built_in">arguments</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    on.fn = fn</span><br><span class="line">    vm.$on(event, on)</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$off = <span class="function"><span class="keyword">function</span> (<span class="params">event?: string | Array&lt;string&gt;, fn?: Function</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="comment">// all</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">arguments</span>.length) &#123;</span><br><span class="line">      vm._events = <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">      <span class="keyword">return</span> vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// array of events</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(event)) &#123;</span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = event.length; i &lt; l; i++) &#123;</span><br><span class="line">        vm.$off(event[i], fn)</span><br><span class="line">      &#125;</span><br><span class="line">      <span class="keyword">return</span> vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// specific event</span></span><br><span class="line">    <span class="keyword">const</span> cbs = vm._events[event]</span><br><span class="line">    <span class="keyword">if</span> (!cbs) &#123;</span><br><span class="line">      <span class="keyword">return</span> vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (!fn) &#123;</span><br><span class="line">      vm._events[event] = <span class="literal">null</span></span><br><span class="line">      <span class="keyword">return</span> vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// specific handler</span></span><br><span class="line">    <span class="keyword">let</span> cb</span><br><span class="line">    <span class="keyword">let</span> i = cbs.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      cb = cbs[i]</span><br><span class="line">      <span class="keyword">if</span> (cb === fn || cb.fn === fn) &#123;</span><br><span class="line">        cbs.splice(i, <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$emit = <span class="function"><span class="keyword">function</span> (<span class="params">event: string</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="keyword">const</span> lowerCaseEvent = event.toLowerCase()</span><br><span class="line">      <span class="keyword">if</span> (lowerCaseEvent !== event &amp;&amp; vm._events[lowerCaseEvent]) &#123;</span><br><span class="line">        tip(</span><br><span class="line">          <span class="string">`Event &quot;<span class="subst">$&#123;lowerCaseEvent&#125;</span>&quot; is emitted in component `</span> +</span><br><span class="line">            <span class="string">`<span class="subst">$&#123;formatComponentName(vm)&#125;</span> but the handler is registered for &quot;<span class="subst">$&#123;event&#125;</span>&quot;. `</span> +</span><br><span class="line">            <span class="string">`Note that HTML attributes are case-insensitive and you cannot use `</span> +</span><br><span class="line">            <span class="string">`v-on to listen to camelCase events when using in-DOM templates. `</span> +</span><br><span class="line">            <span class="string">`You should probably use &quot;<span class="subst">$&#123;hyphenate(event)&#125;</span>&quot; instead of &quot;<span class="subst">$&#123;event&#125;</span>&quot;.`</span></span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> cbs = vm._events[event]</span><br><span class="line">    <span class="keyword">if</span> (cbs) &#123;</span><br><span class="line">      cbs = cbs.length &gt; <span class="number">1</span> ? toArray(cbs) : cbs</span><br><span class="line">      <span class="keyword">const</span> args = toArray(<span class="built_in">arguments</span>, <span class="number">1</span>)</span><br><span class="line">      <span class="keyword">const</span> info = <span class="string">`event handler for &quot;<span class="subst">$&#123;event&#125;</span>&quot;`</span></span><br><span class="line">      <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, l = cbs.length; i &lt; l; i++) &#123;</span><br><span class="line">        invokeWithErrorHandling(cbs[i], vm, args, vm, info)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> vm</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯æ‰©å±•äº‹ä»¶ç›¸å…³çš„æ–¹æ³•ï¼š</p><ul><li><code>$on</code></li><li><code>$once</code> - è¿™ä¸ªæ–¹æ³•åœ¨å¹³æ—¶ä¸šåŠ¡å¼€å‘ä¸­éå¸¸å°‘ç”¨</li><li><code>$off</code></li><li><code>$emit</code></li></ul><h3 id="lifecycleMixin-Vue"><a href="#lifecycleMixin-Vue" class="headerlink" title="lifecycleMixin(Vue)"></a>lifecycleMixin(Vue)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/lifecycle.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">lifecycleMixin</span>(<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  Vue.prototype._update = <span class="function"><span class="keyword">function</span> (<span class="params">vnode: VNode, hydrating?: boolean</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">const</span> prevEl = vm.$el</span><br><span class="line">    <span class="keyword">const</span> prevVnode = vm._vnode</span><br><span class="line">    <span class="keyword">const</span> restoreActiveInstance = setActiveInstance(vm)</span><br><span class="line">    vm._vnode = vnode</span><br><span class="line">    <span class="comment">// Vue.prototype.__patch__ is injected in entry points</span></span><br><span class="line">    <span class="comment">// based on the rendering backend used.</span></span><br><span class="line">    <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">      <span class="comment">// initial render</span></span><br><span class="line">      vm.$el = vm.__patch__(vm.$el, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>)</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="comment">// updates</span></span><br><span class="line">      vm.$el = vm.__patch__(prevVnode, vnode)</span><br><span class="line">    &#125;</span><br><span class="line">    restoreActiveInstance()</span><br><span class="line">    <span class="comment">// update __vue__ reference</span></span><br><span class="line">    <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">      prevEl.__vue__ = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span> (vm.$el) &#123;</span><br><span class="line">      vm.$el.__vue__ = vm</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if parent is an HOC, update its $el as well</span></span><br><span class="line">    <span class="keyword">if</span> (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123;</span><br><span class="line">      vm.$parent.$el = vm.$el</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// updated hook is called by the scheduler to ensure that children are</span></span><br><span class="line">    <span class="comment">// updated in a parent&#x27;s updated hook.</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$forceUpdate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.update()</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$destroy = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">if</span> (vm._isBeingDestroyed) &#123;</span><br><span class="line">      <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    callHook(vm, <span class="string">&#x27;beforeDestroy&#x27;</span>)</span><br><span class="line">    vm._isBeingDestroyed = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// remove self from parent</span></span><br><span class="line">    <span class="keyword">const</span> parent = vm.$parent</span><br><span class="line">    <span class="keyword">if</span> (parent &amp;&amp; !parent._isBeingDestroyed &amp;&amp; !vm.$options.abstract) &#123;</span><br><span class="line">      remove(parent.$children, vm)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// teardown watchers</span></span><br><span class="line">    <span class="keyword">if</span> (vm._watcher) &#123;</span><br><span class="line">      vm._watcher.teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> i = vm._watchers.length</span><br><span class="line">    <span class="keyword">while</span> (i--) &#123;</span><br><span class="line">      vm._watchers[i].teardown()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// remove reference from data ob</span></span><br><span class="line">    <span class="comment">// frozen object may not have observer.</span></span><br><span class="line">    <span class="keyword">if</span> (vm._data.__ob__) &#123;</span><br><span class="line">      vm._data.__ob__.vmCount--</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// call the last hook...</span></span><br><span class="line">    vm._isDestroyed = <span class="literal">true</span></span><br><span class="line">    <span class="comment">// invoke destroy hooks on current rendered tree</span></span><br><span class="line">    vm.__patch__(vm._vnode, <span class="literal">null</span>)</span><br><span class="line">    <span class="comment">// fire destroyed hook</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;destroyed&#x27;</span>)</span><br><span class="line">    <span class="comment">// turn off all instance listeners.</span></span><br><span class="line">    vm.$off()</span><br><span class="line">    <span class="comment">// remove __vue__ reference</span></span><br><span class="line">    <span class="keyword">if</span> (vm.$el) &#123;</span><br><span class="line">      vm.$el.__vue__ = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// release circular reference (#6759)</span></span><br><span class="line">    <span class="keyword">if</span> (vm.$vnode) &#123;</span><br><span class="line">      vm.$vnode.parent = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ‰©å±•äº†ç”Ÿå‘½å‘¨æœŸç›¸å…³çš„æ–¹æ³•ï¼š</p><ul><li><code>_update</code>ï¼šè¿™æ˜¯æ ¸å¿ƒçš„æ›´æ–°å‡½æ•°</li><li><code>$forceUpdate</code></li><li><code>$destroy</code></li></ul><h3 id="renderMixin-Vue"><a href="#renderMixin-Vue" class="headerlink" title="renderMixin(Vue)"></a>renderMixin(Vue)</h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/render.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">renderMixin</span>(<span class="params">Vue: Class&lt;Component&gt;</span>) </span>&#123;</span><br><span class="line">  <span class="comment">// install runtime convenience helpers</span></span><br><span class="line">  installRenderHelpers(Vue.prototype)</span><br><span class="line"></span><br><span class="line">  Vue.prototype.$nextTick = <span class="function"><span class="keyword">function</span> (<span class="params">fn: Function</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> nextTick(fn, <span class="built_in">this</span>)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line">    <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.$options</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (_parentVnode) &#123;</span><br><span class="line">      vm.$scopedSlots = normalizeScopedSlots(_parentVnode.data.scopedSlots, vm.$slots, vm.$scopedSlots)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// set parent vnode. this allows render functions to have access</span></span><br><span class="line">    <span class="comment">// to the data on the placeholder node.</span></span><br><span class="line">    vm.$vnode = _parentVnode</span><br><span class="line">    <span class="comment">// render self</span></span><br><span class="line">    <span class="keyword">let</span> vnode</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">      <span class="comment">// There&#x27;s no need to maintain a stack because all render fns are called</span></span><br><span class="line">      <span class="comment">// separately from one another. Nested component&#x27;s render fns are called</span></span><br><span class="line">      <span class="comment">// when parent component is patched.</span></span><br><span class="line">      currentRenderingInstance = vm</span><br><span class="line">      vnode = render.call(vm._renderProxy, vm.$createElement)</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">      handleError(e, vm, <span class="string">`render`</span>)</span><br><span class="line">      <span class="comment">// return error render result,</span></span><br><span class="line">      <span class="comment">// or previous vnode to prevent render error causing blank component</span></span><br><span class="line">      <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; vm.$options.renderError) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">          vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e)</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">          handleError(e, vm, <span class="string">`renderError`</span>)</span><br><span class="line">          vnode = vm._vnode</span><br><span class="line">        &#125;</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        vnode = vm._vnode</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">      currentRenderingInstance = <span class="literal">null</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// if the returned array contains only a single node, allow it</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(vnode) &amp;&amp; vnode.length === <span class="number">1</span>) &#123;</span><br><span class="line">      vnode = vnode[<span class="number">0</span>]</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// return empty vnode in case the render function errored out</span></span><br><span class="line">    <span class="keyword">if</span> (!(vnode <span class="keyword">instanceof</span> VNode)) &#123;</span><br><span class="line">      <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; <span class="built_in">Array</span>.isArray(vnode)) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">&#x27;Multiple root nodes returned from render function. Render function &#x27;</span> + <span class="string">&#x27;should return a single root node.&#x27;</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125;</span><br><span class="line">      vnode = createEmptyVNode()</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// set parent</span></span><br><span class="line">    vnode.parent = _parentVnode</span><br><span class="line">    <span class="keyword">return</span> vnode</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæ˜¯æ‰©å±•äº†æ¸²æŸ“ç›¸å…³çš„æ–¹æ³•ï¼š</p><ul><li><code>$nextTick</code>ï¼šè¿™ä¸ªæ–¹æ³•éå¸¸æœ‰æ„æ€ï¼Œåé¢å°†æ·±å…¥åˆ†æ</li><li><code>_render</code></li></ul><p>è€è§„çŸ©ï¼Œä¸Šè„‘å›¾ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F593e548f-0163-4539-80f0-5445f097aae3%2FUntitled.png?table=block&id=9de497b7-2bea-4fda-a9e6-ea0c08126c85&name=Untitled.png&cache=v2"></p><p>å¦‚æœå†™ä¸€ä¸ªæµ‹è¯• demo è°ƒè¯•ï¼Œä¼šå‘ç°ï¼Œå½“ä¸Šé¢çš„æµç¨‹éƒ½æ‰§è¡Œå®Œæˆä¹‹åï¼Œé¡µé¢ä¸­è¿˜æ²¡æœ‰æ¸²æŸ“å‡ºå¯¹åº”çš„å†…å®¹ï¼Œè¿™æ˜¯å› ä¸ºè¿˜æ²¡æœ‰æ‰§è¡Œ vue åˆå§‹åŒ–æœ€é‡è¦çš„ä¸€æ­¥ï¼š<strong>æŒ‚è½½</strong>ã€‚æ¥ä¸‹æ¥å°±æ¥çœ‹çœ‹ vue ä¸­æ˜¯å¦‚ä½•è¿›è¡ŒæŒ‚è½½çš„ã€‚</p><p>ç›¸ä¿¡å¤§å®¶å¯¹å‰é¢æåˆ°çš„æµç¨‹ç†Ÿæ‚‰çš„è¯ï¼Œå¯¹ mount åº”è¯¥æœ‰ä¸€å®šçš„å°è±¡ï¼š<strong>æ‰“åŒ…å…¥å£æ–‡ä»¶ä¸­æœ€é‡è¦çš„åŠŸèƒ½å°±æ˜¯æ‰©å±• mount</strong>ã€‚</p><h3 id="æŒ‚è½½"><a href="#æŒ‚è½½" class="headerlink" title="æŒ‚è½½"></a>æŒ‚è½½</h3><p>é€šè¿‡åŸºæœ¬åˆ†æï¼Œæˆ‘ä»¬å¯ä»¥æ‰¾åˆ°å®ç° mount çš„ä½ç½®ï¼š<code>src/platforms/web/runtime/index.js</code> ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$mount = <span class="function"><span class="keyword">function</span> (<span class="params">el?: string | Element, hydrating?: boolean</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  el = el &amp;&amp; inBrowser ? query(el) : <span class="literal">undefined</span></span><br><span class="line">  <span class="keyword">return</span> mountComponent(<span class="built_in">this</span>, el, hydrating)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œæ˜¯ mountComponent è¿™ä¸ªæ–¹æ³•å®ç°äº† mount çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œè®©æˆ‘ä»¬è¿½è¿›å»çœ‹çœ‹ã€‚</p><p>æ–‡ä»¶ä½ç½®ï¼š<code>core/instance/lifecycle.js</code> ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="function"><span class="keyword">function</span> <span class="title">mountComponent</span>(<span class="params">vm: Component, el: ?Element, hydrating?: boolean</span>): <span class="title">Component</span> </span>&#123;</span><br><span class="line">  vm.$el = el</span><br><span class="line">  <span class="keyword">if</span> (!vm.$options.render) &#123;</span><br><span class="line">    vm.$options.render = createEmptyVNode</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span>) &#123;</span><br><span class="line">      <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">      <span class="keyword">if</span> ((vm.$options.template &amp;&amp; vm.$options.template.charAt(<span class="number">0</span>) !== <span class="string">&#x27;#&#x27;</span>) || vm.$options.el || el) &#123;</span><br><span class="line">        warn(</span><br><span class="line">          <span class="string">&#x27;You are using the runtime-only build of Vue where the template &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;compiler is not available. Either pre-compile the templates into &#x27;</span> +</span><br><span class="line">            <span class="string">&#x27;render functions, or use the compiler-included build.&#x27;</span>,</span><br><span class="line">          vm</span><br><span class="line">        )</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        warn(<span class="string">&#x27;Failed to mount component: template or render function not defined.&#x27;</span>, vm)</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  callHook(vm, <span class="string">&#x27;beforeMount&#x27;</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">let</span> updateComponent</span><br><span class="line">  <span class="comment">/* istanbul ignore if */</span></span><br><span class="line">  <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; config.performance &amp;&amp; mark) &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">const</span> name = vm._name</span><br><span class="line">      <span class="keyword">const</span> id = vm._uid</span><br><span class="line">      <span class="keyword">const</span> startTag = <span class="string">`vue-perf-start:<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line">      <span class="keyword">const</span> endTag = <span class="string">`vue-perf-end:<span class="subst">$&#123;id&#125;</span>`</span></span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      <span class="keyword">const</span> vnode = vm._render()</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(<span class="string">`vue <span class="subst">$&#123;name&#125;</span> render`</span>, startTag, endTag)</span><br><span class="line"></span><br><span class="line">      mark(startTag)</span><br><span class="line">      vm._update(vnode, hydrating)</span><br><span class="line">      mark(endTag)</span><br><span class="line">      measure(<span class="string">`vue <span class="subst">$&#123;name&#125;</span> patch`</span>, startTag, endTag)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    updateComponent = <span class="function">() =&gt;</span> &#123;</span><br><span class="line">      vm._update(vm._render(), hydrating)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// we set this to vm._watcher inside the watcher&#x27;s constructor</span></span><br><span class="line">  <span class="comment">// since the watcher&#x27;s initial patch may call $forceUpdate (e.g. inside child</span></span><br><span class="line">  <span class="comment">// component&#x27;s mounted hook), which relies on vm._watcher being already defined</span></span><br><span class="line">  <span class="keyword">new</span> Watcher(</span><br><span class="line">    vm,</span><br><span class="line">    updateComponent,</span><br><span class="line">    noop,</span><br><span class="line">    &#123;</span><br><span class="line">      before() &#123;</span><br><span class="line">        <span class="keyword">if</span> (vm._isMounted &amp;&amp; !vm._isDestroyed) &#123;</span><br><span class="line">          callHook(vm, <span class="string">&#x27;beforeUpdate&#x27;</span>)</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="literal">true</span> <span class="comment">/* isRenderWatcher */</span></span><br><span class="line">  )</span><br><span class="line">  hydrating = <span class="literal">false</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// manually mounted instance, call mounted on self</span></span><br><span class="line">  <span class="comment">// mounted is called for render-created child components in its inserted hook</span></span><br><span class="line">  <span class="keyword">if</span> (vm.$vnode == <span class="literal">null</span>) &#123;</span><br><span class="line">    vm._isMounted = <span class="literal">true</span></span><br><span class="line">    callHook(vm, <span class="string">&#x27;mounted&#x27;</span>)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> vm</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æµç¨‹å¹¶ä¸å¤æ‚ï¼š</p><ul><li>é¦–å…ˆè°ƒç”¨äº† <code>beforeMount</code> é’©å­</li><li>éšåè°ƒç”¨äº† <code>updateComponent</code> è¿›è¡Œç»„ä»¶çš„æ›´æ–°</li><li>ç„¶ååˆ›å»ºäº†ä¸€ä¸ª Wathcerï¼Œå¹¶åœ¨å…¶ä¸­è°ƒç”¨äº† <code>beforeUpdate</code> é’©å­</li><li>æœ€åè°ƒç”¨ <code>mounted</code> é’©å­</li></ul><p>ä»æµç¨‹å¯ä»¥çœ‹å‡ºï¼ŒæŒ‚è½½çš„æ ¸å¿ƒåŠŸèƒ½åº”è¯¥æ˜¯åœ¨ <code>updateComponent</code> è¿›è¡Œçš„ï¼Œè€Œå®ƒçš„æ ¸å¿ƒåŠŸèƒ½å°±æ˜¯å…ˆæ‰§è¡Œ <code>_render()</code>ï¼Œåæ‰§è¡Œ <code>_update()</code>ã€‚</p><p>è€Œè¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œæˆ‘ä»¬è¿›å…¥çœ‹çœ‹ï¼š</p><h3 id="render"><a href="#render" class="headerlink" title="_render()"></a><code>_render()</code></h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/render.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._render = <span class="function"><span class="keyword">function</span> (<span class="params"></span>): <span class="title">VNode</span> </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">const</span> &#123; render, _parentVnode &#125; = vm.$options</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (_parentVnode) &#123;</span><br><span class="line">    vm.$scopedSlots = normalizeScopedSlots(_parentVnode.data.scopedSlots, vm.$slots, vm.$scopedSlots)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// set parent vnode. this allows render functions to have access</span></span><br><span class="line">  <span class="comment">// to the data on the placeholder node.</span></span><br><span class="line">  vm.$vnode = _parentVnode</span><br><span class="line">  <span class="comment">// render self</span></span><br><span class="line">  <span class="keyword">let</span> vnode</span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">// There&#x27;s no need to maintain a stack because all render fns are called</span></span><br><span class="line">    <span class="comment">// separately from one another. Nested component&#x27;s render fns are called</span></span><br><span class="line">    <span class="comment">// when parent component is patched.</span></span><br><span class="line">    currentRenderingInstance = vm</span><br><span class="line">    vnode = render.call(vm._renderProxy, vm.$createElement)</span><br><span class="line">  &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    handleError(e, vm, <span class="string">`render`</span>)</span><br><span class="line">    <span class="comment">// return error render result,</span></span><br><span class="line">    <span class="comment">// or previous vnode to prevent render error causing blank component</span></span><br><span class="line">    <span class="comment">/* istanbul ignore else */</span></span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; vm.$options.renderError) &#123;</span><br><span class="line">      <span class="keyword">try</span> &#123;</span><br><span class="line">        vnode = vm.$options.renderError.call(vm._renderProxy, vm.$createElement, e)</span><br><span class="line">      &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">        handleError(e, vm, <span class="string">`renderError`</span>)</span><br><span class="line">        vnode = vm._vnode</span><br><span class="line">      &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      vnode = vm._vnode</span><br><span class="line">    &#125;</span><br><span class="line">  &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    currentRenderingInstance = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if the returned array contains only a single node, allow it</span></span><br><span class="line">  <span class="keyword">if</span> (<span class="built_in">Array</span>.isArray(vnode) &amp;&amp; vnode.length === <span class="number">1</span>) &#123;</span><br><span class="line">    vnode = vnode[<span class="number">0</span>]</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// return empty vnode in case the render function errored out</span></span><br><span class="line">  <span class="keyword">if</span> (!(vnode <span class="keyword">instanceof</span> VNode)) &#123;</span><br><span class="line">    <span class="keyword">if</span> (process.env.NODE_ENV !== <span class="string">&#x27;production&#x27;</span> &amp;&amp; <span class="built_in">Array</span>.isArray(vnode)) &#123;</span><br><span class="line">      warn(</span><br><span class="line">        <span class="string">&#x27;Multiple root nodes returned from render function. Render function &#x27;</span> + <span class="string">&#x27;should return a single root node.&#x27;</span>,</span><br><span class="line">        vm</span><br><span class="line">      )</span><br><span class="line">    &#125;</span><br><span class="line">    vnode = createEmptyVNode()</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// set parent</span></span><br><span class="line">  vnode.parent = _parentVnode</span><br><span class="line">  <span class="keyword">return</span> vnode</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œç»è¿‡ä¸€ç³»åˆ—çš„å¤„ç†ï¼Œä¸»è¦æ˜¯ä¸ºäº†å¾—åˆ°è™šæ‹Ÿ dom</p><h3 id="update"><a href="#update" class="headerlink" title="_update()"></a><code>_update()</code></h3><p>æ–‡ä»¶ä½ç½®ï¼š<code>src/core/instance/lifecycle.js</code></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype._update = <span class="function"><span class="keyword">function</span> (<span class="params">vnode: VNode, hydrating?: boolean</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> vm: Component = <span class="built_in">this</span></span><br><span class="line">  <span class="keyword">const</span> prevEl = vm.$el</span><br><span class="line">  <span class="keyword">const</span> prevVnode = vm._vnode</span><br><span class="line">  <span class="keyword">const</span> restoreActiveInstance = setActiveInstance(vm)</span><br><span class="line">  vm._vnode = vnode</span><br><span class="line">  <span class="comment">// Vue.prototype.__patch__ is injected in entry points</span></span><br><span class="line">  <span class="comment">// based on the rendering backend used.</span></span><br><span class="line">  <span class="keyword">if</span> (!prevVnode) &#123;</span><br><span class="line">    <span class="comment">// initial render</span></span><br><span class="line">    vm.$el = vm.__patch__(vm.$el, vnode, hydrating, <span class="literal">false</span> <span class="comment">/* removeOnly */</span>)</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="comment">// updates</span></span><br><span class="line">    vm.$el = vm.__patch__(prevVnode, vnode)</span><br><span class="line">  &#125;</span><br><span class="line">  restoreActiveInstance()</span><br><span class="line">  <span class="comment">// update __vue__ reference</span></span><br><span class="line">  <span class="keyword">if</span> (prevEl) &#123;</span><br><span class="line">    prevEl.__vue__ = <span class="literal">null</span></span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> (vm.$el) &#123;</span><br><span class="line">    vm.$el.__vue__ = vm</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// if parent is an HOC, update its $el as well</span></span><br><span class="line">  <span class="keyword">if</span> (vm.$vnode &amp;&amp; vm.$parent &amp;&amp; vm.$vnode === vm.$parent._vnode) &#123;</span><br><span class="line">    vm.$parent.$el = vm.$el</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// updated hook is called by the scheduler to ensure that children are</span></span><br><span class="line">  <span class="comment">// updated in a parent&#x27;s updated hook.</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæœ€æ ¸å¿ƒçš„åŠŸèƒ½æ˜¯ <code>__patch__</code>ï¼Œå³å°†è™šæ‹Ÿ dom è½¬åŒ–ä¸ºçœŸå® domã€‚</p><p>è„‘å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ed5e315e-17b3-46c2-894d-630ec24b0948/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200813/us-west-2/s3/aws4_request&X-Amz-Date=20200813T075542Z&X-Amz-Expires=86400&X-Amz-Signature=52c20bde3d36341ba0d4d2bccaf1daeb209dd244027b135dd938cf92a23f9bc1&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><h2 id="è°ƒè¯•éªŒè¯"><a href="#è°ƒè¯•éªŒè¯" class="headerlink" title="è°ƒè¯•éªŒè¯"></a>è°ƒè¯•éªŒè¯</h2><p>å‰é¢ä¸€é€šåˆ†æï¼ŒæŒºæœ‰é“ç†ï¼Œä½†åªæ˜¯ç†è®ºå¦‚æ­¤ï¼Œä¸ç¨³ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡è°ƒè¯•å™¨ä¸€æ­¥æ­¥æ‰§è¡Œï¼Œæ¥éªŒè¯ä¸€ä¸‹æˆ‘ä»¬çš„æƒ³æ³•æ˜¯å¦æ­£ç¡®ï¼š</p><h3 id="Step-1-ç¡®å®šåˆå§‹åŒ–å‡½æ•°"><a href="#Step-1-ç¡®å®šåˆå§‹åŒ–å‡½æ•°" class="headerlink" title="Step 1 - ç¡®å®šåˆå§‹åŒ–å‡½æ•°"></a>Step 1 - ç¡®å®šåˆå§‹åŒ–å‡½æ•°</h3><p>æµ‹è¯• demo å°±ä¸è´´å‡ºæ¥äº†ï¼Œéšä¾¿ä¸€ä¸ª vue æ ·ä¾‹éƒ½è¡Œï¼Œæˆ‘ä»¬ä» <code>new Vue()</code> å¤„è¿›å…¥å³å¯ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/1f4df573-9625-4a6c-91df-da5831ecfe10/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200813/us-west-2/s3/aws4_request&X-Amz-Date=20200813T075706Z&X-Amz-Expires=86400&X-Amz-Signature=968758b047e8e5677ed25e77dc686b5dd9dd7e675a38d8c91600acab8426d741&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>æ˜¾ç„¶ï¼Œè¿™é‡Œåªä¼šæ‰§è¡Œ <code>_init</code>ï¼Œä¹Ÿå³æ˜¯è¯´è¿™å°±æ˜¯åˆå§‹åŒ–å‡½æ•°ï¼Œä¹ŸéªŒè¯äº†ä¸Šé¢çš„çŒœæƒ³ã€‚</p><h3 id="Step-2-éªŒè¯æ‰§è¡Œæµç¨‹"><a href="#Step-2-éªŒè¯æ‰§è¡Œæµç¨‹" class="headerlink" title="Step 2 - éªŒè¯æ‰§è¡Œæµç¨‹"></a>Step 2 - éªŒè¯æ‰§è¡Œæµç¨‹</h3><p>å‰é¢çŒœæµ‹æ‰§è¡Œ <code>initState(Vue)</code> ä¹‹å‰æ˜¯æ— æ³•è®¿é—®åˆ° data æ•°æ®çš„ï¼Œè¿™ä¸ªä¹Ÿå¾ˆå¥½éªŒè¯ï¼Œæˆ‘ä»¬å…ˆçœ‹çœ‹æ‰§è¡Œä¹‹å‰çš„ vmï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F04c2cd84-fa12-4977-9a4e-9b2c528dc471%2FUntitled.png?table=block&id=c55cff8f-82a3-492b-a55f-0fa26dc574ae&name=Untitled.png&cache=v2"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™ä¸ªæ—¶å€™ data å’Œ props éƒ½è¿˜æ— æ³•è®¿é—®ï¼Œæ¥ä¸‹æ¥å•æ­¥æ‰§è¡Œ <code>initState(Vue)</code>ï¼Œå†çœ‹çœ‹ç»“æœï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/ce7d0bd5-1f04-49a1-a1d3-e00ec0e8e032/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200813/us-west-2/s3/aws4_request&X-Amz-Date=20200813T075802Z&X-Amz-Expires=86400&X-Amz-Signature=17ede0ddca6635fe9c8e1f138349af87eed9c18d9245a086e3f33323f1151357&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>æ˜¾ç„¶ï¼Œè¿™ä¸ªæ—¶å€™ data å·²ç»æœ‰å€¼äº†ï¼Œè€Œ props ä¹‹æ‰€ä»¥è¿˜æ˜¯ undefinedï¼Œæ˜¯å› ä¸ºè¿™é‡Œæœ¬å°±æ²¡æœ‰çˆ¶ç»„ä»¶è¿›è¡Œä¼ å€¼ã€‚</p><h3 id="Step-3-éªŒè¯æŒ‚è½½"><a href="#Step-3-éªŒè¯æŒ‚è½½" class="headerlink" title="Step 3 - éªŒè¯æŒ‚è½½"></a>Step 3 - éªŒè¯æŒ‚è½½</h3><p>åŒæ ·ï¼Œæˆ‘ä»¬ç°åœ¨å°†æ–­ç‚¹å®šåœ¨ <code>updateComponent</code> å³å¯ï¼Œæ‰§è¡Œ <code>_update</code> ä¹‹å‰ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/2d67f1ea-07d2-4d0a-830f-efbd9048a432/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200813/us-west-2/s3/aws4_request&X-Amz-Date=20200813T075821Z&X-Amz-Expires=86400&X-Amz-Signature=c79a93ec83121556a6b08a4f464d9af9c0a7bd9f99be361463fda597cd34f3a7&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>æ‰§è¡Œ _update ä¹‹åï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F19199f47-7d19-4836-bee1-e8fc46965c06%2FUntitled.png?table=block&id=c640f58d-6b19-440c-816d-1041eda5cbb0&name=Untitled.png&cache=v2"></p><p>ä¸Šé¢çš„ç»“æœä¸æˆ‘ä»¬åˆ†æ vue æºç å¾—æ¥çš„ç»“è®ºæ— å¼‚ï¼Œè¿™èƒ½å¾ˆå¥½çš„æå‡å£«æ°”å’Œä¿¡å¿ƒï¼Œä¸ºæ¥ä¸‹æ¥çš„æºç å­¦ä¹ ä¹‹æ—…æ‰“ä¸‹ä¸é”™çš„åŸºç¡€ã€‚</p><p>é‚£ä¹ˆæœ¬ç¯‡çš„ç²—æµ…åˆ†æåˆ°æ­¤ä¸ºæ­¢ï¼Œå‰©ä¸‹çš„æ¥æ—¥å†è®®è®ºå§ï¼</p><p>å’•å’•å’•~ ğŸ¥ ğŸ¥ ğŸ¥</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´ä½³é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/37c7e6218fc449a684ace2de187f18d7">Vue 2.6 æºç åˆ†æä¹‹æ—… - ä¸€ï¼šåˆå§‹åŒ–æµç¨‹</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Vue 2.6 æºç åˆ†æä¹‹æ—…ã€0ã€‘ â€”â€” è°ƒè¯•ç¯å¢ƒæ­å»º</title>
      <link href="/2020/08/12/2020-08-12/"/>
      <url>/2020/08/12/2020-08-12/</url>
      
        <content type="html"><![CDATA[<p>ä»¥å‰å¾ˆå¤š vue åŸç†ç›¸å…³çš„çŸ¥è¯†ï¼Œæ¯”å¦‚å“åº”å¼ï¼Œæ¯”å¦‚è™šæ‹Ÿ domï¼Œæ¯”å¦‚ diff ç®—æ³•â€¦â€¦ä½†éƒ½æ²¡æœ‰çœŸæ­£æ·±å…¥çš„çœ‹è¿‡æºç ï¼Œæ­£å› ä¸ºæ­¤ï¼Œè¿™äº›çŸ¥è¯†å®›å¦‚ç©ºä¸­æ¥¼é˜ï¼Œç©ºæ´ä¸”å¹¶æ²¡æœ‰ä»€ä¹ˆè¯´æœåŠ›ã€‚æ‰€ä»¥ä»Šå¤©å¼€å§‹å¯¹ vue è¿›è¡Œç²—æµ…çš„æºç åˆ†æã€‚</p><p>è¦åˆ†ææºç ï¼Œè‡ªç„¶é¦–å…ˆè¦æ­å»ºè°ƒè¯•ç¯å¢ƒï¼Œè¿™æ ·æ‰å¯ä»¥é€šè¿‡ç¼–å†™æµ‹è¯• demo å¿«é€Ÿå®šä½åˆ°æˆ‘ä»¬æƒ³è¦åˆ†æçš„ä½ç½®ã€‚</p><p>é‚£ä¹ˆå¼€å§‹å§ï¼</p><a id="more"></a><h2 id="Step-1-å…‹éš†æºç "><a href="#Step-1-å…‹éš†æºç " class="headerlink" title="Step 1 - å…‹éš†æºç "></a>Step 1 - å…‹éš†æºç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> git@github.com:vuejs/vue.git</span><br></pre></td></tr></table></figure><h2 id="Step-2-å®‰è£…ç¯å¢ƒ"><a href="#Step-2-å®‰è£…ç¯å¢ƒ" class="headerlink" title="Step 2 - å®‰è£…ç¯å¢ƒ"></a>Step 2 - å®‰è£…ç¯å¢ƒ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">npm install // å®‰è£…åˆ° phantom æ—¶å°±å¯ä»¥ç»ˆæ­¢äº†</span><br><span class="line">npm install rollup -g</span><br></pre></td></tr></table></figure><h2 id="Step-3-ä¿®æ”¹è¿è¡Œå‚æ•°"><a href="#Step-3-ä¿®æ”¹è¿è¡Œå‚æ•°" class="headerlink" title="Step 3 - ä¿®æ”¹è¿è¡Œå‚æ•°"></a>Step 3 - ä¿®æ”¹è¿è¡Œå‚æ•°</h2><p>æ–‡ä»¶ï¼š<code>root/pakage.json</code></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">- &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --environment TARGET:web-full-dev&quot;</span><br><span class="line">+ &quot;dev&quot;: &quot;rollup -w -c scripts/config.js --sourcemap --environment TARGET:web-full-dev&quot;</span><br></pre></td></tr></table></figure><h2 id="Step-4-ç¼–è¯‘æºç "><a href="#Step-4-ç¼–è¯‘æºç " class="headerlink" title="Step 4 - ç¼–è¯‘æºç "></a>Step 4 - ç¼–è¯‘æºç </h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm run dev</span><br></pre></td></tr></table></figure><h2 id="Step-5-æµ‹è¯•è°ƒè¯•æµç¨‹"><a href="#Step-5-æµ‹è¯•è°ƒè¯•æµç¨‹" class="headerlink" title="Step 5 - æµ‹è¯•è°ƒè¯•æµç¨‹"></a>Step 5 - æµ‹è¯•è°ƒè¯•æµç¨‹</h2><p>åˆ°è¿™é‡Œï¼Œå¦‚æœåœ¨ <code>root/dist</code> ç›®å½•ä¸‹æ–°ç”Ÿæˆäº†ä¸€ä¸ª <code>vue.js.map</code> æ–‡ä»¶ï¼Œåˆ™è¯´æ˜åº”è¯¥å·²ç»æˆåŠŸå»ºç«‹äº† map æ˜ å°„å…³ç³»ï¼Œè¿™é‡Œåœ¨ <code>root/examples/test-demo</code> ä¸‹å»ºç«‹ä¸€ä¸ªæµ‹è¯•æ–‡ä»¶ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">&lt;!DOCTYPE html&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line"></span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;script src=<span class="string">&quot;../../dist/vue.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line">    &lt;div id=<span class="string">&quot;demo&quot;</span>&gt;</span><br><span class="line">        &lt;h1&gt;Hello &#123;&#123; name &#125;&#125;&lt;/h1&gt;</span><br><span class="line">    &lt;/div&gt;</span><br><span class="line">    &lt;script&gt;</span><br><span class="line">     <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">        el: <span class="string">&#x27;#demo&#x27;</span>,</span><br><span class="line">        data: &#123; <span class="attr">name</span>: <span class="string">&#x27;vue&#x27;</span> &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &lt;/script&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>æ‰“å¼€è¿™ä¸ªé¡µé¢ï¼Œåœ¨æµè§ˆå™¨ä¸­è¿›è¡Œè°ƒè¯•ï¼Œå°†æ–­ç‚¹å®šåœ¨åˆ›å»ºå®ä¾‹çš„è¿™ä¸€è¡Œï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F295957b7-bb20-4ed2-b3ca-f5e9f0bc3f85%2FUntitled.png?table=block&id=a2dfd7d8-ead4-4766-aef7-7a601c9492b3&name=Untitled.png&cache=v2"></p><p>æˆåŠŸæ–­ä¸‹æ¥ä¹‹åï¼ŒæŒ‰ f11 è¿›å…¥å‡½æ•°ï¼Œç„¶ååœ¨ç‚¹å‡»é¼ æ ‡å³é”®ï¼Œé€‰æ‹©ï¼šReveal in sidebarï¼Œå¦‚æœå·¦ä¾§ä¾§è¾¹æ ä¸­å‡ºç° vue çš„ç›®å½•ç»“æ„ï¼Œåˆ™è¯´æ˜è°ƒè¯•ç¯å¢ƒå·²ç»æ­å»ºæˆåŠŸï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa49dd200-4a44-4ca7-91df-7fab2a57eb68%2FUntitled.png?table=block&id=79748268-631f-460a-901e-2c336f18b7a8&name=Untitled.png&cache=v2"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´ä½³é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/7e28290bbbf94a49bac13ecb3869f33e">Vue 2.6 æºç åˆ†æä¹‹æ—… - é›¶ï¼šè°ƒè¯•ç¯å¢ƒæ­å»º</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯é€ è½®å­ã€3ã€‘ â€”â€” mvvm</title>
      <link href="/2020/08/11/2020-08-10/"/>
      <url>/2020/08/11/2020-08-10/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue2 çš„å“åº”å¼å®ç°åŸç†ã€‚</p><p>è¿™é‡Œæ˜¯å‰è¾ˆç ”ç©¶ vue å“åº”å¼åŸç†ç¼©å†™çš„ä»£ç å’Œæ–‡ç« ï¼Œéå¸¸å…·æœ‰å­¦ä¹ ä»·å€¼ï¼Œå¼ºçƒˆå»ºè®®é˜…è¯»å®Œæœ¬æ–‡ä¹‹åç»§ç»­å­¦ä¹ ï¼š<a href="https://github.com/DMQ/mvvm">ã€Šå‰–æ Vue å®ç°åŸç† - å¦‚ä½•å®ç°åŒå‘ç»‘å®š mvvmã€‹</a></p><a id="more"></a><h2 id="æ€è·¯æ•´ç†"><a href="#æ€è·¯æ•´ç†" class="headerlink" title="æ€è·¯æ•´ç†"></a>æ€è·¯æ•´ç†</h2><p>é¦–å…ˆæ¥çœ‹çœ‹å®˜ç½‘ç»™å‡ºçš„ç¤ºä¾‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;input v-model=<span class="string">&quot;message&quot;</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8cdd58cf-e3f9-47cf-94df-dea71154bfbc%2FGIF_2020-8-7_15-41-20.gif?table=block&id=40f4e036-bdb2-4208-a76e-919db64017da&name=GIF_2020-8-7_15-41-20.gif&cache=v2"></p><p>è¿™ä¸ªä¾‹å­å¾ˆå¥½çš„å±•ç¤ºäº† mvvm çš„æ ¸å¿ƒåŠŸèƒ½ï¼š</p><ul><li>æ•°æ®é©±åŠ¨è§†å›¾æ›´æ–°</li></ul><p>å†ç»“åˆä»£ç çœ‹çœ‹ï¼Œæˆ‘ä»¬å‘ç°è¿™é‡Œçš„å®šä¹‰å¹¶ä¸å¤æ‚ï¼Œä»…ä»…æ˜¯ï¼š</p><ul><li>elï¼šæŒ‡å®šè·ŸèŠ‚ç‚¹</li><li>dataï¼šå®šä¹‰å“åº”å¼æ•°æ®</li><li>æ’å€¼è¡¨è¾¾å¼ï¼šæ¸²æŸ“å˜é‡</li><li>v-xxxï¼švue æŒ‡ä»¤</li></ul><p>ä»ä¸Šé¢æˆ‘ä»¬èƒ½å¾—åˆ°ä»€ä¹ˆä¿¡æ¯å‘¢ï¼Ÿ</p><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬è¦å¯¹èŠ‚ç‚¹è¿›è¡Œè§£æï¼Œè§£æå…¶ä¸­çš„æ’å€¼è¡¨è¾¾å¼å’Œ v-xxx æŒ‡ä»¤ï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å¯ä»¥å«å®ƒ <strong>Compiler</strong>ã€‚ç„¶åæˆ‘ä»¬è¿˜éœ€è¦å¯¹ data ä¸­çš„æ•°æ®è¿›è¡ŒåŠ«æŒï¼Œå½“å…¶ä¸­çš„æ•°æ®å‘ç”Ÿ <code>get/set</code> çš„æ—¶å€™ï¼Œèƒ½å¤Ÿè¿›è¡Œè‡ªå®šä¹‰çš„æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å«å®ƒ <strong>Observer</strong>ã€‚æœ€åæˆ‘ä»¬éœ€è¦ç›‘å¬è¿™äº›æ•°æ®ï¼Œå½“ä»–ä»¬å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé€šçŸ¥è§†å›¾å»è¿›è¡Œæ›´æ–°æ“ä½œï¼Œè¿™ä¸ªåŠŸèƒ½æˆ‘ä»¬å«å®ƒ <strong>Watcher</strong>ã€‚</p><p>è¿™é‡Œå¼•ç”¨ä¸€ä¸‹å¤§ä½¬çš„å›¾ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F4219c573-3b0c-42fe-a9d8-56201571c7d0%2FUntitled.png?table=block&id=86609f8d-52e7-40a0-9bfa-5923ebe2472b&name=Untitled.png&cache=v2"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œé™¤äº†ä¸Šé¢æˆ‘ä»¬æåˆ°çš„ä¸‰ä¸ªæ¨¡å—ä»¥å¤–ï¼Œè¿™é‡Œè¿˜å¤šäº† Updater å’Œ Depï¼ŒUpdater å€’è¿˜å¥½ç†è§£ï¼Œä½†è¿™ Dep æ˜¯å¹²å˜›çš„å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œdata å’Œ view ä¸­çš„æ˜¾ç¤ºå­˜åœ¨å¤šå¯¹å¤šçš„å…³ç³»ï¼Œå¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">;<span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>1: &#123;&#123; data_1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>2: &#123;&#123; data_1 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>3: &#123;&#123; data_2 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>4: &#123;&#123; data_3 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml">  <span class="tag">&lt;<span class="name">p</span>&gt;</span>5: &#123;&#123; data_3 &#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span><br><span class="line"><span class="keyword">var</span> vm = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    data_1: <span class="number">1</span>,</span><br><span class="line">    data_2: <span class="number">2</span>,</span><br><span class="line">    data_3: <span class="number">3</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­ï¼š</p><ul><li>å½“ data_1 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp1 å’Œ p2 éƒ½è¦é‡æ–°æ¸²æŸ“</li><li>å½“ data_2 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp3 è¦é‡æ–°æ¸²æŸ“</li><li>å½“ data_3 å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œp4 å’Œ p5 éƒ½è¦é‡æ–°æ¸²æŸ“</li></ul><p>æ˜¾ç„¶è¿™éœ€è¦è¢«æ§åˆ¶ç®¡ç†èµ·æ¥ï¼Œå¦åˆ™è§†å›¾çš„æ›´æ–°è‚¯å®šæ˜¯ä¸€å›¢ä¹±ï¼Œè€Œ Dep å°±æ˜¯ç”¨æ¥åšè¿™ä¸ªçš„ï¼Œæˆ‘ä»¬å¯ä»¥çœ‹çœ‹ä¸‹é¢è¿™å¼ å›¾ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F33318536-5b7b-4979-841e-610e8d074724%2FUntitled.png?table=block&id=84472cd8-70f1-4138-aab5-9fe74e7b0fe8&name=Untitled.png&cache=v2"></p><p>ä»ä¸Šå›¾å¯ä»¥çœ‹åˆ°ï¼š</p><ul><li>view ä¸­æ¯ä¸€ä¸ªéœ€è¦è¢«æ¸²æŸ“çš„å€¼å¯¹åº”ä¸€ä¸ª Watcher</li><li>æ¯ä¸€ä¸ªå“åº”å¼å˜é‡å¯¹åº”ä¸€ä¸ª Dep</li></ul><p>é‚£ä¹ˆæ›´æ–°æµç¨‹å°±åº”è¯¥æ˜¯è¿™æ ·ï¼šå½“æ˜¯æ•°æ®æ›´æ–°çš„æ—¶å€™ï¼ŒObserver é€šçŸ¥å¯¹åº”çš„ Depï¼Œç„¶å Dep é€šçŸ¥è‡ªå·±ç®¡ç†çš„ Watcher è°ƒç”¨ Updater è¿›è¡Œè§†å›¾çš„æ›´æ–°ã€‚</p><p>å½“ç„¶ï¼Œæœ€åæˆ‘ä»¬éœ€è¦ä¸€ä¸ªå…¥å£ä½œä¸ºæ¡¥æ¢ï¼Œå°†ä¸Šé¢çš„å„ä¸ªæ¨¡å—ç»™è”ç³»èµ·æ¥ï¼Œç»„åˆæˆä¸€ä¸ªå®Œæ•´çš„ mvvm æ¡†æ¶ã€‚</p><p>å¤§è‡´çš„æ€è·¯å·²ç»æœ‰äº†ï¼Œé‚£ä¹ˆå¼€å§‹å§ï¼Œitâ€™s show timeï¼</p><h2 id="åŠŸèƒ½å®ç°"><a href="#åŠŸèƒ½å®ç°" class="headerlink" title="åŠŸèƒ½å®ç°"></a>åŠŸèƒ½å®ç°</h2><h3 id="Entry"><a href="#Entry" class="headerlink" title="Entry"></a>Entry</h3><p>é¦–å…ˆå†æ¥çœ‹çœ‹å®˜æ–¹ç¤ºä¾‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">  &lt;p&gt;&#123;&#123; message &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;input v-model=<span class="string">&quot;message&quot;</span>&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"><span class="keyword">var</span> app = <span class="keyword">new</span> Vue(&#123;</span><br><span class="line">  el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">  data: &#123;</span><br><span class="line">    message: <span class="string">&#x27;Hello Vue!&#x27;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œ <code>new</code> äº†ä¸€ä¸ª Vueï¼Œå¹¶ä¸”åªä¼ äº†ä¸€ä¸ª obj è¿›å»ï¼Œé‚£ä¹ˆæˆ‘ä»¬æœ€ç»ˆå¯¹å¤–æš´éœ²çš„å¯¹è±¡ä¹Ÿåº”å½“å¦‚æ­¤ã€‚</p><blockquote><p>æ€»æ‰€å‘¨çŸ¥ï¼Œvue æ˜¯æ³•è¯­è§†å›¾çš„æ„æ€ï¼Œé‚£ä¹ˆè¿™é‡Œå°±ç”¨å®ƒçš„å¥½æœ‹å‹æ¥ä½œä¸ºå‘½åè¯­è¨€å§</p></blockquote><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Aus &#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options = &#123;&#125;)&#123;</span><br><span class="line">        <span class="built_in">this</span>.$options = options;</span><br><span class="line">    <span class="built_in">this</span>.$el = options.el;</span><br><span class="line">    <span class="built_in">this</span>.$data = options.data;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (!<span class="built_in">this</span>.$el) <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">&quot;è¯·æŒ‡å®šæŒ‚è½½ç‚¹&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å°±æ¥å®ç°æ¨¡æ¿çš„è§£æã€‚</p><h3 id="Compiler"><a href="#Compiler" class="headerlink" title="Compiler"></a>Compiler</h3><p>æˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Compiler éœ€è¦åšä»€ä¹ˆï¼š</p><ul><li>é€šè¿‡ el è·å–éœ€è¦è¢«ç¼–è¯‘çš„ root èŠ‚ç‚¹</li><li>è¿›è¡Œæ¨¡æ¿ç¼–è¯‘</li><li>å°†ç¼–è¯‘åçš„èŠ‚ç‚¹è¦†ç›–åˆ° root èŠ‚ç‚¹çš„ä½ç½®</li></ul><p>è€Œæ¨¡æ¿ç¼–è¯‘åº”è¯¥æ€ä¹ˆè¿›è¡Œå‘¢ï¼Ÿ</p><ul><li>é¦–å…ˆæˆ‘ä»¬å¯ä»¥å°†èŠ‚ç‚¹ç¢ç‰‡åŒ–ï¼Œåœ¨å†…å­˜ä¸­å¤„ç†</li><li>éå†å½“å‰çš„èŠ‚ç‚¹æ ‘ï¼Œè¿™é‡Œæˆ‘ä»¬åªå…³æ³¨ä¸¤ç±»èŠ‚ç‚¹ï¼š<ul><li>å…ƒç´ èŠ‚ç‚¹ï¼šå¤„ç† <code>a-xxx</code> æŒ‡ä»¤</li><li>æ–‡æœ¬èŠ‚ç‚¹ï¼šå¤„ç†æ’å€¼è¡¨è¾¾å¼</li></ul></li><li>å°†ç¼–è¯‘å¥½çš„èŠ‚ç‚¹ç¢ç‰‡ append åˆ° root èŠ‚ç‚¹ä¸Š</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬çš„é—®é¢˜å°±æ¥åˆ°äº†å¦‚ä½•å¤„ç†æ–‡æœ¬å’Œå…ƒç´ èŠ‚ç‚¹ï¼š</p><ul><li>å…ƒç´ èŠ‚ç‚¹ï¼š<code>node.attributes</code></li><li>æ–‡æœ¬èŠ‚ç‚¹ï¼šæ­£åˆ™è¡¨è¾¾å¼</li></ul><p>è¿›è¿‡ä¸Šé¢ä¸€é€šåˆ†æï¼Œæ•´ä¸ªç»“æ„å·²ç»æ¯”è¾ƒæ¸…æ™°äº†ï¼Œè¿™é‡Œå†è¡¥ä¸Šè„‘å›¾ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fa077d9b8-3dff-4a7b-8f00-21a5eaf948ae%2FUntitled.png?table=block&id=244ae090-c483-48b7-9f43-9e0930a566d8&name=Untitled.png&cache=v2"></p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&lt;div id=<span class="string">&quot;app&quot;</span>&gt;</span><br><span class="line">  &lt;p&gt;å•å±‚ï¼š&#123;&#123; msg &#125;&#125;&lt;/p&gt;</span><br><span class="line">  &lt;p a-text=<span class="string">&quot;msg&quot;</span>&gt;&lt;/p&gt;</span><br><span class="line">&lt;/div&gt;</span><br><span class="line"></span><br><span class="line">&lt;script type=<span class="string">&quot;module&quot;</span>&gt;</span><br><span class="line">  <span class="keyword">import</span> Aus <span class="keyword">from</span> <span class="string">&#x27;./aus.js&#x27;</span></span><br><span class="line">  <span class="keyword">const</span> am = <span class="keyword">new</span> Aus(&#123;</span><br><span class="line">    el: <span class="string">&#x27;#app&#x27;</span>,</span><br><span class="line">    data: &#123;</span><br><span class="line">      msg: <span class="string">&#x27;Hello Aussicht!&#x27;</span>,</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;)</span><br><span class="line">&lt;/script&gt;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F69ef04bd-e24c-4320-962f-ec21ea636903%2FUntitled.png?table=block&id=c72dfd75-06a9-4871-8046-daf996caca05&name=Untitled.png&cache=v2"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™é‡Œå·²ç»æˆåŠŸå°† <code>a-text</code> å’Œæ’å€¼è¡¨è¾¾å¼æ›¿æ¢æˆäº†æˆ‘ä»¬æƒ³è¦æ¸²æŸ“çš„å˜é‡äº†ã€‚</p><p>æ¥ä¸‹æ¥æˆ‘ä»¬æƒ³è¦å®ç°çš„æ•ˆæœæ˜¯å½“æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œè§†å›¾ä¹Ÿéšä¹‹æ›´æ–°ï¼Œé‚£ä¹ˆé¦–å…ˆåº”è¯¥å®ç°çš„æ˜¯ Observerã€‚</p><h3 id="Observer"><a href="#Observer" class="headerlink" title="Observer"></a>Observer</h3><p>åŒæ ·çš„ï¼Œæˆ‘ä»¬æ¥åˆ†æä¸€ä¸‹ Observer éœ€è¦åšä»€ä¹ˆã€‚</p><p>äº‹å®ä¸Šï¼Œä»…ä»…è€ƒè™‘æ•°æ®åŠ«æŒè¿™ä¸€å±‚é¢çš„è¯ï¼ŒObserver éœ€è¦å®ç°çš„åŠŸèƒ½éå¸¸ç®€å•ï¼Œå°±æ˜¯åˆ©ç”¨ <code>Object.defineProperty</code> å¯¹ data è¿›è¡Œä»£ç†å³å¯ã€‚</p><p>æµç¨‹å¾ˆç®€å•ï¼š</p><ul><li>è·å– data çš„æ‰€æœ‰ keyï¼Œå¯¹å…¶è¿›è¡ŒåŠ«æŒ</li><li>å¦‚æœ data çš„ key ä¸º objï¼Œåˆ™é€’å½’</li></ul><p>è„‘å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8f14c21f-c5c5-4898-b208-0d7aa9085626%2FUntitled.png?table=block&id=43a1c4ac-355e-4668-93eb-caf0af0170c9&name=Untitled.png&cache=v2"></p><blockquote><p>æœ¬æ–‡ä¸»è¦æ˜¯ç®€å•æ¢è®¨ä¸€ä¸‹ mvvm å®ç°åŸç†ï¼Œè¿™é‡Œå¯¹äºæ•°ç»„å°±ä¸åšå¤„ç†äº†ã€‚</p></blockquote><p>ä»£ç å¾ˆç®€å•ï¼ŒæŒ‰ç…§ä¸Šé¢çš„æ€è·¯è¿›è¡Œå®ç°å³å¯ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Dep <span class="keyword">from</span> <span class="string">&#x27;./dep.js&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(data) &#123;</span><br><span class="line">    <span class="built_in">this</span>.data = data</span><br><span class="line">    <span class="built_in">this</span>.observe(<span class="built_in">this</span>.data)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  observe(data) &#123;</span><br><span class="line">    <span class="keyword">if</span> (data &amp;&amp; <span class="keyword">typeof</span> data === <span class="string">&#x27;object&#x27;</span>) &#123;</span><br><span class="line">      <span class="built_in">Object</span>.keys(data).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="built_in">this</span>.defineReactive(data, key, data[key])</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  defineReactive(obj, key, value) &#123;</span><br><span class="line">    <span class="built_in">this</span>.observe(value)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      enumerable: <span class="literal">true</span>,</span><br><span class="line">      configurable: <span class="literal">false</span>,</span><br><span class="line">      get: <span class="function">(<span class="params">_</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      set: <span class="function">(<span class="params">newVal</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹æ–°è®¾ç½®çš„å€¼è¿›è¡Œç›‘å¬</span></span><br><span class="line">        <span class="built_in">this</span>.observe(newVal)</span><br><span class="line">        <span class="keyword">if</span> (newVal !== value) &#123;</span><br><span class="line">          value = newVal</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">true</span></span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> Observer</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯æœ€å…³é”®çš„ï¼Œå½“æ•°æ®å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œé€šçŸ¥è§†å›¾è¿›è¡Œæ›´æ–°æ¸²æŸ“äº†ã€‚</p><h3 id="Watcher-amp-amp-Dep"><a href="#Watcher-amp-amp-Dep" class="headerlink" title="Watcher &amp;&amp; Dep"></a>Watcher &amp;&amp; Dep</h3><p>è¿™é‡Œæˆ‘ä»¬ä¸€æ­¥æ­¥åˆ†æä¸€ä¸‹ï¼š</p><ul><li>Watcher ä¸€ä¸€å¯¹åº”æ¨¡æ¿ä¸­çš„å˜é‡ï¼ˆæ’å€¼è¡¨è¾¾å¼ or <code>a-text</code>ï¼‰</li><li>Dep å¯¹åº”å…·ä½“å˜é‡</li><li>Observer èƒ½å‘å‡ºé€šçŸ¥</li></ul><p>åªæœ‰å½“å˜é‡å‘ç”Ÿæ”¹å˜çš„æ—¶å€™ï¼Œæ¨¡æ¿ä¸­å¯¹åº”çš„åœ°æ–¹éœ€è¦å‘ç”Ÿé‡æ–°æ¸²æŸ“ï¼Œæ‰€ä»¥æµç¨‹åº”è¯¥æ˜¯ï¼š</p><ul><li>Observer é€šçŸ¥ Depï¼Œå˜é‡å‘ç”Ÿæ”¹å˜</li><li>Dep ç®¡ç†äº†ä¸€ä¸ª Watcher æ•°ç»„ï¼Œæ‰§è¡Œ Watcher çš„ update æ–¹æ³•ï¼Œæ›´æ–°è§†å›¾</li></ul><p>é‚£ä¹ˆç°åœ¨çš„é—®é¢˜æ˜¯ï¼Œæ€ä¹ˆå»ºç«‹ Dep å’Œ Watcher çš„å…³ç³»ã€‚</p><p>æ˜¾ç„¶ï¼Œæ¨¡æ¿ä¸­æ¯æœ‰ä¸€ä¸ªéœ€è¦æ¸²æŸ“çš„å€¼ï¼Œå°±åº”è¯¥æœ‰ä¸€ä¸ªå¯¹åº”çš„ Watcherï¼Œè€Œè¿™ä¸ªå€¼åœ¨åˆå§‹åŒ–çš„æ—¶å€™ä¼šè¿›è¡Œ <code>get</code> æ“ä½œï¼Œé‚£ä¹ˆè‡ªç„¶æ˜¯åœ¨ <code>get</code> ä¸­è¿›è¡Œæ“ä½œæœ€åˆé€‚ï¼š</p><p>åŒæ ·ï¼Œåœ¨ä¿®æ”¹å€¼å¾—ä¹‹åä¼šè¿›è¡Œ <code>set</code> æ“ä½œï¼Œé‚£ä¹ˆåœ¨ <code>set</code> çš„æ—¶å€™åˆ©ç”¨ dep é€šçŸ¥ Watcher è¿›è¡Œæ“ä½œä¹Ÿæœ€åˆé€‚ã€‚</p><p>ç»¼ä¸Šï¼š</p><ul><li>Dep è‡³å°‘éœ€è¦ç®¡ç†ä¸€ä¸ª Watcher æ•°ç»„ï¼Œä¸€ä¸ªæ·»åŠ  Watcher çš„æ–¹æ³•ï¼Œä¸€ä¸ªé€šçŸ¥ Watcher æ›´æ–°è§†å›¾çš„æ–¹æ³•</li><li>Watcher åœ¨åˆå§‹åŒ–çš„æ—¶å€™åˆ›å»ºï¼Œç®¡ç† Update æ–¹æ³•</li></ul><p>è„‘å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F15307dfb-6688-4efe-9b28-fc372da2d52e%2FUntitled.png?table=block&id=58b7763d-4d68-4d68-9419-b0e1d98583ea&name=Untitled.png&cache=v2"></p><p>é‚£ä¹ˆè¿™é‡Œï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æ”¹é€ ä¸€ä¸‹ Compilerï¼Œåœ¨æ¸²æŸ“æ¨¡æ¿çš„æ—¶å€™åˆ›å»º Watcherï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compileUtil = &#123;</span><br><span class="line">  text(node, exp, am) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="built_in">this</span>.getValue(exp, am)</span><br><span class="line">    <span class="keyword">const</span> updaterFn = <span class="function">(<span class="params">node, value</span>) =&gt;</span> &#123;</span><br><span class="line">      node.textContent = value</span><br><span class="line">    &#125;</span><br><span class="line">    updaterFn &amp;&amp; updaterFn(node, value)</span><br><span class="line">    <span class="keyword">new</span> Watcher()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getValue(exp, am) &#123;</span><br><span class="line">    <span class="keyword">return</span> exp.split(<span class="string">&#x27;.&#x27;</span>).reduce(<span class="function">(<span class="params">d, c</span>) =&gt;</span> d[c], am.$data)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  setValue(exp, am, value) &#123;</span><br><span class="line">    exp.split(<span class="string">&#x27;.&#x27;</span>).forEach(<span class="function">(<span class="params">k, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; exp.length - <span class="number">1</span>) &#123;</span><br><span class="line">        am = am[k]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        am[k] = value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å› ä¸ºæˆ‘ä»¬åæœŸä¸å¯èƒ½åªå¤„ç† <code>a-text</code> æŒ‡ä»¤ï¼Œæ‰€ä»¥è¿™é‡Œå¯ä»¥å¯¹å·¥å…·æ–¹æ³•è¿›è¡Œä¸€äº›å°è£…ä¼˜åŒ–ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compileUtil = &#123;</span><br><span class="line">  text(node, exp, am) &#123;</span><br><span class="line">    <span class="built_in">this</span>.bind(node, exp, am, <span class="string">&#x27;text&#x27;</span>)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  bind(node, exp, am, dir) &#123;</span><br><span class="line">    <span class="keyword">const</span> value = <span class="built_in">this</span>.getValue(exp, am)</span><br><span class="line">    <span class="keyword">const</span> updaterFn = updaterUtil[dir]</span><br><span class="line">    updaterFn &amp;&amp; updaterFn(node, value)</span><br><span class="line">    <span class="keyword">new</span> Watcher()</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  getValue(exp, am) &#123;</span><br><span class="line">    <span class="keyword">return</span> exp.split(<span class="string">&#x27;.&#x27;</span>).reduce(<span class="function">(<span class="params">d, c</span>) =&gt;</span> d[c], am.$data)</span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  setValue(exp, am, value) &#123;</span><br><span class="line">    exp.split(<span class="string">&#x27;.&#x27;</span>).forEach(<span class="function">(<span class="params">k, i</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="keyword">if</span> (i &lt; exp.length - <span class="number">1</span>) &#123;</span><br><span class="line">        am = am[k]</span><br><span class="line">      &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        am[k] = value</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> updaterUtil = &#123;</span><br><span class="line">  text(node, value) &#123;</span><br><span class="line">    node.textContent = value</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> compileUtil</span><br></pre></td></tr></table></figure><p>å› ä¸ºè¿™é‡Œæˆ‘ä»¬é€šè¿‡ <code>getValue</code> è·å–äº† data ä¸­çš„å€¼ï¼Œæ‰€ä»¥å¿…ç„¶ä¼šè§¦å‘ <code>get</code> æ“ä½œï¼Œé‚£ä¹ˆå°±æ¥åˆ°äº† Observer ä¸­ã€‚</p><p>å‰é¢æˆ‘ä»¬ä¸€ç›´åå¤æåˆ°ï¼Œä¸€ä¸ªå˜é‡å¯¹åº”ä¸€ä¸ª Depï¼Œæ‰€ä»¥è¿™é‡Œæˆ‘ä»¬åœ¨ <code>defineReactive</code> ä¸­åˆ›å»º dep å®ä¾‹ï¼Œ<strong>åœ¨ get ä¸­è°ƒç”¨ dep çš„ addWatcher æ–¹æ³•</strong>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  defineReactive(obj, key, value) &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      get: <span class="function">(<span class="params">_</span>) =&gt;</span> &#123;</span><br><span class="line">        dep.addWatcher(Watcher)</span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">/*...*/</span></span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åŒæ ·çš„ï¼Œ<strong>åœ¨ set ä¸­è°ƒç”¨ dep çš„ notify æ–¹æ³•</strong>ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Observer</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  defineReactive(obj, key, value) &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">const</span> dep = <span class="keyword">new</span> Dep()</span><br><span class="line">    <span class="built_in">Object</span>.defineProperty(obj, key, &#123;</span><br><span class="line">      <span class="comment">/*...*/</span></span><br><span class="line">      set: <span class="function">(<span class="params">newVal</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// å¯¹æ–°è®¾ç½®çš„å€¼è¿›è¡Œç›‘å¬</span></span><br><span class="line">        <span class="built_in">this</span>.observe(newVal)</span><br><span class="line">        <span class="keyword">if</span> (newVal !== value) &#123;</span><br><span class="line">          value = newVal</span><br><span class="line">          dep.notify()</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ä¸­è¿˜å­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼Œåœ¨ get ä¸­æœ‰ä¸€è¡Œä»£ç ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">dep.addWatcher(Watcher)</span><br></pre></td></tr></table></figure><p>è¿™ä¸ª Watcher ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ</p><p>é‚£ä¹ˆæˆ‘ä»¬æ¥åˆ° Watcherã€‚</p><p>Watcher éœ€è¦ä»€ä¹ˆå‘¢ï¼Ÿè¿™ä¸ªæˆ‘ä»¬çŸ¥é“å®ƒçš„åŠŸèƒ½å°±å¾ˆæ¸…æ¥šäº†ï¼š</p><ul><li>å®ƒéœ€è¦è·å–å½“å‰çš„ data å€¼ï¼Œæ‰€ä»¥éœ€è¦ am å®ä¾‹ï¼Œä»¥åŠå€¼å¯¹åº”çš„ key</li><li>å®ƒéœ€è¦æ›´æ–°è§†å›¾ï¼Œæ‰€ä»¥éœ€è¦ update å›è°ƒå‡½æ•°</li></ul><p>é‚£ä¹ˆæ„é€ å‡½æ•°å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>(am, exp, cb) &#123;</span><br><span class="line">    <span class="built_in">this</span>.am = am</span><br><span class="line">    <span class="built_in">this</span>.exp = exp</span><br><span class="line">    <span class="built_in">this</span>.cb = cb</span><br><span class="line">    <span class="built_in">this</span>.oldValue = <span class="built_in">this</span>.getOldValue()</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è€Œåœ¨æ‰§è¡Œ <code>getOldValue</code> çš„æ—¶å€™ï¼Œæˆ‘ä»¬å¯ä»¥åšä¸€äº›çµæ´»çš„å°æ“ä½œï¼š</p><p>å› ä¸º <code>getOldValue</code> å¿…å®šè§¦å‘ <code>get</code>ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥åœ¨ <code>get</code> ä¹‹å‰å°† Watcher æŒ‚è½½åˆ° Dep ä¸Šï¼Œåœ¨ <code>get</code> ä¹‹åæ¸…ç©ºå³å¯ï¼Œè¿™æ ·å°±å¯ä»¥åœ¨ <code>get</code> ä¸­è·å–åˆ° Watcher äº†ã€‚</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  getOldVal() &#123;</span><br><span class="line">    Dep.target = <span class="built_in">this</span></span><br><span class="line">    <span class="keyword">const</span> oldVal = compileUtil.getValue(<span class="built_in">this</span>.exp, <span class="built_in">this</span>.am)</span><br><span class="line">    Dep.target = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">return</span> oldVal</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Watcher çš„åŠŸèƒ½æ˜¯åœ¨ value å˜åŒ–çš„æ—¶å€™è¿›è¡Œè§†å›¾æ›´æ–°ï¼Œè‡ªç„¶è¿˜éœ€è¦ä¸€ä¸ª updater æ–¹æ³•ï¼Œè€Œè¿™ä¸ªæ–¹æ³•åªéœ€è¦åœ¨ oldValue â‰  newValue çš„æ—¶å€™è°ƒç”¨å›è°ƒå‡½æ•°æ›´æ–°è§†å›¾å³å¯ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  updater() &#123;</span><br><span class="line">    <span class="keyword">const</span> newValue = compileUtil.getValue(<span class="built_in">this</span>.exp, <span class="built_in">this</span>.am)</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.oldValue !== newValue) &#123;</span><br><span class="line">      <span class="built_in">this</span>.cb(newVal)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆåˆ›å»º Watcher çš„æ—¶å€™ï¼Œå‚æ•°ä¹Ÿå¾ˆå¥½å¡«äº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> compileUtil = &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  bind(node, exp, am, dir) &#123;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    <span class="keyword">const</span> value = <span class="built_in">this</span>.getValue(exp, am)</span><br><span class="line">    <span class="keyword">const</span> updaterFn = updaterUtil[dir]</span><br><span class="line">    updaterFn &amp;&amp; updaterFn(node, value)</span><br><span class="line">    <span class="keyword">new</span> Watcher(am, exp, <span class="function">(<span class="params">value</span>) =&gt;</span> &#123;</span><br><span class="line">      updaterFn &amp;&amp; updaterFn(node, value)</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>Watcher æå®šäº†ï¼Œé‚£ä¹ˆç®¡ç† Watcher çš„ Dep å°±å¾ˆç®€å•äº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dep</span> </span>&#123;</span><br><span class="line">  <span class="keyword">constructor</span>() &#123;</span><br><span class="line">    <span class="built_in">this</span>.watchers = []</span><br><span class="line">  &#125;</span><br><span class="line">  addWatcher(w) &#123;</span><br><span class="line">    <span class="built_in">this</span>.watchers.push(w)</span><br><span class="line">  &#125;</span><br><span class="line">  notify() &#123;</span><br><span class="line">    <span class="built_in">this</span>.watchers.forEach(<span class="function">(<span class="params">w</span>) =&gt;</span> &#123;</span><br><span class="line">      w.updater()</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†ä¿®æ”¹ä¸€ä¸‹ Observer ä¸­çš„ getï¼Œè¿™æ ·æ•´ä¸ªæµç¨‹å°±éƒ½é€šäº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">get: <span class="function">(<span class="params">_</span>) =&gt;</span> &#123;</span><br><span class="line">  Dep.target &amp;&amp; dep.addWatcher(Dep.target)</span><br><span class="line">  <span class="keyword">return</span> value</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ•ˆæœå¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/aa45502c-4811-4177-b733-f64f998664c3/1111.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200810/us-west-2/s3/aws4_request&X-Amz-Date=20200810T080716Z&X-Amz-Expires=86400&X-Amz-Signature=5a24f8999af887fe940e8fb75118215976db8ce0b7262c83950f0a3b4ab790f3&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%221111.gif%22"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´åŠ é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/01-MVVM-24ae2e3c17a9403689c01a73879939de">æ‰‹å†™ç®€æ˜“ MVVM</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯é€ è½®å­ã€2ã€‘ â€”â€” vuex</title>
      <link href="/2020/08/10/2020-08-07_3/"/>
      <url>/2020/08/10/2020-08-07_3/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vuex çš„å†…éƒ¨å®ç°åŸç†ã€‚<br>æˆ‘ä»¬çŸ¥é“ vuex æ˜¯ vue å®˜æ–¹çš„çŠ¶æ€ç®¡ç†åº“ã€‚è‡³äºä»€ä¹ˆæ˜¯çŠ¶æ€ç®¡ç†åº“å‘¢ï¼Ÿè¿™ä¸ªå¤§æ¦‚è¦ä» flux è¯´èµ·ã€‚å¤§å®¶æ„Ÿå…´è¶£çš„å¯ä»¥çœ‹çœ‹é˜®ä¸€å³°è€å¸ˆçš„æ–‡ç« ï¼š<a href="http://www.ruanyifeng.com/blog/2016/01/flux.html">Flux æ¶æ„å…¥é—¨æ•™ç¨‹</a></p><a id="more"></a><h2 id="Step-1-éœ€æ±‚åˆ†æ"><a href="#Step-1-éœ€æ±‚åˆ†æ" class="headerlink" title="Step 1 - éœ€æ±‚åˆ†æ"></a>Step 1 - éœ€æ±‚åˆ†æ</h2><p>é¦–å…ˆç”¨ vue-cli 4.x åˆ›å»ºä¸€ä¸ªç©ºé¡¹ç›®ï¼Œé€‰æ‹©ä½¿ç”¨ vuexï¼Œç­‰é¡¹ç›®åˆ›å»ºå¥½ä¹‹åï¼Œåœ¨ src ç›®å½•ä¸‹åº”è¯¥å­˜åœ¨ä¸€ä¸ª store æ–‡ä»¶ï¼Œå…¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;./yvuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    add(state, num = <span class="number">1</span>) &#123;</span><br><span class="line">      state.counter += num</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">  actions: &#123;</span><br><span class="line">    add(&#123; commit &#125;) &#123;</span><br><span class="line">      <span class="built_in">setTimeout</span>(<span class="function">() =&gt;</span> &#123;</span><br><span class="line">        commit(<span class="string">&#x27;add&#x27;</span>)</span><br><span class="line">      &#125;, <span class="number">1000</span>)</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä½¿ç”¨è¿‡çŠ¶æ€ç®¡ç†åº“çš„åŒå­¦åº”è¯¥å¾ˆæ¸…æ¥š action ä¸»è¦ç”¨äºå¤„ç†å¼‚æ­¥æ“ä½œï¼Œé‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬æš‚æ—¶å…ˆä¸å…³å¿ƒå®ƒï¼ŒæŠŠåŒæ­¥æ“ä½œå¤„ç†å®Œä¹‹åå†æ¥çœ‹å®ƒå°±ä¼šæ¸…æ™°å¾ˆå¤šäº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Vuex <span class="keyword">from</span> <span class="string">&#x27;./yvuex&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(Vuex)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">new</span> Vuex.Store(&#123;</span><br><span class="line">  state: &#123;</span><br><span class="line">    counter: <span class="number">0</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  mutations: &#123;</span><br><span class="line">    add(state, num = <span class="number">1</span>) &#123;</span><br><span class="line">      state.counter += num</span><br><span class="line">    &#125;,</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>ä»ä¸Šè¿°ä»£ç ï¼Œæˆ‘ä»¬å¯ä»¥åˆ†æå‡ºä»¥ä¸‹å‡ ç‚¹ï¼š</p><ul><li>é¦–å…ˆ vuex æ˜¯ vue çš„æ’ä»¶ï¼Œé¦–å…ˆä¼š useï¼Œåœ¨è¿™ä¸ªæ—¶å€™è°ƒç”¨å…¶ install æ–¹æ³•</li><li>é€šè¿‡ new æ–°å»ºå®ä¾‹çš„æ˜¯ vuex ä¸Šçš„ store å¯¹è±¡è€Œé vuex æœ¬èº«</li><li>å¯¼å‡ºçš„ store ä¼šåœ¨ main ä¸­ä¼ ç»™ vueï¼ˆè¿™ä¸€éƒ¨åˆ†åœ¨ main ä¸­ï¼Œè€Œä¸åœ¨ä¸Šè¿°ä»£ç ä¸­ï¼‰</li></ul><p>é‚£ä¹ˆæˆ‘ä»¬çš„ vuex åº”è¯¥å¦‚ä½•è®¾è®¡å‘¢ï¼Ÿ</p><p>æˆ‘è®¤ä¸ºåº”è¯¥ç»“åˆ vuex çš„ä½¿ç”¨æ¥è¿›è¡Œåˆ†æï¼š</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨é¡¹ç›®ä¸­ä½¿ç”¨ vuex çš„æ—¶å€™ï¼Œé€šå¸¸å½¢å¦‚ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">this</span>.$store.state.xxx</span><br><span class="line"><span class="built_in">this</span>.$store.commit(<span class="string">&#x27;xxx&#x27;</span>)</span><br><span class="line"><span class="comment">// this.$store.dispatch(&#x27;xxx&#x27;) å¼‚æ­¥ï¼Œæš‚ä¸è€ƒè™‘</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œé¦–å…ˆæˆ‘ä»¬éœ€è¦æŠŠ store æŒ‚è½½åˆ° vue å®ä¾‹ä¸Šï¼Œå…¶æ¬¡ï¼Œstore ä¸Šè¿˜åº”è¯¥æœ‰ state å’Œ commitï¼Œå®ƒä»¬ä¸¤åˆ†åˆ«æ˜¯ä¸€ä¸ª object å’Œä¸€ä¸ª functionã€‚</p><p>æ­¤æ—¶çš„æ€ç»´å¯¼å›¾å¦‚ä¸‹æ‰€ç¤ºï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F37d63332-0523-4378-a750-fefa7ba0b199%2FUntitled.png?table=block&id=67b0c40c-de87-419a-9554-5380607058a4&name=Untitled.png&cache=v2"></p><h2 id="Step-2-åŠŸèƒ½å®ç°"><a href="#Step-2-åŠŸèƒ½å®ç°" class="headerlink" title="Step 2 - åŠŸèƒ½å®ç°"></a>Step 2 - åŠŸèƒ½å®ç°</h2><h3 id="åŸºç¡€åŠŸèƒ½"><a href="#åŸºç¡€åŠŸèƒ½" class="headerlink" title="åŸºç¡€åŠŸèƒ½"></a>åŸºç¡€åŠŸèƒ½</h3><p>é‚£ä¹ˆæˆ‘ä»¬æŒ‰ç…§è¿™æ ·çš„æ–¹å¼æ„å»º vuexï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// export default Vuex</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  install(Vue) &#123;</span><br><span class="line">    Vue.mixin(&#123;</span><br><span class="line">      beforeCreate() &#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="built_in">this</span>.$options.store) &#123;</span><br><span class="line">          Vue.prototype.$store = <span class="built_in">this</span>.$options.store</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">  &#125;,</span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>() &#123;</span><br><span class="line">      <span class="built_in">this</span>.state = &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    commit() &#123;&#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥æˆ‘ä»¬å†å›åˆ° store ä¸­ï¼Œå¯ä»¥çœ‹åˆ°åœ¨åˆ›å»º store å®ä¾‹çš„æ—¶å€™ï¼Œæˆ‘ä»¬ä¼ é€’äº†ä¸¤ä¸ªå¯¹è±¡ï¼š</p><ul><li>stateï¼šç”¨äºå­˜å‚¨çŠ¶æ€</li><li>mutationsï¼šç”¨äºåŒæ­¥ä¿®æ”¹çŠ¶æ€</li></ul><p>ä¹Ÿå°±æ˜¯è¯´ï¼Œåœ¨æ„å»ºå®ä¾‹çš„è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬å°† state å­˜å‚¨åˆ° <code>$store.state</code> ä¸­ï¼Œå°† mutations å­˜å‚¨èµ·æ¥ï¼Œåœ¨ commit çš„æ—¶å–å‡ºè°ƒç”¨ï¼Œæ€ç»´å¯¼å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff257c80b-36e4-4465-9736-1711a4042102%2FUntitled.png?table=block&id=9adb43b6-90c0-41b5-8631-f5e88ef244b3&name=Untitled.png&cache=v2"></p><p>é‚£ä¹ˆæˆ‘ä»¬å¯¹åº”å®ç°çš„ä»£ç åº”è¯¥æ˜¯ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">      <span class="built_in">this</span>._mutations = options.mutations</span><br><span class="line">      <span class="built_in">this</span>.state = options.state</span><br><span class="line">    &#125;</span><br><span class="line">    commit(type, payload) &#123;</span><br><span class="line">      <span class="keyword">const</span> mutation = <span class="built_in">this</span>._mutations[type]</span><br><span class="line">      <span class="keyword">return</span> mutation(<span class="built_in">this</span>.state, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ—¶å€™ï¼Œå·²ç»èƒ½ä» <code>this.$store.state</code> ä¸­å–å‡º counter äº†ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F03a44026-f9c7-44f5-a54d-8fa0f1cf9c7b%2FUntitled.png?table=block&id=81afa976-f2da-488e-9953-58ffe5e0c03b&name=Untitled.png&cache=v2"></p><p>å¹¶ä¸” commit ä¹Ÿèƒ½æˆåŠŸè°ƒç”¨äº†ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/02c95c62-273b-466a-a386-7c1699c128b9/20200804_151559.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064340Z&X-Amz-Expires=86400&X-Amz-Signature=b3e701454c05012c56b755b52245c41cd300f0fc5cbb1cec2ebb91228ee47804&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%2220200804_151559.gif%22"></p><p>ä½†è¿™é‡Œè¿˜æœ‰é—®é¢˜ï¼Œæœ€å…³é”®çš„å°±æ˜¯ counter çš„æ”¹å˜å¹¶æ²¡æœ‰å¼•èµ·é¡µé¢çš„é‡æ–°æ¸²æŸ“ã€‚æ˜¾ç„¶æˆ‘ä»¬åº”è¯¥å°† state æ”¹æˆå“åº”å¼æ•°æ®ï¼Œåœ¨ <strong><a href="https://www.notion.so/vue-router-5e3643ff7f344645bf6fa0b0a4229115">æ‰‹å†™ç®€æ˜“ vue-router</a></strong> ä¸­æˆ‘ä»¬ä½¿ç”¨äº† vue å®˜æ–¹æä¾›çš„é™æ€æ–¹æ³•ï¼šVue.util.defineReactive</p><p>é‚£ä¹ˆè¿™é‡Œæˆ‘ä»¬å°±å°è¯•ä½¿ç”¨å¦ä¸€ä¸ªåŠæ³•æ¥å®ç°å“åº”å¼æ•°æ®ï¼šåˆ›å»º vue å®ä¾‹ï¼Œåˆ©ç”¨å…¶ä¸­çš„ data æ–¹æ³•å°† state è½¬åŒ–ä¸ºå“åº”å¼æ•°æ®ï¼Œå®é™…ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">      <span class="built_in">this</span>._mutations = options.mutations</span><br><span class="line">      <span class="built_in">this</span>._vm = <span class="keyword">new</span> _Vue(&#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            <span class="comment">// ç”±äºä¸å¸Œæœ›æ•°æ®è¢«ä»£ç†ï¼Œæ‰€ä»¥è¿™é‡ŒåŠ ä¸Š $</span></span><br><span class="line">            $$state: options.state,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">get</span> <span class="title">state</span>() &#123;</span><br><span class="line">      <span class="keyword">return</span> <span class="built_in">this</span>._vm._data.$$state</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">set</span> <span class="title">state</span>(<span class="params">value</span>) &#123;</span><br><span class="line">      <span class="comment">// ä¸å…è®¸ç›´æ¥ä¿®æ”¹ state</span></span><br><span class="line">      <span class="built_in">console</span>.error(<span class="string">&#x27;please use replaceState to reset state&#x27;</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç°åœ¨æˆ‘ä»¬å†çœ‹çœ‹æ•ˆæœå¦‚ä½•ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/225b951d-b4e3-4269-96d8-9098cde9a564/20200804_152810.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064401Z&X-Amz-Expires=86400&X-Amz-Signature=43a805fe1b46aa3cda736db7c3f941429f106732f3b8169e4a622de1e38e5039&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%2220200804_152810.gif%22"></p><p>è‡³æ­¤ï¼Œä¸€ä¸ªæœ€æœ€åŸºç¡€çš„ store å·²ç»åŸºæœ¬å®ç°äº†ï¼Œæ¥ä¸‹æ¥è‡ªç„¶æ˜¯å¼‚æ­¥æ“ä½œçš„ action äº†ã€‚</p><h3 id="å¼‚æ­¥æ“ä½œ"><a href="#å¼‚æ­¥æ“ä½œ" class="headerlink" title="å¼‚æ­¥æ“ä½œ"></a>å¼‚æ­¥æ“ä½œ</h3><p>å…¶å®æ˜ç™½äº† mutationsï¼Œactions ä¹Ÿå·²ç»æ¸…æ¥šäº†å¤§åŠï¼Œå”¯ä¸€çš„åŒºåˆ«å°±æ˜¯ action ä¸­æˆ‘ä»¬éœ€è¦è°ƒç”¨ commit æ¥ä¿®æ”¹ stateï¼Œé‚£ä¹ˆè¿™ä¸ª commit ä»å“ªé‡Œæ¥è‡ªç„¶å°±å¾ˆæ¸…æ¥šäº†ï¼šthis</p><p>å¯¼å›¾å¦‚ä¸‹ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/3b4df158-3376-4f94-ad02-735b70506667/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064423Z&X-Amz-Expires=86400&X-Amz-Signature=bb52c64a51045faa72e617d8d4f61ab910fc7d8c92232a15ecdcbff67038a8a3&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>å®ç°ä»£ç å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">      <span class="comment">/*...*/</span></span><br><span class="line">      <span class="built_in">this</span>._actions = options.actions</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">    dispatch(type, payload) &#123;</span><br><span class="line">      <span class="keyword">const</span> action = <span class="built_in">this</span>._actions[type]</span><br><span class="line">      <span class="keyword">return</span> action(<span class="built_in">this</span>, payload)</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>niceï¼Œéå¸¸å®Œç¾ï¼Œæˆ‘ä»¬æ¥çœ‹çœ‹æ•ˆæœï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/49d08351-1ebc-43a0-9917-c20846ab96ab/20200804_153954.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064443Z&X-Amz-Expires=86400&X-Amz-Signature=ec0951f3c6f659ec8bb0a0326beb307e77e4e2c36198e19b1d46dfceca5d4ee1&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%2220200804_153954.gif%22"></p><p>æŠ¥é”™äº†ï¼Ÿ</p><p>è¿™æ˜¯ä¸ºä»€ä¹ˆå‘¢ï¼Ÿ</p><p>äºæ˜¯è·Ÿè¸ªè°ƒè¯•ä¸€ç•ªï¼Œå‘ç°å¦‚ä¸‹æƒ…å†µï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F8970833f-9608-43c0-8b82-b92548ce3f49%2FUntitled.png?table=block&id=bb92d403-bc95-460a-97c0-bd665a631e8a&name=Untitled.png&cache=v2"></p><p>this æ²¡äº†ï¼Œå†çœ‹çœ‹ actionï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/c74a5640-5aa5-404b-ada9-9e8c9e3011a4/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064521Z&X-Amz-Expires=86400&X-Amz-Signature=e7b93ab43c7d3c33c892427e904d04496b5bd369dcdc0a8a27388e29bc5291ba&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>æ˜¾ç„¶ï¼Œè¿™é‡Œå› ä¸ºæ˜¯åœ¨ setTimeout ä¸­è°ƒç”¨ commitï¼Œä¸¢å¤±äº† thisï¼Œæ‰€ä»¥æˆ‘ä»¬åœ¨æ„å»ºå®ä¾‹çš„æ—¶å€™è¿›è¡Œç»‘å®šå°±å¯ä»¥å•¦ã€‚</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F82dd6b79-7b33-493b-a83d-bcbac4b88da5%2F20200804_154412.gif?table=block&id=f5abeab6-61cf-483c-b764-04d1ac511828&name=20200804_154412.gif&cache=v2"></p><p>è¿™ä¸‹å°±æ²¡æœ‰é—®é¢˜äº†ã€‚</p><h3 id="æ‰©å±•-gettter"><a href="#æ‰©å±•-gettter" class="headerlink" title="æ‰©å±• - gettter"></a>æ‰©å±• - gettter</h3><p>æˆ‘ä»¬å·²ç»å®ç°äº†åŸºç¡€çš„ vuexï¼Œè€Œå¹³æ—¶ä½¿ç”¨ vuex çš„æ—¶å€™ï¼Œå¤§å®¶çŸ¥é“ getter ä¹Ÿæ˜¯ç»å¸¸è¢«ä½¿ç”¨åˆ°çš„ã€‚</p><p>é‚£ä¹ˆè¿™ä¸ª getter åº”å½“å¦‚ä½•å®ç°å‘¢ï¼Ÿ</p><p>æˆ‘ä»¬å‡è®¾åœ¨åˆ›å»º vuex çš„æ—¶å€™ä¼ å…¥ getterï¼Œé‡Œé¢åªæœ‰ä¸€ä¸ªå€¼ï¼Œæ˜¯ doubleCounterï¼Œè¿”å›å€¼æ˜¯ <code>counter * 2</code>ï¼Œé‚£ä¹ˆè‡ªç„¶ doubleCounter æ˜¯è¢« counter æ‰€å½±å“ï¼Œæˆ‘ä»¬è¿™é‡Œå¯ä»¥ç”»å‡ºå¦‚ä¸‹å¯¼å›¾ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/41c819ba-442f-4d86-9117-ea179de3b578/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064551Z&X-Amz-Expires=86400&X-Amz-Signature=39275881153c0f3a9c81bbba027eb751ed7cacdc804dca27c1ec70bc14804ea2&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><p>é‚£ä¹ˆé—®é¢˜æ¥äº†ï¼š<strong>æ€ä¹ˆå°† getter å’Œ state å…³è”èµ·æ¥å‘¢ï¼Ÿ</strong></p><p>ä»”ç»†æƒ³ä¸€æƒ³ï¼Œæ˜¾ç„¶è¿™é‡Œæ˜¯åšä»£ç†ï¼Œé‚£ä¹ˆç­”æ¡ˆå°±å‘¼ä¹‹æ¬²å‡ºäº†ï¼š<strong>Object.defineProperty</strong>ã€‚æœ‰äº†è¿™ä¸ªæ ¸å¿ƒæ€æƒ³ä¹‹åï¼Œæˆ‘ä»¬ç»§ç»­åˆ†æï¼Œç”±äº getter ä¸æ­¢ä¸€ä¸ªï¼Œé‚£ä¹ˆæˆ‘ä»¬è‚¯å®šéœ€è¦éå†ä¼ å…¥çš„ getter objï¼Œå°†å…¶æ³¨å†Œåˆ° store ä¸Šã€‚</p><p>æˆ‘ä»¬å¯ä»¥å…ˆæ¥å®ç°è¿™ä¸€æ­¥æ“ä½œï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">      <span class="comment">/*...*/</span></span><br><span class="line">            <span class="built_in">this</span>._getters = options.getters</span><br><span class="line">            <span class="built_in">this</span>.= <span class="built_in">Object</span>.create(<span class="literal">null</span>)</span><br><span class="line">            <span class="built_in">this</span>.forEachGetter(<span class="built_in">this</span>, <span class="built_in">this</span>._getters)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">        forEachGetter(store, getters) &#123;</span><br><span class="line">            <span class="built_in">Object</span>.keys(getters).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">                <span class="keyword">const</span> getter = getters[key]</span><br><span class="line">                <span class="built_in">this</span>.registerGetter(store, getter, key)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        registerGetter(store, getter, key)&#123;</span><br><span class="line">            store._wrappedGetters[key] = <span class="function"><span class="keyword">function</span> <span class="title">wrappedGetter</span>(<span class="params">store</span>)</span>&#123;</span><br><span class="line">                <span class="keyword">return</span> getter(store.state)</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ‰§è¡Œå®Œè¿™ä¸€æ­¥ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥è°ƒè¯•çœ‹çœ‹ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fbe8eb18e-99b1-4bf1-8af0-62b24d98b158%2FUntitled.png?table=block&id=62cbf2ad-e793-45f6-9bb7-6f8d872f2388&name=Untitled.png&cache=v2"></p><p>å¯ä»¥çœ‹åˆ°ï¼Œstore ä¸Šçš„å±æ€§ _wrappedGetters ä¸­ç°åœ¨åŒ…å«ä¸¤ä¸ªå±æ€§ï¼š</p><ul><li>doubleCounterï¼šè¿™æ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œå³ registerGetter ä¸­è¿”å›çš„ wrappedGetterï¼Œå½“æˆ‘ä»¬è°ƒç”¨å®ƒçš„æ—¶å€™ï¼Œä¼šè¿”å› getter(store.state) æ‰§è¡Œçš„ç»“æœï¼ŒåŠ state.counter * 2</li><li>stateï¼šè¿™é‡Œæ˜¯å“åº”å¼æ•°æ®ï¼ˆä¸è¿‡ç°åœ¨è¿˜ä¸æ˜¯å“åº”å¼çš„ï¼‰</li></ul><p>ç°åœ¨å·²ç»å»ºç«‹å¥½äº† options.getter å’Œ store._wrappedGetters çš„æ˜ å°„å…³ç³»ï¼Œæˆ‘ä»¬å¯ä»¥å¼€å§‹é€šè¿‡ Object.defineProperty æ¥åšä»£ç†äº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> &#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line">  Store: <span class="class"><span class="keyword">class</span> <span class="title">Store</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">      <span class="comment">/*...*/</span></span><br><span class="line">            <span class="built_in">this</span>.resetStoreVm(<span class="built_in">this</span>, options.state)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">        resetStoreVm(store, state) &#123;</span><br><span class="line">      store.getters = &#123;&#125;</span><br><span class="line">      <span class="keyword">const</span> computed = &#123;&#125;</span><br><span class="line">      <span class="keyword">const</span> wrappedGetters = store._wrappedGetters</span><br><span class="line">      <span class="built_in">Object</span>.keys(wrappedGetters).forEach(<span class="function">(<span class="params">key</span>) =&gt;</span> &#123;</span><br><span class="line">        computed[key] = <span class="built_in">this</span>.partial(wrappedGetters[key], store)</span><br><span class="line">        <span class="built_in">Object</span>.defineProperty(store.getters, key, &#123;</span><br><span class="line">          get: <span class="function">() =&gt;</span> store._vm[key],</span><br><span class="line">        &#125;)</span><br><span class="line">      &#125;)</span><br><span class="line">      <span class="built_in">this</span>._vm = <span class="keyword">new</span> _Vue(&#123;</span><br><span class="line">        data() &#123;</span><br><span class="line">          <span class="keyword">return</span> &#123;</span><br><span class="line">            $$state: state,</span><br><span class="line">          &#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        <span class="comment">// ! è®¡ç®—å±æ€§ï¼Œç”¨äºå®ç° getter</span></span><br><span class="line">        computed: computed,</span><br><span class="line">      &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    partial = <span class="function">(<span class="params">fn, arg</span>) =&gt;</span> <span class="function">() =&gt;</span> fn(arg)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„ä»£ç ï¼Œæ¯”è¾ƒæœ‰å®¹æ˜“æä¸æ¸…æ¥šçš„å°±ä¸¤ä¸ªåœ°æ–¹ï¼š</p><ul><li>wrappedGetters[key] æ˜¯ä»€ä¹ˆ</li><li>partial è¿”å›å€¼æ˜¯ä»€ä¹ˆ</li></ul><p>è¿™ä¸ªé—®é¢˜ç›´æ¥åœ¨è°ƒè¯•å™¨é‡Œçœ‹çœ‹å°±æ¸…æ¥šäº†ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Ff9c75190-5fb6-4c76-9f57-a374603567d0%2FUntitled.png?table=block&id=fd4c96ec-a1ad-407b-b418-81840bfcd806&name=Untitled.png&cache=v2"></p><p>æ˜¾ç„¶ï¼Œè¿™ä¸¤ä½ï¼Œä¸€ä¸ªæ˜¯ getter çš„åŒ…è£¹å‡½æ•°ï¼Œä¸€ä¸ªæ˜¯å…¶æœ¬èº«ã€‚</p><p>åˆ°è¿™é‡Œï¼Œgetter ä¹Ÿç®—æ˜¯åŸºæœ¬å®ç°äº†ï¼Œå…·ä½“æ•ˆæœå¦‚ä¸‹ï¼š</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/6fe02525-46b9-4694-a9d4-2828abe7f7a1/20200805_115001.gif?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200807/us-west-2/s3/aws4_request&X-Amz-Date=20200807T064717Z&X-Amz-Expires=86400&X-Amz-Signature=e6300f43deaa27b07f792b533a81d83cfd193865261d72e8d5b61895f695d16a&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%2220200805_115001.gif%22"></p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´ä½³é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/vuex-632700a6aa904f64943b83265571a638">æ‰‹å†™ç®€æ˜“ vuex</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>å‰ç«¯é€ è½®å­ã€1ã€‘ â€”â€” vue-router</title>
      <link href="/2020/08/10/2020-08-07_2/"/>
      <url>/2020/08/10/2020-08-07_2/</url>
      
        <content type="html"><![CDATA[<p>ä»Šå¤©æˆ‘ä»¬æ¥ç ”ç©¶ä¸€ä¸‹ vue-router çš„å†…éƒ¨å®ç°åŸç†ã€‚</p><p>æˆ‘ä»¬çŸ¥é“ï¼Œvue app æ˜¯ spaï¼Œæ˜¯æ²¡æœ‰é¡µé¢ä¹‹é—´çš„è·³è½¬çš„ï¼Œè¯´çš„ç›´ç™½ä¸€ç‚¹å°±æ˜¯æ²¡æœ‰åˆ·æ–°ã€‚é‚£ä¹ˆåœ¨ä¸åˆ·æ–°é¡µé¢çš„æƒ…å†µä¸‹ï¼Œæ€ä¹ˆå®ç°ä¸€ä¸ªé¡¹ç›®ä¸­ï¼Œä¸åŒé¡µé¢ï¼Œä¸åŒç»„ä»¶ä¹‹é—´çš„åˆ‡æ¢å±•ç¤ºå‘¢ï¼Ÿ</p><p>é€šè¿‡å­¦ä¹  vue-router çš„æºç ï¼Œå¯ä»¥å¾—çŸ¥ï¼Œæµè§ˆå™¨ä¸ºæˆ‘ä»¬æä¾›äº†ä¸¤ä¸ªæ–¹æ¡ˆï¼š</p><ul><li>hashï¼ˆå°±æ˜¯é¡µé¢ä¸Šçš„ #ï¼‰</li><li>historyï¼ˆh5ï¼‰</li></ul><p>ä»Šå¤©æˆ‘ä»¬å°±ç®€å•æ¥å®ç°ä¸€ä¸‹é€šè¿‡ hash çš„æ–¹å¼å®ç° vue çš„è·¯ç”±è·³è½¬ã€‚</p><a id="more"></a><h2 id="Step-1-éœ€æ±‚åˆ†æ"><a href="#Step-1-éœ€æ±‚åˆ†æ" class="headerlink" title="Step 1 - éœ€æ±‚åˆ†æ"></a>Step 1 - éœ€æ±‚åˆ†æ</h2><p>é¦–å…ˆé€šè¿‡ vue-cli 4.x åˆ›å»ºé¡¹ç›®ï¼Œé€‰æ‹©ä½¿ç”¨ routerï¼Œå¹¶ä¸”æ¨¡å¼é€‰æ‹©ä¸º hashã€‚</p><p>é¡¹ç›®åˆ›å»ºå®Œæˆåï¼Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° src ç›®å½•ä¸‹æœ‰ä¸€ä¸ª router æ–‡ä»¶ï¼Œå…¶å†…å®¹å¤§è‡´å¦‚ä¸‹ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> Vue <span class="keyword">from</span> <span class="string">&#x27;vue&#x27;</span></span><br><span class="line"><span class="keyword">import</span> VueRouter <span class="keyword">from</span> <span class="string">&#x27;./yvue-router&#x27;</span></span><br><span class="line"><span class="keyword">import</span> Home <span class="keyword">from</span> <span class="string">&#x27;../views/Home.vue&#x27;</span></span><br><span class="line"></span><br><span class="line">Vue.use(VueRouter)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> routes = [</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;Home&#x27;</span>,</span><br><span class="line">    component: Home,</span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    path: <span class="string">&#x27;/about&#x27;</span>,</span><br><span class="line">    name: <span class="string">&#x27;About&#x27;</span>,</span><br><span class="line">    component: <span class="function">() =&gt;</span> <span class="keyword">import</span>(<span class="string">&#x27;../views/About.vue&#x27;</span>),</span><br><span class="line">  &#125;,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span><br><span class="line">  routes,</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> router</span><br></pre></td></tr></table></figure><p>æˆ‘ä»¬é€æ­¥æ¥åˆ†æä¸€ä¸‹ä¸Šé¢çš„ä»£ç ï¼š</p><ul><li>é¦–å…ˆæ˜¯ç”¨è¿‡ Vue.use(VueRouter) æ³¨å†Œäº†æ’ä»¶ï¼Œé‚£ä¹ˆæ˜¾ç„¶ <strong>VueRouter æ˜¯ Vue çš„æ’ä»¶</strong>ï¼Œéœ€è¦æœ‰è‡ªå·±çš„<strong>é™æ€ install æ–¹æ³•</strong></li><li>æ¥ç€æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„ï¼Œé…ç½®äº†è·¯æœ‰æ˜ å°„è¡¨ï¼Œç”¨äºç¡®å®šè·¯ç”±å’Œç»„ä»¶çš„å…³ç³»</li><li>ç„¶åé€šè¿‡ new VueRouter({routers}) åˆ›å»ºäº†è·¯ç”±å®ä¾‹ï¼Œå¹¶ä¸”å°†å…¶å¯¼å‡º</li><li>æœ€åç†Ÿæ‚‰ vue çš„åŒå­¦è‚¯å®šçŸ¥é“ï¼Œå¯¼å‡ºçš„è¿™ä¸ª vueï¼Œæˆ‘ä»¬åœ¨ main ä¸­å°†å…¶å¼•ç”¨å¹¶ä¸”ä¼ é€’ç»™äº† Vue æœ¬èº«</li></ul><p>ä¸Šè¿°æµç¨‹éå¸¸ç®€å•ï¼Œé‚£ä¹ˆä» VueRouter çš„è§’åº¦å‡ºå‘ï¼Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>é¦–å…ˆè¿™é‡Œ Vue.use çš„æ—¶å€™ä¼šè°ƒç”¨ VueRouter.install æ–¹æ³•ï¼Œè€Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œæˆ‘ä»¬åº”è¯¥åšäº›ä»€ä¹ˆå‘¢ï¼Ÿ</p><p>è”åˆ vue-router çš„ä½¿ç”¨æˆ‘ä»¬çŸ¥é“ï¼Œæ³¨å†Œ router ä¹‹åï¼Œæˆ‘ä»¬å¯ä»¥å…¨å±€ä½¿ç”¨ä¸¤ä¸ªç»„ä»¶ï¼š</p><ul><li>router-viewï¼šç”¨äºæ˜¾ç¤ºç»„ä»¶</li><li>router-linkï¼šç”¨äºè·¯ç”±è·³è½¬</li></ul><p>æ˜¾ç„¶ï¼Œè¿™ä¸¤ä¸ªç»„ä»¶çš„æ³¨å†Œè¿‡ç¨‹æ˜¯åœ¨ install ä¸­ï¼Œå› ä¸ºè¿™é‡Œæ‹¥æœ‰å¯¹å…¨å±€ Vue çš„å¼•ç”¨ã€‚</p><p>æ¥ä¸‹æ¥ï¼Œå°±æ˜¯ router çš„æ ¸å¿ƒåŠŸèƒ½ï¼Œå½“ hash æ”¹å˜çš„æ—¶å€™ï¼Œæ”¹å˜å±•ç¤ºçš„ç»„ä»¶ï¼Œæ˜¾ç„¶è¿™é‡Œæˆ‘ä»¬åº”è¯¥æœ‰ä¸€ä¸ªå“åº”å¼çš„ currentï¼Œå½“ current æ”¹å˜çš„æ—¶å€™ï¼Œå°±è§¦å‘ render é‡æ–°æ¸²æŸ“ç»„ä»¶ã€‚</p><p>ä»¥ä¸Šï¼Œæˆ‘ä»¬å¯ä»¥å¤§è‡´æ€»ç»“ä¸€ä¸‹ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F60eca3e4-2504-42d5-80dc-5b1a29c6d716%2FUntitled.png?table=block&id=69e2386c-541d-4404-958d-0fc65353f69a&name=Untitled.png&cache=v2"></p><h2 id="Step-2-åŠŸèƒ½å®ç°"><a href="#Step-2-åŠŸèƒ½å®ç°" class="headerlink" title="Step 2 - åŠŸèƒ½å®ç°"></a>Step 2 - åŠŸèƒ½å®ç°</h2><p>é‚£ä¹ˆç°åœ¨æˆ‘ä»¬å¯ä»¥ç€æ‰‹å¼€å§‹å®ç°è‡ªå·±çš„ vue-router äº†ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬è‚¯å®šéœ€è¦ä¸€ä¸ª VueRouter çš„ç±»ï¼Œåº”ä¸ºåœ¨åé¢å®ƒéœ€è¦è¢«å®ä¾‹åŒ–ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="comment">// å¯¹åº” Vue.use</span></span><br><span class="line">  <span class="keyword">static</span> install(Vue) &#123;&#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹åº” new</span></span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>ç´§æ¥ç€æˆ‘ä»¬å°±å¯ä»¥åœ¨ install ä¸­å®ç°å¯¹ä¸¤ä¸ªå…¨å±€ç»„ä»¶çš„æ³¨å†Œï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">    <span class="comment">// å¯¹åº” Vue.use</span></span><br><span class="line">    <span class="keyword">static</span> install(Vue)&#123;</span><br><span class="line">        <span class="comment">// step 1: æ³¨å†Œç»„ä»¶ router-linkï¼Œç”¨äºè·¯ç”±è·³è½¬</span></span><br><span class="line">        <span class="comment">// å›å¿†ä¸€ä¸‹ router-link çš„ä½¿ç”¨ï¼š</span></span><br><span class="line">        <span class="comment">// * &lt;router-link to=&quot;/login&quot;&gt;login&lt;/router-link&gt;</span></span><br><span class="line">        Vue.component(<span class="string">&#x27;router-link&#x27;</span>, &#123;</span><br><span class="line">      <span class="comment">// å¿…è¦å‚æ•° to</span></span><br><span class="line">      props: &#123;</span><br><span class="line">        to: &#123;</span><br><span class="line">          type: <span class="built_in">String</span>,</span><br><span class="line">          <span class="built_in">require</span>: <span class="literal">true</span>,</span><br><span class="line">        &#125;,</span><br><span class="line">      &#125;,</span><br><span class="line">      <span class="comment">// æ¨¡æ¿ï¼Œå¯ä»¥ä½¿ç”¨ templateï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ renderã€‚</span></span><br><span class="line">      <span class="comment">// * render æ›´åŠ çµæ´»ï¼Œå¹¶ä¸”åœ¨ vue ä¸­ä¼šæŠŠ template ç¼–è¯‘æˆ render å‡½æ•°ã€‚</span></span><br><span class="line">      render() &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œå¯ä»¥å†™ jsxï¼Œä¹Ÿå¯ä»¥ä½¿ç”¨ h å‡½æ•°</span></span><br><span class="line">        <span class="comment">// è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨ jsxï¼Œåœ¨ view-router ä¸­ä½¿ç”¨ hï¼Œéƒ½å°è¯•ä¸€ä¸‹</span></span><br><span class="line">        <span class="comment">// * h å‡½æ•°ç±»ä¼¼äº react ä¸­çš„ createElement</span></span><br><span class="line">        <span class="keyword">return</span> <span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&#123;</span>`#$&#123;<span class="attr">this.to</span>&#125;`&#125;&gt;</span>&#123;this.$slots.default&#125;<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span></span><br><span class="line">      &#125;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// step 2: æ³¨å†Œç»„ä»¶ router-viewï¼Œç”¨äºæ˜¾ç¤ºç»„ä»¶</span></span><br><span class="line">            <span class="comment">// å›å¿†ä¸€ä¸‹ router-link çš„ä½¿ç”¨ï¼š</span></span><br><span class="line">            <span class="comment">// &lt;router-view /&gt;</span></span><br><span class="line">            Vue.component(<span class="string">&#x27;router-view&#x27;</span>, &#123;</span><br><span class="line">      <span class="comment">// æ²¡æœ‰å‚æ•°ï¼Œç›´æ¥ template</span></span><br><span class="line">      render(h) &#123;</span><br><span class="line">        <span class="comment">// è¿™é‡Œä½¿ç”¨ h</span></span><br><span class="line">        <span class="comment">// view-router çš„åŠŸèƒ½æ˜¯æ¸²æŸ“ç»„ä»¶ï¼Œé‚£ä¹ˆç»„ä»¶ä»å“ªé‡Œè·å–å‘¢ï¼Ÿ</span></span><br><span class="line">        <span class="comment">// å›å¿† router.js çš„è·¯ç”±è¡¨ï¼Œå…¶ä¸­æœ‰æ˜ å°„ url åœ°å€å’Œç»„ä»¶ï¼Œæ‰€ä»¥ç»„ä»¶æ˜¾ç„¶æ˜¯ä»è¿™é‡Œè·å–</span></span><br><span class="line">        <span class="comment">// è€Œå½“å‰è·¯ç”±æˆ‘ä»¬å¯ä»¥åœ¨æ„é€ å‡½æ•°ä¸­å®šä¹‰ä¸€ä¸ª current æ¥è¡¨ç¤º</span></span><br><span class="line">        <span class="comment">// æ‰€ä»¥å¯ä»¥é€šè¿‡ä»¥ä¸‹ä»£ç æ‰¾åˆ°å½“å‰ current å¯¹åº”çš„ç»„ä»¶</span></span><br><span class="line">        <span class="keyword">const</span> &#123; routeMap, current &#125; = <span class="built_in">this</span>.$router</span><br><span class="line">        <span class="keyword">const</span> component = routeMap[current] ? routeMap[current].component : <span class="literal">null</span></span><br><span class="line">        <span class="keyword">return</span> h(component)</span><br><span class="line">      &#125;,</span><br><span class="line">    &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/*...*/</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œè‡³å°‘æˆ‘ä»¬çš„ <router-link> å·²ç»æ˜¯å¯ç”¨çš„äº†ï¼Œè€Œ <router-view> åˆ™éœ€è¦æˆ‘ä»¬åœ¨æ„é€ å‡½æ•°ä¸­å®ç°å¯¹è·¯ç”±è¡¨çš„ç®¡ç†ä»¥åŠå¯¹ hashchange çš„ç›‘å¬ã€‚</p><p>é‚£ä¹ˆæ¥ä¸‹æ¥è‡ªç„¶æ˜¯å®ç° constructor</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹åº” new</span></span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è·¯ç”±è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.routerMap = &#123;&#125;</span><br><span class="line">    options.routes.map(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routerMap[route.path] = route</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ current</span></span><br><span class="line">    <span class="keyword">const</span> current = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ hashchange</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.onHashChange.bind(<span class="built_in">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onHashChange() &#123;</span><br><span class="line">    <span class="built_in">this</span>.current = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼Œæ•´ä¸ª vue-router å·²ç»å®ç°å¾—å·®ä¸å¤šäº†ï¼Œä½†è¿˜å­˜åœ¨è¿™ä¸€ä¸ªå·¨å¤§çš„é—®é¢˜ï¼Œé‚£å°±æ˜¯ current å¹¶ä¸æ˜¯å“åº”å¼çš„ï¼Œå½“è·¯ç”±åˆ‡æ¢ï¼Œcurrent æ”¹å˜çš„æ—¶å€™ï¼Œå¹¶ä¸ä¼šè§¦å‘ render é‡æ–°æ¸²æŸ“ç»„ä»¶ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F2d5f78cf-5c37-4aa4-a9cd-701e0fc59193%2F20200804_114704.gif?table=block&id=dcb77b60-e4b2-4e30-8f20-9a6cc6cecbd9&name=20200804_114704.gif&cache=v2"></p><p>é‚£åº”è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿ</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯ï¼š<strong>æ€ä¹ˆå°† current è½¬æˆ vue å“åº”å¼æ•°æ®ï¼Ÿ</strong></p><p>å¯¹äºä¸Šè¿°é—®é¢˜ï¼Œè¿™é‡Œæœ‰ä¸¤ä¸ªæ€è·¯ï¼š</p><ul><li>æ–°å»º vue å®ä¾‹ï¼Œé€šè¿‡ data å°† current è½¬æˆå“åº”å¼æ•°æ®</li><li>åˆ©ç”¨ vue æä¾›çš„é™æ€æ–¹æ³• <strong>Vue.util.defineReactive</strong></li></ul><p>è¿™é‡Œæˆ‘ä»¬é‡‡å–ç¬¬äºŒç§æ–¹æ¡ˆï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹åº” new</span></span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è·¯ç”±è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.routerMap = &#123;&#125;</span><br><span class="line">    options.routes.map(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routerMap[route.path] = route</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ current</span></span><br><span class="line">    <span class="keyword">const</span> initial = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    Vue.util.defineReactive(<span class="built_in">this</span>, <span class="string">&#x27;current&#x27;</span>, initial)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ hashchange</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.onHashChange.bind(<span class="built_in">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onHashChange() &#123;</span><br><span class="line">    <span class="built_in">this</span>.current = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œåˆå‡ºç°ä¸€ä¸ªé—®é¢˜ï¼Œè¿™ä¸ª Vue ä»å“ªé‡Œæ¥å‘¢ï¼Ÿ</p><p>å…¶å®è¿™é‡Œéœ€è¦è®©æ€ç»´è·³å‡º constructorï¼šæˆ‘ä»¬çŸ¥é“æ‰§è¡Œ install çš„æ—¶å€™ä¼šä¼ å…¥ Vueï¼Œé‚£ä¹ˆåœ¨ install çš„æ—¶å€™æˆ‘ä»¬ä¿å­˜ä¸€ä¸ªå…¨å±€å˜é‡ _Vue å³å¯åœ¨ constructor ä¸­è¿›è¡Œä½¿ç”¨äº†ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> _Vue</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">VueRouter</span> </span>&#123;</span><br><span class="line">  <span class="comment">/*...*/</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯¹åº” new</span></span><br><span class="line">  <span class="keyword">constructor</span>(options) &#123;</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è·¯ç”±è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.routerMap = &#123;&#125;</span><br><span class="line">    options.routes.map(<span class="function">(<span class="params">route</span>) =&gt;</span> &#123;</span><br><span class="line">      <span class="built_in">this</span>.routerMap[route.path] = route</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ current</span></span><br><span class="line">    <span class="keyword">const</span> initial = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span></span><br><span class="line">    _Vue.util.defineReactive(<span class="built_in">this</span>, <span class="string">&#x27;current&#x27;</span>, initial)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ hashchange</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.onHashChange.bind(<span class="built_in">this</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  onHashChange() &#123;</span><br><span class="line">    <span class="built_in">this</span>.current = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>)</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åˆ°è¿™é‡Œï¼ŒåŸºæœ¬çš„è·¯ç”±å·²ç»å®ç°äº†ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2Fef5b0447-bf3f-4b40-a525-347d5cefb018%2F20200804_134007.gif?table=block&id=0716b1fc-78ea-4d35-b7cb-0c9f4f16818e&name=20200804_134007.gif&cache=v2"></p><p>è¿˜æœ‰ä¸€äº›å¯ä»¥æ‰©å±•çš„åœ°æ–¹ï¼š</p><p>æ¯”å¦‚ä¼˜åŒ–ä¸€ä¸‹ constructorï¼Œå°† options ä¿å­˜åˆ°æœ¬åœ°ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">constructor</span>(options)&#123;</span><br><span class="line">    <span class="built_in">this</span>.$options = options</span><br><span class="line">    <span class="comment">// åˆå§‹åŒ–è·¯ç”±è¡¨</span></span><br><span class="line">    <span class="built_in">this</span>.routerMap = &#123;&#125;</span><br><span class="line">    <span class="built_in">this</span>.$options.routes.map(<span class="function">(<span class="params">route</span>)=&gt;</span>&#123;</span><br><span class="line">        <span class="built_in">this</span>.routerMap[route.path] = route</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// å®šä¹‰ current</span></span><br><span class="line">    <span class="keyword">const</span> initial = <span class="built_in">window</span>.location.hash.slice(<span class="number">1</span>) || <span class="string">&#x27;/&#x27;</span></span><br><span class="line">  _Vue.util.defineReactive(<span class="built_in">this</span>, <span class="string">&#x27;current&#x27;</span>, initial)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ç›‘å¬ hashchange</span></span><br><span class="line">    <span class="built_in">window</span>.addEventListener(<span class="string">&#x27;hashchange&#x27;</span>, <span class="built_in">this</span>.onHashChange.bind(<span class="built_in">this</span>))</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™å¯ä»¥ä¿è¯æ•°æ®çš„å•å‘æµåŠ¨ã€‚</p><p>æ¯”å¦‚ä¸ºç»„ä»¶å®ä¾‹æŒ‚è½½ $routerï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥åƒ this.$router.push() è¿™æ ·ä½¿ç”¨ router ä¸Šçš„æ–¹æ³•äº†ã€‚</p><p>ä¸è¿‡è¿™é‡Œæœ‰ä¸€ä¸ªç‚¹å€¼å¾—æ³¨æ„ï¼Œé‚£å°±æ˜¯æ—¶é—´ï¼š</p><p>å› ä¸ºå½“æˆ‘ä»¬æ‰§è¡Œ install çš„æ—¶å€™ï¼ŒVueRouter çš„å®ä¾‹è¿˜æ²¡åˆ›å»ºï¼Œé‚£ä¹ˆç›´æ¥é€šè¿‡ï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Vue.prototype.$router = <span class="built_in">this</span>.$options.router</span><br></pre></td></tr></table></figure><p>è¿›è¡ŒæŒ‚è½½æ˜¾ç„¶æ˜¯ä¸è¡Œçš„ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å€ŸåŠ© mixin æ¥ä½¿ç”¨ Vue çš„ç”Ÿå‘½å‘¨æœŸé’©å­ï¼Œå½“ç»„ä»¶åˆ›å»ºä¹‹å‰è¿›è¡ŒæŒ‚è½½æ“ä½œï¼š</p><figure class="highlight jsx"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">Vue.mixin(&#123;</span><br><span class="line">  beforeCreate() &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">this</span>.$options.router) &#123;</span><br><span class="line">      Vue.prototype.$router = <span class="built_in">this</span>.$options.router</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·å°±æ²¡ä»€ä¹ˆé—®é¢˜äº†ã€‚</p><h2 id="ç»“è¯­"><a href="#ç»“è¯­" class="headerlink" title="ç»“è¯­"></a>ç»“è¯­</h2><p>æ›´ä½³é˜…è¯»ä½“éªŒï¼š<a href="https://www.notion.so/vue-router-5e3643ff7f344645bf6fa0b0a4229115">æ‰‹å†™ç®€æ˜“ vue-router</a></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Github + Hexo çˆ¬å‘ä¹‹æ—…ã€2ã€‘ â€”â€” ç½‘ç«™é…ç½®</title>
      <link href="/2020/08/07/2020-08-07_1/"/>
      <url>/2020/08/07/2020-08-07_1/</url>
      
        <content type="html"><![CDATA[<p>å‰é¢å·²ç»å°†ç½‘ç«™çš„åŸºæœ¬æ¶å­æ­å¥½äº†ï¼Œä½†é€šç”¨çš„é…ç½®æ˜¾ç„¶å¹¶ä¸é€‚ç”¨äºæ¯ä¸€ä¸ªäººï¼Œè¿™é‡Œå°±é€šè¿‡é…ç½®æ–‡ä»¶ç¨å¾®è‡ªå®šä¹‰ä¸€ä¸‹ã€‚</p><a id="more"></a><h2 id="ç«™ç‚¹é…ç½®"><a href="#ç«™ç‚¹é…ç½®" class="headerlink" title="ç«™ç‚¹é…ç½®"></a>ç«™ç‚¹é…ç½®</h2><p>ç›®æ ‡æ–‡ä»¶ï¼šroot/ _config.yml</p><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">title:</span> <span class="string">ä¸–ç•Œçš„ä¾§é¢</span></span><br><span class="line"><span class="attr">subtitle:</span> <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="attr">author:</span> <span class="string">åˆå¿ƒYearth</span></span><br><span class="line"><span class="attr">favicon:</span> <span class="string">https://s1.ax1x.com/2020/08/06/agXE9K.png</span></span><br></pre></td></tr></table></figure><h2 id="ä¸»é¢˜é…ç½®"><a href="#ä¸»é¢˜é…ç½®" class="headerlink" title="ä¸»é¢˜é…ç½®"></a>ä¸»é¢˜é…ç½®</h2><p>ç›®æ ‡æ–‡ä»¶ï¼šroot/themes/volantis/_config.yml</p><h3 id="å°é¢é…ç½®"><a href="#å°é¢é…ç½®" class="headerlink" title="å°é¢é…ç½®"></a>å°é¢é…ç½®</h3><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">cover:</span></span><br><span class="line">    <span class="attr">M title:</span> <span class="string">&#x27;æ ‡é¢˜&#x27;</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># subtitle: &#x27;&#x27;</span></span><br><span class="line">    <span class="attr">M search:</span> <span class="string">ä½ æƒ³çœ‹ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># features: // è¿™ä¸ªé€‰é¡¹æ˜¯æœç´¢æ¡†ä¸‹çš„å¯¼èˆªæŒ‰é’®ï¼Œè¿™é‡Œé€‰æ‹©æ³¨é‡Šæ‰</span></span><br></pre></td></tr></table></figure><h2 id="å¯¼èˆªæ é…ç½®"><a href="#å¯¼èˆªæ é…ç½®" class="headerlink" title="å¯¼èˆªæ é…ç½®"></a>å¯¼èˆªæ é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">navbar:</span></span><br><span class="line">    <span class="attr">logo:</span></span><br><span class="line">        <span class="attr">img:</span></span><br><span class="line">        <span class="attr">icon:</span></span><br><span class="line">        <span class="attr">title:</span> <span class="string">&#x27;æ ‡é¢˜&#x27;</span></span><br><span class="line">    <span class="attr">menu:</span></span><br><span class="line">        <span class="string">M</span> <span class="comment"># - name: åšå®¢</span></span><br><span class="line">        <span class="string">M</span> <span class="comment"># icon: fas fa-rss</span></span><br><span class="line">        <span class="string">M</span> <span class="comment"># url: /</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">åˆ†ç±»</span></span><br><span class="line">            <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">            <span class="attr">url:</span> <span class="string">tags/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">æ ‡ç­¾</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-tags</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">tags/</span></span><br><span class="line">        <span class="string">M</span> <span class="comment"># - name: å½’æ¡£</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># icon: fas fa-archive</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># url: archives/</span></span><br><span class="line">        <span class="string">M</span> <span class="comment"># - name: å‹é“¾</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># icon: fas fa-link</span></span><br><span class="line">    <span class="string">M</span> <span class="comment"># url: friends/</span></span><br><span class="line">        <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">å…³äº</span></span><br><span class="line">      <span class="attr">icon:</span> <span class="string">fas</span> <span class="string">fa-info-circle</span></span><br><span class="line">      <span class="attr">url:</span> <span class="string">about/</span></span><br><span class="line">        <span class="attr">search:</span> <span class="string">ä½ æƒ³çœ‹ç‚¹ä»€ä¹ˆå‘¢ï¼Ÿ</span></span><br></pre></td></tr></table></figure><h2 id="å¸ƒå±€é…ç½®"><a href="#å¸ƒå±€é…ç½®" class="headerlink" title="å¸ƒå±€é…ç½®"></a>å¸ƒå±€é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">layout:</span></span><br><span class="line"><span class="attr">on_page:</span></span><br><span class="line"><span class="attr">M body:</span> [<span class="string">article</span>]</span><br></pre></td></tr></table></figure><h2 id="æ’ä»¶é…ç½®"><a href="#æ’ä»¶é…ç½®" class="headerlink" title="æ’ä»¶é…ç½®"></a>æ’ä»¶é…ç½®</h2><figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">plugins:</span></span><br><span class="line"><span class="attr">backstretch:</span></span><br><span class="line"><span class="attr">M position:</span> <span class="string">fixed</span></span><br><span class="line"><span class="attr">aplayer:</span></span><br><span class="line"><span class="attr">M id:</span> <span class="number">170672512</span></span><br><span class="line"><span class="attr">M autoplay:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure><h2 id="æœ€ç»ˆæ•ˆæœ"><a href="#æœ€ç»ˆæ•ˆæœ" class="headerlink" title="æœ€ç»ˆæ•ˆæœ"></a>æœ€ç»ˆæ•ˆæœ</h2><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F030e52f5-b2d0-4a4f-b55c-0a3b58e04239%2FUntitled.png?table=block&id=b9f55037-fcbd-4e24-842a-695381f423db&name=Untitled.png&cache=v2"></p>]]></content>
      
      
      
    </entry>
    
    
    
    <entry>
      <title>Github + Hexo çˆ¬å‘ä¹‹æ—…ã€1ã€‘ â€”â€” åŸºç¡€æ­å»º</title>
      <link href="/2020/08/07/2020-08-06/"/>
      <url>/2020/08/07/2020-08-06/</url>
      
        <content type="html"><![CDATA[<p>æ²¡æœ‰ä¸€ä¸ªè‡ªå·±çš„ä¸ªäººåšå®¢ï¼Œæ˜¾ç„¶æ˜¯ä¸å¤Ÿç¨‹åºå‘˜çš„ï¼Œäºæ˜¯ä»Šå¤©åœ¨ä¸€ç•ªæŠ˜è…¾ä¹‹ä¸‹ï¼Œé€šè¿‡ Github + Hexo é…ç½®äº†ä¸€ä¸ªåœ¨çº¿çš„åšå®¢ï¼Œç‰¹æ­¤è®°å½•ã€‚å½“ç„¶å¦‚æœå–œæ¬¢æ›´åŠ åå‘æ–‡æ¡£é£æ ¼çš„ç«¥é‹ï¼Œå¯ä»¥é€‰æ‹© Vuepressã€‚</p><a id="more"></a><h2 id="Step-1-Hexo-æœ¬åœ°å®‰è£…åŠè¿è¡Œæµ‹è¯•"><a href="#Step-1-Hexo-æœ¬åœ°å®‰è£…åŠè¿è¡Œæµ‹è¯•" class="headerlink" title="Step 1 - Hexo æœ¬åœ°å®‰è£…åŠè¿è¡Œæµ‹è¯•"></a>Step 1 - Hexo æœ¬åœ°å®‰è£…åŠè¿è¡Œæµ‹è¯•</h2><p>é¦–å…ˆå…¨å±€å®‰è£… Hexoï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo npm install hexo-cli -g</span><br></pre></td></tr></table></figure><p>å®‰è£…å¥½ä¹‹åä½¿ç”¨ Hexo åˆ›å»ºä¸€ä¸ªç›®å½•ï¼Œç”¨äºæ„å»ºä¸ªäººåšå®¢ç½‘ç«™ï¼Œè¿™é‡Œæˆ‘ä»¬å°±å« daily_recordï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo init daily_record</span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥è¿›å…¥åˆ°åšå®¢ç›®å½•ä¸‹ï¼Œå®‰è£…ä¾èµ–ï¼Œè¿è¡Œå³å¯æŸ¥çœ‹åˆå§‹çŠ¶æ€äº†</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">cd</span> daily_record</span><br><span class="line">npm install</span><br><span class="line">hexo server</span><br></pre></td></tr></table></figure><p>å¦‚æœä¸Šè¿°æ­¥éª¤æ²¡æœ‰å‡ºé”™çš„è¯ï¼Œåº”è¯¥å¯ä»¥åœ¨æœ¬åœ°çš„ 4000 ç«¯å£çœ‹åˆ°å¦‚ä¸‹ç•Œé¢ï¼š</p><p><img src="https://www.notion.so/signed/https%3A%2F%2Fs3-us-west-2.amazonaws.com%2Fsecure.notion-static.com%2F35c84369-6339-46b8-a300-10693b7e875e%2FUntitled.png?table=block&id=f2429731-a74f-4f44-a6fc-f0ef9abb2c60&name=Untitled.png&cache=v2"></p><h2 id="Step-2-æ›´æ¢-Volantis-ä¸»é¢˜"><a href="#Step-2-æ›´æ¢-Volantis-ä¸»é¢˜" class="headerlink" title="Step 2 - æ›´æ¢ Volantis ä¸»é¢˜"></a>Step 2 - æ›´æ¢ Volantis ä¸»é¢˜</h2><p>æƒ³å¿…ä½ ä¹Ÿè§‰å¾—é»˜è®¤ä¸»é¢˜æœ‰ç‚¹ lowã€‚(æ¯•ç«Ÿæ˜¯å¤šå¹´å‰çš„äº§ç‰©äº†ï¼Œæœ‰ç‚¹è·Ÿä¸ä¸Šæ—¶ä»£çš„å®¡ç¾)</p><p>å¥½åœ¨ Hexo ç”Ÿæ€è¶³å¤Ÿä¸°å¯Œï¼Œæœ‰å¾ˆå¤šä¼˜ç§€çš„ä¸»é¢˜ï¼Œæ¯”å¦‚ Volantisã€‚</p><p>æ¥ä¸‹æ¥è¿›å…¥åˆ°é¡¹ç›®çš„æ ¹ç›®å½•ï¼Œå¼€å§‹å®‰è£…ä¸»é¢˜ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/xaoxuu/hexo-theme-volantis themes/volantis</span><br></pre></td></tr></table></figure><p>ä¸‹è½½å¥½ä¹‹åï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="bullet">-</span> <span class="attr">theme:</span> <span class="string">landscape</span></span><br><span class="line"><span class="string">+</span> <span class="attr">theme:</span> <span class="string">volantis</span></span><br></pre></td></tr></table></figure><p>ç„¶åå®‰è£…ä¸€äº›ä¾èµ–ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-generator-search hexo-generator-json-content hexo-renderer-stylus -S</span><br></pre></td></tr></table></figure><p>ç°åœ¨é‡æ–°å¯åŠ¨æœåŠ¡ï¼Œä½ çš„ç½‘ç«™åº”è¯¥å˜æˆäº†è¿™æ ·</p><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/f9d35ec4-0bdc-4e1e-9280-3cba80f5a71b/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200806/us-west-2/s3/aws4_request&X-Amz-Date=20200806T092415Z&X-Amz-Expires=86400&X-Amz-Signature=e700ffe5b7313d847e6e4c4cbe29bc33a20307aa9ce3ddf0e1606bead705d98e&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p><h2 id="Step-3-éƒ¨ç½²åˆ°-Gitub"><a href="#Step-3-éƒ¨ç½²åˆ°-Gitub" class="headerlink" title="Step 3 - éƒ¨ç½²åˆ° Gitub"></a>Step 3 - éƒ¨ç½²åˆ° Gitub</h2><p>è¿™ä¸ªä¸»é¢˜æœ‰å¾ˆå¤šé…ç½®ï¼Œå…·ä½“å¯ä»¥å‚è€ƒ<a href="https://volantis.js.org/v2/getting-started/">å®˜æ–¹æ–‡æ¡£</a>ï¼Œè¿™é‡Œå°±è¿˜ä¸åœ¨èµ˜è¿°ã€‚</p><p>è¦å°†ä¸ªäººä¸»é¡µéƒ¨ç½²åˆ° Githubï¼Œé¦–å…ˆæˆ‘ä»¬è¦å» Github åˆ›å»ºä¸€ä¸ª yourname.github.io çš„ä»“åº“ã€‚</p><p>éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œyourname ä¸€å®šè¦å’Œä½ çš„ github name å®Œå…¨ä¸€æ ·ï¼Œå¹¶ä¸”ä¸€å®šè¦é€‰æ‹©åˆå§‹åŒ–é¡¹ç›®</p><p>ç„¶åå®‰è£… Hexo çš„éƒ¨ç½²æ’ä»¶ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install hexo-deployer-git -S</span><br></pre></td></tr></table></figure><p>å®‰è£…å¥½ä¹‹åï¼Œä¿®æ”¹æ ¹ç›®å½•ä¸‹çš„ _config.yml æ–‡ä»¶ï¼š</p><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="string">+</span>  <span class="attr">type:</span> <span class="string">&#x27;git&#x27;</span></span><br><span class="line"><span class="string">+</span>  <span class="attr">repo:</span> <span class="string">https://github.com/yourname/yourname.github.io</span></span><br><span class="line"><span class="string">+</span>  <span class="attr">branch:</span> <span class="string">master</span></span><br></pre></td></tr></table></figure><p>æœ€åé€šè¿‡ä»¥ä¸‹å‘½ä»¤å³å¯ä¸€é”®éƒ¨ç½²ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hexo g -d</span><br></pre></td></tr></table></figure><h2 id="Step-4-è®¿é—®ä¸ªäººä¸»é¡µ"><a href="#Step-4-è®¿é—®ä¸ªäººä¸»é¡µ" class="headerlink" title="Step 4 - è®¿é—®ä¸ªäººä¸»é¡µ"></a>Step 4 - è®¿é—®ä¸ªäººä¸»é¡µ</h2><p>æ¥ä¸‹æ¥å°±å¯ä»¥åœ¨ä¸‹é¢çš„åœ°å€è®¿é—®ä½ çš„ä¸ªäººä¸»é¡µäº†ï¼š</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">https://yourname.github.io/</span><br></pre></td></tr></table></figure><p><img src="https://s3.us-west-2.amazonaws.com/secure.notion-static.com/0c0da1b1-57a7-4899-b0ef-f345e46af4a4/Untitled.png?X-Amz-Algorithm=AWS4-HMAC-SHA256&X-Amz-Credential=AKIAT73L2G45O3KS52Y5/20200806/us-west-2/s3/aws4_request&X-Amz-Date=20200806T092430Z&X-Amz-Expires=86400&X-Amz-Signature=ff4f20c6532b8aca669d0b867b9a2ad3945e685fbecde46bf7f2546da0b5f47a&X-Amz-SignedHeaders=host&response-content-disposition=filename%20=%22Untitled.png%22"></p>]]></content>
      
      
      
    </entry>
    
    
  
  
</search>
